


=== PLIK: index.html ===

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Warsztat+ to cyfrowy dziennik napraw, transparentna historia VIN i wygodny panel dla warsztatĂłw, flot oraz kierowcĂłw.">
    <title>Warsztat+ | Cyfrowy serwis i historia VIN</title>
    <link rel="stylesheet" href="css/base/core.css">
    <link rel="stylesheet" href="css/landing/page.css">
</head>
<body class="site-body">
    <header class="site-header" id="top">
        <div class="site-header__brand">
            <a class="site-header__logo" href="#top">Warsztat<span class="site-header__logo--accent">+</span></a>
            <p class="site-header__tagline">Cyfrowa dokumentacja napraw, VIN w czasie rzeczywistym</p>
        </div>
        <button class="site-nav__toggle" aria-label="PrzeĹ‚Ä…cz nawigacjÄ™" aria-expanded="false">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <nav class="site-nav" aria-label="GĹ‚Ăłwna nawigacja">
            <a class="site-nav__link" href="#vin">Historia VIN</a>
            <a class="site-nav__link" href="#features">Funkcje</a>
            <a class="site-nav__link" href="#workflow">Proces</a>
            <a class="site-nav__link" href="#insights">Ciekawostki</a>
            <a class="site-nav__cta" href="#kontakt">Skontaktuj siÄ™</a>
        </nav>
    </header>

    <main>
           
        <section class="hero" aria-labelledby="hero-title">
            <div class="hero__content">
                <p class="hero__eyebrow">Platforma dla warsztatĂłw i flot</p>
                <h1 id="hero-title">Cyfrowy serwis, ktĂłry kierowcy polecajÄ… znajomym</h1>
                <p class="hero__lead">Warsztat+ Ĺ‚Ä…czy raportowanie napraw, moderacjÄ™ VIN i komunikacjÄ™ z klientem w jednym, lekko dziaĹ‚ajÄ…cym panelu. KaĹĽda wizyta dostaje historiÄ™, ktĂłrej nie da siÄ™ zgubiÄ‡ w segregatorze.</p>
                <div class="hero__actions">
                    <a class="btn btn--primary" href="#vin">SprawdĹş historiÄ™ VIN</a>
                    <a class="btn btn--ghost" href="#features">Zobacz korzyĹ›ci</a>
                </div>
                <p class="hero__note">Warsztat+ raportuje Ĺ›rednio 64 naprawy tygodniowo i skraca o 43% czas oddzwaniania do klientĂłw.</p>
            </div>
            <div class="hero__stats" aria-label="Kluczowe wskaĹşniki">
                <div>
                    <strong>15 min</strong>
                    <span>Ĺ›redni czas dodania raportu</span>
                </div>
                <div>
                    <strong>3Ă—</strong>
                    <span>mniej telefonĂłw o status</span>
                </div>
                <div>
                    <strong>87%</strong>
                    <span>klientĂłw wraca po kolejnÄ… usĹ‚ugÄ™</span>
                </div>
            </div>
        </section>

        <section id="vin" class="section section--highlight" aria-labelledby="vin-title">
            <div class="section__header">
                <p class="section__eyebrow">WĹ‚aĹ›ciciele pojazdĂłw</p>
                <h2 id="vin-title">SprawdĹş historiÄ™ napraw po numerze VIN</h2>
                <p>KaĹĽde auto zostawia cyfrowy Ĺ›lad. Warsztat+ Ĺ‚Ä…czy raporty z ponad 6 000 warsztatĂłw i pozwala kierowcy odczytaÄ‡ historiÄ™ po samym VIN-ie.</p>
            </div>
            <form id="vin-form" class="vin-form" novalidate>
                <label class="visually-hidden" for="vin-input">Numer VIN</label>
                <input id="vin-input" name="vin" maxlength="17" minlength="11" autocomplete="off" placeholder="WprowadĹş numer VIN" required>
                <button class="btn btn--primary" type="submit">Wyszukaj</button>
            </form>
            <div id="vin-result" class="vin-result" aria-live="polite"></div>
            <p class="vin__hint">Tip: Polskie auto spÄ™dza Ĺ›rednio 10% ĹĽycia w serwisie. Warto mieÄ‡ tÄ™ historiÄ™ pod rÄ™kÄ….</p>
        </section>

        <section id="features" class="section" aria-labelledby="features-title">
            <div class="section__header">
                <p class="section__eyebrow">Dla zespoĹ‚Ăłw serwisowych</p>
                <h2 id="features-title">Profesjonalne narzÄ™dzia dla warsztatu</h2>
                <p>ZebraliĹ›my najczÄ™stsze potrzeby mechanikĂłw, doradcĂłw serwisowych i fleet managerĂłw. Efekt? Panel, ktĂłry przyspiesza kaĹĽdy etap wizyty.</p>
            </div>
            <div class="card-grid">
                <article class="card">
                    <h3>Raporty z warsztatu</h3>
                    <p>Dodawaj zdjÄ™cia, przebieg, notatki i statusy w jednym formularzu. Panel przypomina o brakujÄ…cych wpisach.</p>
                </article>
                <article class="card">
                    <h3>Transparentny VIN</h3>
                    <p>Klient wpisuje 17 znakĂłw i widzi peĹ‚nÄ… historiÄ™. To naturalna referencja â€“ 63% kierowcĂłw wysyĹ‚a link znajomym.</p>
                </article>
                <article class="card">
                    <h3>Logi i bezpieczeĹ„stwo</h3>
                    <p>Audyt wĹ‚Ä…cza siÄ™ automatycznie. KaĹĽda zmiana statusu zostawia Ĺ›lad wraz z kontem administratora.</p>
                </article>
                <article class="card">
                    <h3>GotowoĹ›Ä‡ mobilna</h3>
                    <p>Interface skaluje siÄ™ od telefonu na hali po duĹĽy ekran doradcy. Zero pinch-to-zoom, czyste CTA.</p>
                </article>
            </div>
        </section>

        <section id="workflow" class="section section--alt" aria-labelledby="workflow-title">
            <div class="section__header">
                <p class="section__eyebrow">Jak dziaĹ‚amy</p>
                <h2 id="workflow-title">Proces wdroĹĽenia w trzech krokach</h2>
            </div>
            <ol class="steps">
                <li>
                    <h3>1. Aktywacja konta</h3>
                    <p>Dodaj warsztat na podstawie NIP i e-maila. System automatycznie przypisze licencjÄ™ i wyĹ›le zaproszenie.</p>
                </li>
                <li>
                    <h3>2. Raportowanie</h3>
                    <p>Mechanik, doradca i administrator korzystajÄ… z tych samych statusĂłw. KaĹĽdy update trafia od razu do klienta.</p>
                </li>
                <li>
                    <h3>3. DostÄ™p klienta</h3>
                    <p>Kierowca wpisuje VIN i dostaje przejrzystÄ… kartÄ™ napraw: przebieg, daty, zdjÄ™cia, rekomendacje.</p>
                </li>
            </ol>
        </section>

        <section id="insights" class="section" aria-labelledby="insights-title">
            <div class="section__header">
                <p class="section__eyebrow">Ciekawostki z hali serwisowej</p>
                <h2 id="insights-title">Kierowcy kochajÄ… dane, warsztaty kochajÄ… porzÄ…dek</h2>
                <p>WybraliĹ›my kilka liczb z tysiÄ™cy raportĂłw Warsztat+. To one pokazujÄ…, dlaczego cyfrowa dokumentacja to must-have w 2025 roku.</p>
            </div>
            <div class="insights-grid">
                <article class="insight">
                    <span class="insight__value">52%</span>
                    <p class="insight__text">tyle zgĹ‚oszeĹ„ dotyczy elektryki i infotainmentu. Dobre zdjÄ™cie moduĹ‚u CAN oszczÄ™dza dwie wiadomoĹ›ci.</p>
                </article>
                <article class="insight">
                    <span class="insight__value">31Â°C</span>
                    <p class="insight__text">tyle potrafi mieÄ‡ asfalt w lipcu. Dlatego VIN check na telefonie musi byÄ‡ czytelny w sĹ‚oĹ„cu.</p>
                </article>
                <article class="insight">
                    <span class="insight__value">7,4 l/100 km</span>
                    <p class="insight__text">Ĺ›rednie spalanie aut flotowych w naszej bazie. Raport z serwisu to teĹĽ okazja, by dorzuciÄ‡ tip o eco drivingu.</p>
                </article>
                <article class="insight">
                    <span class="insight__value">24 h</span>
                    <p class="insight__text">tyle wynosi SLA na odpowiedĹş do klienta w najlepszych warsztatach. Automatyczne powiadomienia pomagajÄ… dotrzymaÄ‡ sĹ‚owa.</p>
                </article>
            </div>
        </section>

        <section id="kontakt" class="section section--highlight cta" aria-labelledby="cta-title">
            <div class="cta__content">
                <p class="section__eyebrow">Masz pytania?</p>
                <h2 id="cta-title">Napisz do nas i zobacz demo</h2>
                <p>PodrzuÄ‡ nam VIN, case serwisowy lub wyzwanie Twojej sieci warsztatĂłw. Odezwij siÄ™, zanim kolejny klient zapyta o status naprawy.</p>
            </div>
            <div class="cta__actions">
                <a class="btn btn--secondary" href="mailto:kontakt@warsztatplus.pl">kontakt@warsztatplus.pl</a>
                <a class="btn btn--ghost" href="login.html">PrzejdĹş do panelu</a>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <p>&copy; 2025 Warsztat+. Cyfrowy dziennik napraw i VIN.</p>
        <a class="ghost-link" href="login.html" aria-label="PrzejdĹş do panelu logowania">Panel administracyjny</a>
    </footer>

    <script src="js/shared/api.js" defer></script>
    <script src="js/landing/vinForm.js" defer></script>
    <script src="js/landing/navToggle.js" defer></script>
</body>
</html>


=== PLIK: login.html ===

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warsztat+ | Logowanie</title>
    <link rel="stylesheet" href="css/base/core.css">
    <link rel="stylesheet" href="css/auth/page.css">
</head>
<body class="auth-body">
    <main class="auth" aria-labelledby="auth-title">
        <a class="ghost-link auth__home-link" href="index.html#top">&#8592; Strona glowna</a>
        <header class="auth__intro">
            <p class="auth__eyebrow">Strefa zabezpieczona</p>
            <h1 id="auth-title">Zaloguj sie do Warsztat+</h1>
              <p>Wpisz adres e-mail administratora (domyslnie <code>admin@warsztat.pl</code>) oraz haslo ustawione w pliku <code>.env</code>. Po poprawnym logowaniu przekierujemy Cie do panelu.</p>
        </header>

        <form id="unified-login-form" class="auth-form" novalidate>
            <label>
                    Adres e-mail
                    <input type="email" name="identifier" autocomplete="username" required>
            </label>
            <label>
                Haslo
                <input type="password" name="password" autocomplete="current-password" required>
            </label>
            <button class="btn btn--primary" type="submit">Zaloguj</button>
        </form>
        <p class="auth-card__feedback" data-feedback="login" aria-live="polite"></p>
    </main>

    <script src="js/shared/api.js"></script>
    <script src="js/shared/session.js"></script>
    <script src="js/auth/login.js"></script>
</body>
</html>



=== PLIK: panel.html ===

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warsztat+ | Panel administratora</title>
    <link rel="stylesheet" href="css/base/core.css">
    <link rel="stylesheet" href="css/panel/page.css">
</head>
<body class="panel-body">
    <div class="panel-layout">
        <aside class="panel-sidebar">
            <div class="panel-sidebar__brand">Warsztat<span>+</span></div>
            <nav class="panel-nav" aria-label="Nawigacja panelu">
                <button class="panel-nav__link is-active" data-panel-target="overview">Przeglad</button>
                <button class="panel-nav__link" data-panel-target="workshops">Warsztaty</button>
                <button class="panel-nav__link" data-panel-target="reports">Raporty</button>
                <button class="panel-nav__link" data-panel-target="settings">Ustawienia</button>
                <button class="panel-nav__link" data-panel-target="logs">Logi</button>
            </nav>
        </aside>

        <div class="panel-content">
            <header class="panel-header">
                <div class="panel-header__info">
                    <span class="panel-header__subtitle" id="panel-role"></span>
                    <h1 id="panel-username"></h1>
                </div>
                <button class="btn btn--ghost" id="logout-btn">Wyloguj</button>
            </header>

            <main class="panel-main">
                <section class="panel-view is-active" data-panel="overview">
                    <div class="panel-section panel-section--summary">
                        <header class="panel-section__header">
                            <div>
                                <p class="panel-section__eyebrow">Stan systemu</p>
                                <h2>Podsumowanie</h2>
                            </div>
                            <p class="panel-section__hint">Dane aktualizuja sie wraz z dzialaniami administratora.</p>
                        </header>
                        <div class="panel-grid panel-grid--summary" id="overview-metrics"></div>
                    </div>
                    <div class="panel-grid panel-grid--overview-cards">
                        <div class="panel-card panel-card--logs">
                            <h2>Ostatnie logi</h2>
                            <ul class="panel-log" id="overview-logs"></ul>
                        </div>
                        <div class="panel-card panel-card--surface panel-card--audit">
                            <h2>Ostatnie akcje administratorow</h2>
                            <ul class="panel-log panel-log--audit" id="admin-actions"></ul>
                        </div>
                    </div>
                </section>

                <section class="panel-view" data-panel="workshops">
                    <div class="panel-section">
                        <div class="panel-card panel-card--surface panel-card--workshops">
                            <div class="panel-toolbar panel-toolbar--split" id="workshop-toolbar-list">
                                <div>
                                    <p class="panel-section__eyebrow">Baza warsztatow</p>
                                    <h2>Warsztaty</h2>
                                </div>
                                <div class="panel-toolbar__actions">
                                    <button class="btn btn--secondary" type="button" id="workshop-add-btn">Dodaj warsztat</button>
                                </div>
                            </div>
                            <!-- UsuniÄ™to dolny przycisk Powrot do listy, zostaje tylko gĂłrny -->
                            <div class="workshop-browser" id="workshop-browser-list">
                                <form id="workshop-filter-form" class="panel-filters panel-filters--inline panel-filters--surface" novalidate>
                                    <label>
                                        Szukaj po nazwie lub e-mailu
                                        <input type="search" name="query" placeholder="np. Warsztat+ Centralny">
                                    </label>
                                    <label>
                                        Status
                                        <select name="status">
                                            <option value="all">Wszystkie</option>
                                            <option value="active">Aktywne</option>
                                            <option value="inactive">Nieaktywne</option>
                                            <option value="notice">W okresie wypowiedzenia</option>
                                            <option value="deactivated">Dezaktywowane</option>
                                        </select>
                                    </label>
                                    <div class="panel-filters__actions">
                                        <button class="btn btn--ghost" type="button" id="workshop-filter-reset">Wyczysc</button>
                                        <button class="btn btn--secondary" type="submit">Filtruj</button>
                                    </div>
                                </form>
                                <div class="panel-list panel-list--grid" id="workshop-list"></div>
                            </div>

                            <div class="workshop-browser workshop-browser--detail" id="workshop-browser-detail" hidden>
                                <div class="workshop-detail-shell">
                                    <div class="panel-back-btn-container panel-back-btn--absolute">
                                        <button class="btn btn--ghost panel-back-btn" type="button" id="workshop-list-back">&larr; PowrĂłt do listy</button>
                                    </div>
                                        <div class="workshop-detail-shell__toolbar">
                                            <div>
                                                <p class="panel-section__eyebrow" id="workshop-detail-eyebrow">Profil warsztatu</p>
                                                <h3 id="workshop-detail-title">Szczegoly warsztatu</h3>
                                            </div>
                                            <button class="btn btn--danger" id="workshop-deactivate-btn">Dezaktywuj konto</button>
                                        </div>
                                    <p class="panel-feedback" id="workshop-detail-feedback" aria-live="polite"></p>
                                        <div class="workshop-detail-shell__layout">
                                            <div class="workshop-tabs">
                                                <!-- UsuniÄ™to pole specjalizacji -->
                                                <nav class="workshop-tabs__nav" aria-label="ZakĹ‚adki szczegĂłĹ‚Ăłw warsztatu">
                                                    <button class="workshop-tab active" data-tab="activity">AktywnoĹ›Ä‡ / Raporty</button>
                                                    <button class="workshop-tab" data-tab="logs">Logi i notatki</button>
                                                    <button class="workshop-tab" data-tab="reports">Raporty</button>
                                                    <button class="workshop-tab" data-tab="contacts">Kontakt & osoby</button>
                                                    <button class="workshop-tab" data-tab="settings">Ustawienia</button>
                                                    <button class="workshop-tab" data-tab="tickets">ZgĹ‚oszenia / bilety</button>
                                                </nav>
                                                <div class="workshop-tabs__content">
                                                    <section class="workshop-tab-content" id="tab-activity">
                                                        <div id="workshop-detail-overview" class="workshop-detail"></div>
                                                        <section class="workshop-detail__section">
                                                            <header>
                                                                <p class="panel-section__eyebrow">Abonament</p>
                                                                <h4>Stan umowy</h4>
                                                            </header>
                                                            <div id="workshop-detail-subscription" class="workshop-detail__grid"></div>
                                                        </section>
                                                        <!-- UsuniÄ™to podsekcjÄ™ Raporty warsztatu -->
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-logs" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">Logi i notatki</p>
                                                            <h4>Ostatnie dziaĹ‚ania i notatnik</h4>
                                                        </header>
                                                        <ul id="workshop-detail-logs">(Tu pojawi siÄ™ lista logĂłw...)</ul>
                                                        <textarea id="workshop-detail-notepad" class="workshop-notepad" placeholder="Notatki wewnÄ™trzne (widoczne tylko dla adminĂłw)"></textarea>
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-reports" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">Raporty</p>
                                                            <h4>Wszystkie raporty warsztatu</h4>
                                                        </header>
                                                        <form id="workshop-reports-filter-form" class="panel-filters panel-filters--inline" novalidate>
                                                            <label>
                                                                Status
                                                                <select name="status">
                                                                    <option value="all">Wszystkie</option>
                                                                    <option value="pending">OczekujÄ…ce</option>
                                                                    <option value="approved">Zatwierdzone</option>
                                                                    <option value="rejected">Odrzucone</option>
                                                                </select>
                                                            </label>
                                                            <label>
                                                                Data
                                                                <input type="date" name="date">
                                                            </label>
                                                            <label>
                                                                Typ naprawy
                                                                <input type="text" name="type" placeholder="np. mechanika, elektronika">
                                                            </label>
                                                            <div class="panel-filters__actions">
                                                                <button class="btn btn--secondary" type="submit">Filtruj</button>
                                                            </div>
                                                        </form>
                                                        <div id="workshop-reports-list">(Tu pojawi siÄ™ lista raportĂłw...)</div>
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-contacts" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">Kontakt & osoby</p>
                                                            <h4>UĹĽytkownicy konta warsztatu</h4>
                                                        </header>
                                                        <div id="workshop-detail-contacts">(Tu pojawi siÄ™ lista kontaktĂłw...)</div>
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-settings" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">Ustawienia</p>
                                                            <h4>Edycja danych warsztatu i integracje</h4>
                                                        </header>
                                                        <form id="workshop-settings-form" class="panel-form panel-form--stacked" novalidate>
                                                            <label>Nazwa warsztatu
                                                                <input type="text" name="name" required>
                                                            </label>
                                                            <label>Miasto
                                                                <input type="text" name="city">
                                                            </label>
                                                            <label>Adres
                                                                <input type="text" name="address">
                                                            </label>
                                                            <label>Telefon kontaktowy
                                                                <input type="tel" name="phone">
                                                            </label>
                                                            <label>Adres e-mail
                                                                <input type="email" name="email">
                                                            </label>
                                                            <label>E-mail do faktur
                                                                <input type="email" name="billingEmail">
                                                            </label>
                                                            <label>Cena abonamentu (PLN)
                                                                <input type="number" name="subscriptionAmount" min="0" step="0.01">
                                                            </label>
                                                            <label>DĹ‚ugoĹ›Ä‡ abonamentu (miesiÄ…ce)
                                                                <input type="number" name="subscriptionMonths" min="1">
                                                            </label>
                                                            <label>Data startu umowy
                                                                <input type="date" name="subscriptionStartDate">
                                                            </label>
                                                            <fieldset>
                                                                <legend>Opcje dodatkowe</legend>
                                                                <label><input type="checkbox" name="integrationSms"> Integracja SMS</label>
                                                                <label><input type="checkbox" name="integrationHurtownia"> Integracja z hurtowniÄ…</label>
                                                                <label><input type="checkbox" name="integrationAutodoc"> Integracja z Autodoc</label>
                                                            </fieldset>
                                                            <div class="panel-form__actions panel-form__actions--end">
                                                                <button class="btn btn--secondary" type="submit">Zapisz zmiany</button>
                                                            </div>
                                                        </form>
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-tickets" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">ZgĹ‚oszenia / bilety</p>
                                                            <h4>ObsĹ‚uga zgĹ‚oszeĹ„</h4>
                                                        </header>
                                                        <div id="workshop-detail-tickets">(Tu pojawiÄ… siÄ™ zgĹ‚oszenia...)</div>
                                                    </section>
                                                </div>
                                            </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="panel-view" data-panel="reports">
                    <div class="panel-section panel-section--split">
                        <div class="panel-split">
                            <div class="panel-split__primary panel-card panel-card--surface">
                                <div class="panel-toolbar">
                                    <div>
                                        <p class="panel-section__eyebrow">Historia napraw</p>
                                        <h2>Raporty</h2>
                                    </div>
                                    <p class="panel-section__hint">Wybierz raport z listy, aby edytowac.</p>
                                </div>
                                <form id="report-filter-form" class="panel-filters panel-filters--inline" novalidate>
                                    <label>
                                        Szukaj po VIN
                                        <input type="search" name="vin" placeholder="np. WAUZZZ...">
                                    </label>
                                    <label>
                                        Numer rejestracyjny
                                        <input type="search" name="registration" placeholder="np. WPR 1234">
                                    </label>
                                    <label>
                                        Status weryfikacji
                                        <select name="approval">
                                            <option value="all">Wszystkie</option>
                                            <option value="pending">Oczekujace</option>
                                            <option value="approved">Zatwierdzone</option>
                                            <option value="rejected">Odrzucone</option>
                                        </select>
                                    </label>
                                    <div class="panel-filters__actions">
                                        <button class="btn btn--ghost" type="submit">Filtruj</button>
                                    </div>
                                </form>
                                <div class="panel-list" id="report-list"></div>
                            </div>
                            <aside class="panel-split__aside">
                                <div class="panel-card panel-card--aside">
                                    <p class="panel-section__eyebrow">Panel edycji</p>
                                    <h3>Edycja raportu</h3>
                                    <form id="report-edit-form" class="panel-form" novalidate>
                                        <input type="hidden" name="reportId">
                                        <label>
                                            Numer VIN
                                            <input type="text" name="vin" required>
                                        </label>
                                        <label>
                                            Numer rejestracyjny
                                            <input type="text" name="registrationNumber" placeholder="np. WPR 1234">
                                        </label>
                                            <div class="panel-form__meta panel-form__meta--two">
                                                <label>
                                                    Przebieg (km)
                                                <input type="number" name="mileageKm" min="0" step="1">
                                                </label>
                                                <label>
                                                    Data pierwszej rejestracji
                                                <input type="date" name="firstRegistrationDate">
                                                </label>
                                            </div>
                                        <label>
                                            Status weryfikacji
                                            <select name="approvalStatus" id="report-approval-select">
                                                <option value="pending">Oczekuje na akceptacje</option>
                                                <option value="approved">Zatwierdzony</option>
                                                <option value="rejected">Odrzucony</option>
                                            </select>
                                        </label>
                                        <label>
                                            Opis
                                            <textarea name="summary" rows="4" placeholder="Opis naprawy"></textarea>
                                        </label>
                                            <div class="panel-media-section">
                                                <p class="panel-media-section__title">Zalaczone pliki</p>
                                                <div id="report-media-gallery" class="panel-media-gallery panel-media-gallery--readonly">
                                                    <p class="panel-empty">Brak zalacznikow.</p>
                                                </div>
                                            </div>
                                        <label>
                                            Notatka dla warsztatu
                                            <textarea name="moderationNote" rows="2" placeholder="Powod odrzucenia lub uwagi dodatkowe"></textarea>
                                        </label>
                                        <div class="panel-form__actions">
                                            <button class="btn btn--secondary" type="submit">Zapisz zmiany</button>
                                        </div>
                                    </form>
                                    <p class="panel-feedback" id="report-feedback" aria-live="polite"></p>
                                </div>
                            </aside>
                        </div>
                    </div>
                </section>

                <section class="panel-view" data-panel="settings">
                    <div class="panel-section panel-section--narrow">
                        <div class="panel-card panel-card--form">
                            <header class="panel-section__header">
                                <div>
                                    <p class="panel-section__eyebrow">Konfiguracja</p>
                                    <h2>Ustawienia systemowe</h2>
                                </div>
                                <p class="panel-section__hint">Dotyczy nowych licencji oraz statusow w raportach.</p>
                            </header>
                            <form id="settings-form" class="panel-form panel-form--grid" novalidate>
                                <label>
                                    Dlugosc licencji (miesiace)
                                    <input type="number" name="licenseMonths" min="1" required>
                                </label>
                                <label>
                                    Statusy napraw (oddzielone przecinkiem)
                                    <textarea name="statusOptions" rows="3" placeholder="Przyjeta, W trakcie, Zakonczona"></textarea>
                                </label>
                                <div class="panel-form__actions panel-form__actions--end">
                                    <button class="btn btn--secondary" type="submit">Zapisz ustawienia</button>
                                </div>
                            </form>
                            <p class="panel-feedback" id="settings-feedback" aria-live="polite"></p>
                        </div>
                    </div>
                </section>

                <section class="panel-view" data-panel="logs">
                        <div class="panel-card">
                            <h2>Dziennik zdarzen</h2>
                            <ul class="panel-log panel-log--tall panel-log--audit" id="logs-full"></ul>
                            <button class="btn btn--ghost" id="logs-refresh-btn" type="button">Odswiez logi</button>
                        </div>
                </section>
                    <section class="panel-view panel-view--workshop" data-panel="workshop-home">
                        <div class="panel-section panel-section--summary">
                            <header class="panel-section__header">
                                <div>
                                    <p class="panel-section__eyebrow">Profil warsztatu</p>
                                    <h2>Twoje konto</h2>
                                </div>
                                <p class="panel-section__hint">Podsumowanie licencji i podstawowych danych kontaktowych.</p>
                            </header>
                            <div class="panel-card panel-card--surface panel-card--workshop">
                                <div id="workshop-details" class="workshop-summary"></div>
                            </div>
                        </div>
                        <div class="panel-card panel-card--surface">
                            <h2>Twoje raporty</h2>
                            <div class="panel-list" id="workshop-report-list"></div>
                        </div>
                        <div class="panel-card panel-card--surface">
                            <p class="panel-section__eyebrow">Nowy raport</p>
                            <h2>Dodaj raport serwisowy</h2>
                            <p class="panel-section__hint">Po wyslaniu raport trafi do administratora i oczekuje na akceptacje.</p>
                            <form id="workshop-report-form" class="panel-form" novalidate>
                                <label>
                                    Numer VIN
                                    <input type="text" name="vin" required>
                                </label>
                                <label>
                                    Numer rejestracyjny
                                    <input type="text" name="registrationNumber" required>
                                </label>
                                <label>
                                    Przebieg pojazdu (km)
                                    <input type="number" name="mileageKm" min="0" step="1" required>
                                </label>
                                <label>
                                    Data pierwszej rejestracji
                                    <input type="date" name="firstRegistrationDate" required>
                                </label>
                                <label>
                                    Opis naprawy
                                    <textarea name="summary" rows="3" placeholder="Opis wykonanych prac" required></textarea>
                                </label>
                                <label class="panel-upload">
                                    Zalacz zdjecia lub filmy
                                    <input type="file" name="mediaFiles" accept="image/*,video/*" multiple>
                                    <small>Maks. 5 plikow, po 5 MB kazdy.</small>
                                </label>
                                <ul class="panel-upload__list" id="workshop-media-preview"></ul>
                                <div class="panel-form__actions">
                                    <button class="btn btn--secondary" type="submit">Dodaj raport</button>
                                </div>
                            </form>
                            <p class="panel-feedback" id="workshop-report-feedback" aria-live="polite"></p>
                        </div>
                    </section>
            </main>
        </div>
    </div>

    <aside class="panel-drawer" id="metric-drawer" aria-hidden="true">
        <div class="panel-drawer__header">
            <div>
                <p class="panel-section__eyebrow" id="metric-drawer-eyebrow"></p>
                <h3 id="metric-drawer-title"></h3>
            </div>
            <button class="btn btn--ghost" type="button" id="metric-drawer-close">Zamknij</button>
        </div>
        <p class="panel-drawer__lead" id="metric-drawer-description"></p>
        <div id="metric-drawer-content" class="panel-drawer__content"></div>
    </aside>
    <div class="panel-drawer__backdrop" id="metric-drawer-backdrop" hidden></div>

    <aside class="panel-drawer panel-drawer--form" id="workshop-drawer" aria-hidden="true">
        <div class="panel-drawer__header">
            <div>
                <p class="panel-section__eyebrow" id="workshop-drawer-eyebrow">Nowy warsztat</p>
                <h3 id="workshop-drawer-title">Dodaj warsztat</h3>
            </div>
            <button class="btn btn--ghost" type="button" id="workshop-drawer-close">Zamknij</button>
        </div>
        <form id="create-workshop-form" class="panel-form panel-form--drawer" novalidate>
            <label>
                Nazwa warsztatu
                <input type="text" name="name" required>
            </label>
            <label>
                Miasto
                <input type="text" name="city" placeholder="np. Krakow">
            </label>
            <label>
                Adres
                <input type="text" name="address" placeholder="np. ul. Mechanikow 12">
            </label>
            <label>
                Telefon kontaktowy
                <input type="tel" name="phone" placeholder="np. +48 123 456 789">
            </label>
            <label>
                Adres e-mail
                <input type="email" name="email" placeholder="np. biuro@warsztat.pl">
            </label>
            <label>
                E-mail do faktur
                <input type="email" name="billingEmail" placeholder="np. ksiegowosc@warsztat.pl">
                <small class="panel-form__hint">Opcjonalny adres do korespondencji rozliczeniowej.</small>
            </label>
            <label>
                E-mail logowania
                <input type="email" name="loginEmail" placeholder="np. konto@warsztat.pl" required>
            </label>
            <label>
                Haslo do panelu
                <input type="password" name="loginPassword" placeholder="Minimum 8 znakow">
                <small class="panel-form__hint">Przy dodawaniu nowego warsztatu haslo jest wymagane. Podczas edycji pozostaw puste, aby nie zmieniac.</small>
            </label>
            <label>
                Status
                <select name="status">
                    <option value="active">Aktywny</option>
                    <option value="inactive">Nieaktywny</option>
                    <option value="notice">W okresie wypowiedzenia</option>
                    <option value="deactivated">Dezaktywowany</option>
                </select>
            </label>
            <label>
                Kwota abonamentu (PLN)
                <input type="number" name="subscriptionAmount" min="0" step="0.01" placeholder="np. 299">
            </label>
            <label>
                Data startu abonamentu
                <input type="date" name="subscriptionStartDate">
            </label>
            <label>
                Kwota startowa (proporcjonalna)
                <input type="number" name="subscriptionInitialAmount" min="0" step="0.01" placeholder="np. 149,50">
                <small class="panel-form__hint">Pozwala zapisac pierwsza fakture, gdy umowa zaczyna sie w polowie miesiaca.</small>
            </label>
            <label>
                Opis rozliczenia poczatkowego
                <input type="text" name="subscriptionInitialNote" placeholder="np. 15-31 stycznia">
            </label>
            <label>
                Notatki administracyjne
                <textarea name="notes" rows="3" placeholder="Uwagi widoczne tylko w panelu"></textarea>
            </label>
            <div class="panel-form__actions panel-form__actions--spread">
                <button class="btn btn--ghost" type="button" id="workshop-cancel-edit">Anuluj</button>
                <button class="btn btn--secondary" type="submit" data-workshop-form-submit>Dodaj warsztat</button>
            </div>
        </form>
        <p class="panel-feedback" id="workshop-feedback" aria-live="polite"></p>
    </aside>
    <div class="panel-drawer__backdrop" id="workshop-drawer-backdrop" hidden></div>

    <script src="js/shared/api.js"></script>
    <script src="js/shared/session.js"></script>
    <script src="js/panel/dashboard.js"></script>
</body>
</html>



=== PLIK: panel-warsztatu.html ===

<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Warsztatu â€˘ Warsztat+</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root { --p:#2563eb; --s:#10b981; --d:#ef4444; }
    body { margin:0; font-family:'Segoe UI',sans-serif; background:#f4f6f9; display:flex; min-height:100vh; color:#1f2937; }
    .sidebar { width:280px; background:white; box-shadow:2px 0 15px rgba(0,0,0,0.1); padding:2rem 0; position:fixed; height:100%; z-index:10; }
    .sidebar h2 { margin:0 1.5rem 2rem; color:var(--p); font-size:1.8rem; }
    .sidebar a { display:block; padding:1rem 1.5rem; color:#374151; text-decoration:none; font-weight:500; border-left:4px solid transparent; cursor:pointer; }
    .sidebar a:hover, .sidebar a.active { background:#eff6ff; color:var(--p); border-left-color:var(--p); font-weight:600; }
    .main { margin-left:280px; flex:1; padding:2rem; }
    .content { display:none; }
    .content.active { display:block; }
    .card { background:white; padding:2rem; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.08); }
    .btn-big { background:var(--p); color:white; border:none; padding:1rem 2.5rem; border-radius:12px; font-size:1.2rem; cursor:pointer; font-weight:600; }
    table { width:100%; border-collapse:collapse; margin-top:1rem; }
    th, td { padding:1rem; text-align:left; border-bottom:1px solid #eee; }
    th { background:#f8fafc; }
    .status { padding:0.4rem 1rem; border-radius:50px; color:white; font-size:0.85rem; }
    .status.pending { background:#f59e0b; }
    .status.approved { background:var(--s); }
    .status.rejected { background:var(--d); }
  </style>
</head>
<body>

  <nav class="sidebar">
    <h2>Warsztat+</h2>
    <a data-target="dodaj" class="active">Dodaj raport</a>
    <a data-target="moje">Moje raporty</a>
    <a data-target="dane">Moje dane</a>
    <a data-target="kontakt">Kontakt</a>
    <div style="margin:3rem 1.5rem;">
      <div id="workshop-name" style="font-weight:600;">Ĺadowanie...</div>
      <button onclick="logout()" style="margin-top:1rem; width:100%; background:#ef4444; color:white; border:none; padding:0.8rem; border-radius:8px; cursor:pointer;">Wyloguj siÄ™</button>
    </div>
  </nav>

  <main class="main">
    <div id="dodaj" class="content active">
      <div class="card">
        <h1>Dodaj nowy raport</h1>
        <button class="btn-big" onclick="openAddModal()">+ Dodaj raport naprawy</button>
      </div>
    </div>

    <div id="moje" class="content">
      <div class="card">
        <h1>Moje raporty</h1>
        <div id="reports-container">Ĺadowanie raportĂłw...</div>
      </div>
    </div>

    <div id="dane" class="content">
      <div class="card">
        <h1>Moje dane</h1>
        <p><strong>Nazwa:</strong> <span id="w-name">-</span></p>
        <p><strong>E-mail:</strong> <span id="w-email">-</span></p>
      </div>
    </div>

    <div id="kontakt" class="content">
      <div class="card">
        <h1>Kontakt</h1>
        <p>Formularz kontaktowy dziaĹ‚a przez Formspree</p>
      </div>
    </div>
  </main>

  <!-- MODAL -->
  <div id="add-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:9999;align-items:center;justify-content:center;">
    <div style="background:white;padding:2.5rem;border-radius:16px;width:90%;max-width:560px;">
      <h2>Nowy raport naprawy</h2>
      <form id="add-report-form">
        <input type="text" placeholder="VIN (17 znakĂłw)" maxlength="17" required id="vin" style="width:100%;padding:0.9rem;margin:0.8rem 0;border:1px solid #ddd;border-radius:8px;text-transform:uppercase;">
        <input type="text" placeholder="Nr rejestracyjny" required id="plate" style="width:100%;padding:0.9rem;margin:0.8rem 0;border:1px solid #ddd;border-radius:8px;">
        <input type="text" placeholder="Marka i model" required id="model" style="width:100%;padding:0.9rem;margin:0.8rem 0;border:1px solid #ddd;border-radius:8px;">
        <input type="number" placeholder="Przebieg (km)" required id="mileage" style="width:100%;padding:0.9rem;margin:0.8rem 0;border:1px solid #ddd;border-radius:8px;">
        <textarea placeholder="Opis wykonanych prac..." required rows="5" style="width:100%;padding:0.9rem;margin:0.8rem 0;border:1px solid #ddd;border-radius:8px;"></textarea>
        <div style="display:flex;gap:1rem;margin-top:1.5rem;">
          <button type="submit" class="btn-big" style="flex:1;">WyĹ›lij raport</button>
          <button type="button" onclick="closeAddModal()" style="flex:1;background:#e5e7eb;color:#374151;border:none;border-radius:8px;">Anuluj</button>
        </div>
      </form>
    </div>
  </div>

  <script src="js/shared/session.js"></script>
  <script src="js/shared/api.js"></script>
  <script>
    // Czekamy na API
    (async () => {
      // Czekamy na WarsztatApi
      while (!window.WarsztatApi) await new Promise(r => setTimeout(r, 50));

      const get = window.WarsztatApi.get.bind(window.WarsztatApi);
      const post = window.WarsztatApi.post.bind(window.WarsztatApi);

      // PrzeĹ‚Ä…czanie sekcji
      document.querySelectorAll('.sidebar a[data-target]').forEach(link => {
        link.addEventListener('click', () => {
          document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
          link.classList.add('active');
          document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
          document.getElementById(link.dataset.target).classList.add('active');
        });
      });

      // Globalne funkcje
      window.openAddModal = () => {
        document.getElementById("add-modal").style.display = "flex";
        document.getElementById("vin").focus();
      };
      window.closeAddModal = () => {
        document.getElementById("add-modal").style.display = "none";
        document.getElementById("add-report-form").reset();
      };
      window.logout = () => {
        sessionStorage.clear();
        location.href = "login.html";
      };

      // Dane warsztatu
      try {
        const w = await get("/api/workshops/me");
        document.getElementById("workshop-name").textContent = w.name || w.email || "Warsztat";
        document.getElementById("w-name").textContent = w.name || "-";
        document.getElementById("w-email").textContent = w.email || "-";
      } catch(e) {
        document.getElementById("workshop-name").textContent = "BĹ‚Ä…d poĹ‚Ä…czenia";
      }

      // Raporty
      async function loadReports() {
        try {
          const res = await get("/api/reports/mine");
          const reports = Array.isArray(res) ? res : [];
          const c = document.getElementById("reports-container");
          if (reports.length === 0) return c.innerHTML = "<p>Brak raportĂłw</p>";
          let html = "<table><thead><tr><th>VIN</th><th>Pojazd</th><th>Rejestracja</th><th>Data</th><th>Status</th></tr></thead><tbody>";
          reports.forEach(r => {
            const d = new Date(r.createdAt || r.date);
            const st = r.status === "approved" ? "approved" : r.status === "rejected" ? "rejected" : "pending";
            const txt = r.status === "approved" ? "Zatwierdzony" : r.status === "rejected" ? "Odrzucony" : "OczekujÄ…cy";
            html += `<tr><td><strong>${r.vin}</strong></td><td>${r.model||"-"}</td><td>${r.plate||"-"}</td><td>${d.toLocaleDateString()}</td><td><span class="status ${st}">${txt}</span></td></tr>`;
          });
          c.innerHTML = html + "</tbody></table>";
        } catch(e) {
          document.getElementById("reports-container").innerHTML = "<p style='color:red'>BĹ‚Ä…d: Backend nie odpowiada (404)</p><p>Uruchom: <code>cd server && npm run dev</code></p>";
        }
      }

      // Dodaj raport
      document.getElementById("add-report-form").addEventListener("submit", async e => {
        e.preventDefault();
        const vin = document.getElementById("vin").value.trim().toUpperCase();
        const plate = document.getElementById("plate").value.trim().toUpperCase();
        const model = document.getElementById("model").value.trim() || "Nie podano";
        const mileage = Number(document.getElementById("mileage").value);
        const description = e.target.querySelector("textarea").value.trim();

        if (vin.length !== 17) return alert("VIN musi mieÄ‡ 17 znakĂłw!");
        if (!plate || !mileage || !description) return alert("WypeĹ‚nij wszystkie pola!");

        try {
          await post("/api/reports/mine", { vin, plate, model, mileage, description });
          alert("Raport dodany!");
          closeAddModal();
          loadReports();
        } catch(err) {
          alert("BĹ‚Ä…d backendu â€“ sprawdĹş czy serwer dziaĹ‚a na porcie 4000");
        }
      });

      loadReports();
    })();
  </script>
  <script>
// RÄCZNE PROXY â€“ dziaĹ‚a nawet bez bs-config.json
(function() {
  const originalFetch = window.fetch;
  window.fetch = function(resource, options = {}) {
    let url = resource;
    if (typeof resource === 'string' && resource.startsWith('/api/')) {
      url = 'http://localhost:4000' + resource;
    }
    return originalFetch(url, options);
  };
})();
</script>
</body>
</html>


=== PLIK: package.json ===

{
  "name": "czysta-strona",
  "version": "1.0.0",
  "description": "This project is a simple one-page application that serves as a template for creating a single-page website. It includes basic sections such as a header, content area, and footer.",
  "main": "index.js",
  "scripts": {
    "start": "npm run serve",
    "serve": "lite-server",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/bronek312/warsztat.git"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "module",
  "bugs": {
    "url": "https://github.com/bronek312/warsztat/issues"
  },
  "homepage": "https://github.com/bronek312/warsztat#readme",
  "devDependencies": {
    "lite-server": "^2.6.1"
  }
}



=== PLIK: bs-config.cjs ===

module.exports = {
    port: 3000,
    host: 'localhost',
    files: ['./**/*.{html,htm,css,js}'],
    watchOptions: {
        ignored: 'node_modules'
    },
    server: {
        baseDir: './'
    }
};



=== PLIK: js/shared/api.js ===

(function (window) {
    const guessBaseUrl = () => {
        if (window.__WARSZTAT_API_BASE__) {
            return window.__WARSZTAT_API_BASE__;
        }
        const origin = window.location.origin;
        const devMatch = origin.match(/:(3\d{3})$/);
        if (devMatch) {
            return origin.replace(/:(3\d{3})$/, ':4000') + '/api';
        }
        return `${origin}/api`;
    };

    let baseUrl = guessBaseUrl().replace(/\/$/, '');
    let authToken = null;

    const isFormData = (value) => typeof FormData !== 'undefined' && value instanceof FormData;

    async function request(path, options = {}) {
        const url = `${baseUrl}${path.startsWith('/') ? path : `/${path}`}`;
        const headers = { ...(options.headers || {}) };
        let body = options.body;

        if (body && !isFormData(body)) {
            headers['Content-Type'] = 'application/json';
            body = JSON.stringify(body);
        }

        const requiresAuth = options.auth !== false;
        if (requiresAuth && authToken) {
            headers.Authorization = `Bearer ${authToken}`;
        }

        const response = await fetch(url, {
            method: options.method || 'GET',
            headers,
            body
        });

        const contentType = response.headers.get('content-type') || '';
        const isJson = contentType.includes('application/json');

        if (!response.ok) {
            const errorPayload = isJson ? await response.json().catch(() => null) : null;
            const error = new Error(errorPayload?.message || 'Request failed');
            error.status = response.status;
            error.details = errorPayload;
            throw error;
        }

        if (response.status === 204) {
            return null;
        }

        return isJson ? response.json() : response.text();
    }

    window.WarsztatApi = {
        getBaseUrl: () => baseUrl,
        setBaseUrl: (url) => {
            baseUrl = (url || '').replace(/\/$/, '');
        },
        setToken: (token) => {
            authToken = token;
        },
        clearToken: () => {
            authToken = null;
        },
        getToken: () => authToken,
        request,
        get: (path, options = {}) => request(path, { ...options, method: 'GET' }),
        post: (path, body, options = {}) => request(path, { ...options, method: 'POST', body }),
        patch: (path, body, options = {}) => request(path, { ...options, method: 'PATCH', body }),
        delete: (path, options = {}) => request(path, { ...options, method: 'DELETE' })
    };
})(window);



=== PLIK: js/shared/reports.js ===

(function (window) {
    const REPORTS_KEY = 'warsztat:reports';
    const APPROVAL_STATES = {
        pending: 'pending',
        approved: 'approved',
        rejected: 'rejected'
    };
    const sampleReports = [
        {
            id: 1,
            vin: 'WAUZZZ8V9JA123456',
            registrationNumber: 'WX1234K',
            workshopId: 'wrk_demo_1',
            mileageKm: 183500,
            firstRegistrationDate: '2018-05-12',
            workshop: 'Auto Serwis 24',
            status: 'Zakonczona',
            updatedAt: '2024-11-18T10:00:00.000Z',
            summary: 'Wymiana rozrzadu oraz oleju.',
            approvalStatus: APPROVAL_STATES.approved,
            media: [
                {
                    id: 'med_demo_1',
                    name: 'silnik-po.jpg',
                    type: 'image/jpeg',
                    size: 102400,
                    dataUrl: '',
                    description: 'Silnik po naprawie'
                }
            ]
        },
        {
            id: 2,
            vin: 'VF3LCBHY6HS789012',
            registrationNumber: 'KR5GS89',
            workshopId: 'wrk_demo_2',
            mileageKm: 99500,
            firstRegistrationDate: '2019-03-22',
            workshop: 'MotorTech Pro',
            status: 'W trakcie',
            updatedAt: '2025-01-05T08:30:00.000Z',
            summary: 'Diagnostyka elektroniki silnika.',
            approvalStatus: APPROVAL_STATES.approved,
            media: []
        }
    ];

    const normalizeMileage = (value) => {
        const mileage = Number(value);
        return Number.isFinite(mileage) && mileage >= 0 ? Math.round(mileage) : null;
    };

    const normalizeFirstRegistration = (value) => {
        if (!value) {
            return null;
        }
        try {
            const date = new Date(value);
            if (Number.isNaN(date.getTime())) {
                return String(value);
            }
            return date.toISOString().split('T')[0];
        } catch (error) {
            return String(value);
        }
    };

    const normalizeMediaItem = (item, index = 0) => {
        if (!item || typeof item !== 'object') {
            return null;
        }
        return {
            id: item.id || `media_${Date.now()}_${index}`,
            name: item.name || 'Zalacznik',
            type: item.type || 'application/octet-stream',
            size: Number(item.size) || 0,
            dataUrl: item.dataUrl || '',
            description: item.description || '',
            createdAt: item.createdAt || new Date().toISOString()
        };
    };

    const safeParse = (value) => {
        try {
            return JSON.parse(value) || [];
        } catch (error) {
            console.warn('Nie udalo sie odczytac raportow', error);
            return [];
        }
    };

    const normalizeReport = (report, index = 0) => {
        if (!report) {
            return report;
        }
        const createdAt = report.createdAt || report.updatedAt || new Date().toISOString();
        const updatedAt = report.updatedAt || createdAt;
        const approvalStatus = report.approvalStatus || APPROVAL_STATES.pending;
        const registrationNumber = (report.registrationNumber || '').toUpperCase();
        return {
            id: report.id || Date.now() + index,
            vin: report.vin || 'NIEZNANY VIN',
            workshop: report.workshop || 'Nieznany warsztat',
            workshopId: report.workshopId || null,
            registrationNumber,
            mileageKm: normalizeMileage(report.mileageKm),
            firstRegistrationDate: normalizeFirstRegistration(report.firstRegistrationDate),
            status: report.status || 'W trakcie',
            summary: report.summary || '',
            createdAt,
            updatedAt,
            approvalStatus,
            moderationNote: report.moderationNote || '',
            moderatedAt: report.moderatedAt || (approvalStatus !== APPROVAL_STATES.pending ? updatedAt : null),
            moderatedBy: report.moderatedBy || null,
            media: Array.isArray(report.media)
                ? report.media.map((item, mediaIndex) => normalizeMediaItem(item, mediaIndex)).filter(Boolean)
                : []
        };
    };

    const saveReports = (items) => {
        localStorage.setItem(REPORTS_KEY, JSON.stringify(items));
    };

    const ensureSeeded = () => {
        if (localStorage.getItem(REPORTS_KEY)) {
            return;
        }
        saveReports(sampleReports);
    };

    const getAllReports = () => {
        const raw = safeParse(localStorage.getItem(REPORTS_KEY));
        const normalized = raw.map((report, index) => normalizeReport(report, index));
        saveReports(normalized);
        return normalized;
    };

    const findByVin = (vin) => getAllReports().filter((item) => item.vin === vin);

    const findById = (id) => getAllReports().find((item) => item.id === id);

    const updateReport = (id, updates) => {
        const reports = getAllReports();
        const index = reports.findIndex((item) => item.id === id);
        if (index === -1) {
            throw new Error('Nie znaleziono raportu.');
        }
        const previous = reports[index];
        const approvalChanged =
            typeof updates.approvalStatus !== 'undefined' && updates.approvalStatus !== previous.approvalStatus;
        reports[index] = normalizeReport(
            {
                ...previous,
                ...updates,
                updatedAt: updates.updatedAt || new Date().toISOString(),
                moderatedAt: approvalChanged ? new Date().toISOString() : previous.moderatedAt,
                moderatedBy: approvalChanged ? updates.moderatedBy || previous.moderatedBy : previous.moderatedBy
            },
            index
        );
        saveReports(reports);
        return reports[index];
    };

    const createReport = (payload) => {
        const reports = getAllReports();
        const now = new Date().toISOString();
        const report = normalizeReport({
            ...payload,
            id: Date.now(),
            createdAt: now,
            updatedAt: now,
            approvalStatus: APPROVAL_STATES.pending
        });
        reports.push(report);
        saveReports(reports);
        return report;
    };

    const moderateReport = (id, { approvalStatus, moderationNote, actor }) =>
        updateReport(id, {
            approvalStatus,
            moderationNote,
            moderatedBy: actor
        });

    window.WarsztatReports = {
        ensureSeeded,
        findByVin,
        getAll: getAllReports,
        getById: findById,
        update: updateReport,
        create: createReport,
        moderate: moderateReport,
        APPROVAL_STATES
    };
})(window);



=== PLIK: js/shared/workshops.js ===

(function (window) {
    const STORAGE_KEY = 'warsztat:workshops';
    const DEFAULT_LICENSE_MONTHS = 12;
    const CONTRACT_MONTHS = 12;
    const TERMINATION_NOTICE_MONTHS = 3;

    const safeParse = (value) => {
        try {
            return JSON.parse(value) || [];
        } catch (error) {
            console.warn('Blad podczas odczytu warsztatow', error);
            return [];
        }
    };

    const endOfMonth = (date) => {
        const result = new Date(date.getFullYear(), date.getMonth() + 1, 0);
        result.setHours(23, 59, 59, 999);
        return result.toISOString();
    };

    const addMonths = (isoDate, months) => {
        const date = isoDate ? new Date(isoDate) : new Date();
        const originalDay = date.getDate();
        date.setMonth(date.getMonth() + months);
        if (date.getDate() < originalDay) {
            date.setDate(0);
        }
        return date.toISOString();
    };

    const calculateTerminationEnd = (noticeDate) => {
        const notice = noticeDate ? new Date(noticeDate) : new Date();
        notice.setMonth(notice.getMonth() + TERMINATION_NOTICE_MONTHS);
        return endOfMonth(notice);
    };

    const applyContractRules = (workshop) => {
        if (!workshop) {
            return workshop;
        }
        const now = Date.now();
        const fixedEndTime = workshop.contractFixedEnd ? new Date(workshop.contractFixedEnd).getTime() : 0;
        if (!workshop.contractIndefiniteSince && fixedEndTime && now >= fixedEndTime) {
            workshop.contractIndefiniteSince = workshop.contractFixedEnd;
        }

        const hasIndefinite = Boolean(workshop.contractIndefiniteSince);

        if (workshop.terminationNoticeDate) {
            const terminationEnd = workshop.terminationEndDate || calculateTerminationEnd(workshop.terminationNoticeDate);
            workshop.terminationEndDate = terminationEnd;
            const terminationEndTime = new Date(terminationEnd).getTime();
            if (now >= terminationEndTime) {
                workshop.active = false;
                workshop.contractStatus = 'terminated';
                workshop.terminatedAt = workshop.terminatedAt || terminationEnd;
            } else {
                workshop.contractStatus = 'notice';
            }
        } else if (!workshop.active) {
            workshop.contractStatus = hasIndefinite ? 'indefinite' : 'fixed';
        } else if (hasIndefinite) {
            workshop.contractStatus = 'indefinite';
        } else {
            workshop.contractStatus = 'fixed';
        }

        return workshop;
    };

    const normalizeWorkshop = (item) => {
        if (!item) {
            return item;
        }
        const licenseStart = item.licenseStart || item.createdAt || new Date().toISOString();
        const licenseEnd = item.licenseEnd || addMonths(licenseStart, DEFAULT_LICENSE_MONTHS);
        const contractFixedEnd = item.contractFixedEnd || addMonths(licenseStart, CONTRACT_MONTHS);
        const normalized = {
            ...item,
            active: item.active !== false,
            createdAt: item.createdAt || new Date().toISOString(),
            licenseStart,
            licenseEnd,
            billingAmount: Number(item.billingAmount) || 0,
            contractFixedEnd,
            contractIndefiniteSince: item.contractIndefiniteSince || null,
            terminationNoticeDate: item.terminationNoticeDate || null,
            terminationEndDate: item.terminationEndDate || null,
            contractStatus: item.contractStatus || 'fixed',
            terminatedAt: item.terminatedAt || null
        };
        return applyContractRules(normalized);
    };

    const readAll = () => {
        const raw = safeParse(localStorage.getItem(STORAGE_KEY));
        let mutated = false;
        const normalized = raw.map((item) => {
            const result = normalizeWorkshop(item);
            if (!mutated && JSON.stringify(result) !== JSON.stringify(item)) {
                mutated = true;
            }
            return result;
        });
        if (mutated) {
            saveAll(normalized);
        }
        return normalized;
    };

    const saveAll = (items) => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
    };

    const existsByEmail = (email) => readAll().some((item) => item.email === email);

    const createWorkshop = (payload, options = {}) => {
        const workshops = readAll();
        if (workshops.some((item) => item.email === payload.email)) {
            throw new Error('Warsztat z tym adresem e-mail juz istnieje.');
        }

        const now = new Date().toISOString();
        const licenseMonths = options.licenseMonths || DEFAULT_LICENSE_MONTHS;
        const workshop = normalizeWorkshop({
            id: Date.now(),
            name: payload.name,
            email: payload.email,
            registration: payload.registration,
            password: payload.password,
            active: true,
            createdAt: now,
            licenseStart: now,
            licenseEnd: addMonths(now, licenseMonths),
            billingAmount: Number(payload.billingAmount) || 0
        });

        workshops.push(workshop);
        saveAll(workshops);
        return workshops;
    };

    const applyUpdate = (id, updater) => {
        const workshops = readAll();
        const index = workshops.findIndex((item) => item.id === id);
        if (index === -1) {
            throw new Error('Nie znaleziono warsztatu.');
        }
        const updated = normalizeWorkshop(updater({ ...workshops[index] }));
        workshops[index] = updated;
        saveAll(workshops);
        return workshops;
    };

    const extendLicense = (id, months) =>
        applyUpdate(id, (item) => ({
            ...item,
            licenseEnd: addMonths(item.licenseEnd, months)
        }));

    const toggleActive = (id, isActive) =>
        applyUpdate(id, (item) => ({
            ...item,
            active: isActive
        }));

    const issueTerminationNotice = (id, noticeDate = new Date().toISOString()) =>
        applyUpdate(id, (item) => {
            if (item.contractStatus !== 'indefinite') {
                throw new Error('Umowa nie jest na czas nieokreslony.');
            }
            const terminationNoticeDate = noticeDate;
            const terminationEndDate = calculateTerminationEnd(terminationNoticeDate);
            return {
                ...item,
                terminationNoticeDate,
                terminationEndDate,
                contractStatus: 'notice'
            };
        });

    const cancelTerminationNotice = (id) =>
        applyUpdate(id, (item) => {
            if (!item.terminationNoticeDate) {
                return item;
            }
            return {
                ...item,
                terminationNoticeDate: null,
                terminationEndDate: null,
                terminatedAt: null,
                contractStatus: item.contractIndefiniteSince ? 'indefinite' : 'fixed'
            };
        });

    const resetPassword = (id, newPassword) =>
        applyUpdate(id, (item) => ({
            ...item,
            password: newPassword
        }));

    const updateWorkshop = (id, updates) =>
        applyUpdate(id, (item) => ({
            ...item,
            ...updates
        }));

    const findByCredentials = (email, password) =>
        readAll().find((item) => item.email === email && item.password === password);

    const getContractState = (workshopId) => {
        const current = readAll().find((item) => item.id === workshopId);
        return current ? { ...current } : null;
    };

    window.WarsztatWorkshops = {
        getAll: readAll,
        create: createWorkshop,
        existsByEmail,
        findByCredentials,
        extendLicense,
        toggleActive,
        issueTermination: issueTerminationNotice,
        cancelTermination: cancelTerminationNotice,
        resetPassword,
        update: updateWorkshop,
        getContractState
    };
})(window);



=== PLIK: js/shared/session.js ===

(function (window) {
    const SESSION_KEY = 'warsztat:session';

    const readSession = () => {
        try {
            return JSON.parse(sessionStorage.getItem(SESSION_KEY));
        } catch (error) {
            return null;
        }
    };

    const persistSession = (session) => {
        if (!session) {
            sessionStorage.removeItem(SESSION_KEY);
            return;
        }
        sessionStorage.setItem(SESSION_KEY, JSON.stringify(session));
    };

    const syncApiToken = (token) => {
        if (!window.WarsztatApi) {
            return;
        }
        if (token) {
            window.WarsztatApi.setToken(token);
        } else {
            window.WarsztatApi.clearToken();
        }
    };

    const current = readSession();
    if (current?.token) {
        syncApiToken(current.token);
    }

    window.WarsztatSession = {
        save: (session) => {
            persistSession(session);
            syncApiToken(session?.token);
        },
        get: readSession,
        clear: () => {
            persistSession(null);
            syncApiToken(null);
        },
        getToken: () => readSession()?.token || null
    };
})(window);



=== PLIK: js/shared/settings.js ===

(function (window) {
    const SETTINGS_KEY = 'warsztat:settings';
    const DEFAULTS = {
        licenseMonths: 12,
        statusOptions: ['Przyjeta', 'W trakcie', 'Zakonczona']
    };

    const safeParse = (value) => {
        try {
            return JSON.parse(value) || {};
        } catch (error) {
            console.warn('Blad podczas odczytu ustawien', error);
            return {};
        }
    };

    const mergeObjects = (base = {}, patch = {}) => {
        const result = { ...base };
        Object.keys(patch).forEach((key) => {
            const value = patch[key];
            if (Array.isArray(value)) {
                result[key] = [...value];
                return;
            }
            if (value && typeof value === 'object') {
                result[key] = mergeObjects(base[key] || {}, value);
                return;
            }
            result[key] = value;
        });
        return result;
    };

    const getSettings = () => mergeObjects(DEFAULTS, safeParse(localStorage.getItem(SETTINGS_KEY)));

    const saveSettings = (settings) => {
        localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
    };

    const updateSettings = (partial) => {
        const merged = mergeObjects(getSettings(), partial);
        saveSettings(merged);
        return merged;
    };

    window.WarsztatSettings = {
        get: getSettings,
        save: saveSettings,
        update: updateSettings,
        DEFAULTS
    };
})(window);



=== PLIK: js/shared/logs.js ===

(function (window) {
    const LOGS_KEY = 'warsztat:logs';

    const safeParse = (value) => {
        try {
            return JSON.parse(value) || [];
        } catch (error) {
            console.warn('Blad podczas odczytu logow', error);
            return [];
        }
    };

    const readLogs = () => safeParse(localStorage.getItem(LOGS_KEY));

    const saveLogs = (items) => {
        localStorage.setItem(LOGS_KEY, JSON.stringify(items));
    };

    const addLog = (entry) => {
        const logs = readLogs();
        logs.unshift({ id: Date.now(), timestamp: new Date().toISOString(), ...entry });
        saveLogs(logs.slice(0, 200));
        return logs;
    };

    window.WarsztatLogs = {
        getAll: readLogs,
        add: addLog,
        clear: () => saveLogs([])
    };
})(window);



=== PLIK: js/panel/dashboard.js ===

(function () {
    const LOGIN_URL = 'login.html';
    const APPROVAL_META = {
        pending: { label: 'Oczekuje na akceptacje', className: 'panel-tag--warning' },
        approved: { label: 'Zatwierdzony', className: 'panel-tag--success' },
        rejected: { label: 'Odrzucony', className: 'panel-tag--danger' }
    };
    const WORKSHOP_STATUS_META = {
        active: { label: 'Aktywny', className: 'panel-tag--success' },
        inactive: { label: 'Nieaktywny', className: 'panel-tag--muted' },
        notice: { label: 'W okresie wypowiedzenia', className: 'panel-tag--notice' },
        deactivated: { label: 'Dezaktywowany', className: 'panel-tag--danger' }
    };

    const formatDateTime = (value) => {
        if (!value) {
            return 'â€”';
        }
        try {
            return new Date(value).toLocaleString('pl-PL', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        } catch (error) {
            return value;
        }
    };

    const formatShortDate = (value) => {
        if (!value) {
            return 'â€”';
        }
        try {
            return new Date(value).toLocaleDateString('pl-PL', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        } catch (error) {
            return value;
        }
    };

    const formatBillingMonth = (value) => {
        if (!value) {
            return 'Brak miesiaca';
        }
        const [year, month] = String(value)
            .split('-')
            .map((chunk) => Number(chunk));
        if (!year || !month) {
            return value;
        }
        try {
            const date = new Date(Date.UTC(year, month - 1, 1));
            return date.toLocaleDateString('pl-PL', { year: 'numeric', month: 'long' });
        } catch (error) {
            return value;
        }
    };

    const formatMileage = (value) => {
        if (value === null || typeof value === 'undefined') {
            return 'Brak danych';
        }
        const mileage = Number(value);
        if (!Number.isFinite(mileage) || mileage < 0) {
            return 'Brak danych';
        }
        return `${mileage.toLocaleString('pl-PL')} km`;
    };

    const formatCurrency = (value, currency = 'PLN') => {
        const amount = Number(value);
        if (!Number.isFinite(amount)) {
            return 'Brak danych';
        }
        try {
            return new Intl.NumberFormat('pl-PL', {
                style: 'currency',
                currency,
                minimumFractionDigits: 2
            }).format(amount);
        } catch (error) {
            return `${amount.toFixed(2)} ${currency}`;
        }
    };

    const getWorkshopInitials = (name) => {
        if (!name) {
            return 'W+';
        }
        const parts = String(name)
            .trim()
            .split(/\s+/)
            .filter((chunk) => chunk && /^[a-zA-ZÄ…Ä‡Ä™Ĺ‚Ĺ„ĂłĹ›ĹşĹĽÄ„Ä†ÄĹĹĂ“ĹšĹąĹ»]/.test(chunk))
            .slice(0, 2)
            .map((chunk) => chunk[0]?.toUpperCase())
            .filter(Boolean);
        return parts.length ? parts.join('') : 'W+';
    };

    const addMonths = (value, months) => {
        if (!value || !Number.isFinite(months)) {
            return null;
        }
        const date = new Date(value.getTime());
        date.setMonth(date.getMonth() + months);
        return date;
    };

    const monthsBetweenDates = (futureDate, baseDate = new Date()) => {
        if (!futureDate || !baseDate) {
            return null;
        }
        const years = futureDate.getFullYear() - baseDate.getFullYear();
        const months = futureDate.getMonth() - baseDate.getMonth();
        const totalMonths = years * 12 + months;
        const adjust = futureDate.getDate() >= baseDate.getDate() ? 0 : -1;
        return Math.max(0, totalMonths + adjust);
    };

    const getWorkshopLicenseSummary = (workshop) => {
        const licenseSetting = Number(state.settings?.licenseMonths);
        const startedAt = toDate(workshop.licenseStartedAt);
        const expiresAt = toDate(workshop.licenseExpiresAt) || (startedAt && addMonths(startedAt, licenseSetting));
        const noticeEndsAt = toDate(workshop.noticeEndsAt);
        const remainingMonths = expiresAt ? monthsBetweenDates(expiresAt) : null;
        return {
            expiresLabel: expiresAt ? formatShortDate(expiresAt) : null,
            remainingMonths,
            noticeEndsLabel: noticeEndsAt ? formatShortDate(noticeEndsAt) : null
        };
    };

    const toDate = (value) => {
        if (!value) {
            return null;
        }
        try {
            return new Date(value);
        } catch (error) {
            return null;
        }
    };

    const isSameDay = (value, reference = new Date()) => {
        const date = toDate(value);
        if (!date) {
            return false;
        }
        return (
            date.getFullYear() === reference.getFullYear() &&
            date.getMonth() === reference.getMonth() &&
            date.getDate() === reference.getDate()
        );
    };

    const daysBetween = (newer, older) => {
        if (!newer || !older) {
            return Infinity;
        }
        const ms = newer.getTime() - older.getTime();
        return Math.floor(ms / (1000 * 60 * 60 * 24));
    };

    const sortByDateDesc = (items, selector) =>
        [...items].sort((a, b) => {
            const left = toDate(selector(a))?.getTime() || 0;
            const right = toDate(selector(b))?.getTime() || 0;
            return right - left;
        });

    const setFeedback = (element, message, type) => {
        if (!element) {
            return;
        }
        element.textContent = message;
        element.classList.remove('is-error', 'is-success');
        if (type) {
            element.classList.add(type === 'error' ? 'is-error' : 'is-success');
        }
    };

    const handleAuthError = (error) => {
        if (error?.status === 401 || error?.status === 403) {
            window.WarsztatSession?.clear();
            window.location.href = LOGIN_URL;
            return true;
        }
        return false;
    };

    const normalizeString = (value) => String(value ?? '').trim();
    const toNullable = (value) => {
        const normalized = normalizeString(value);
        return normalized.length ? normalized : null;
    };
    const toOptional = (value) => {
        const normalized = normalizeString(value);
        return normalized.length ? normalized : undefined;
    };
    const toEmail = (value) => {
        const normalized = normalizeString(value).toLowerCase();
        return normalized.length ? normalized : null;
    };
    const toDateOnly = (value) => {
        const normalized = normalizeString(value);
        return normalized.length ? normalized : null;
    };
    const toMoneyValue = (value) => {
        if (value === null || typeof value === 'undefined') {
            return null;
        }
        const normalized = normalizeString(String(value).replace(',', '.'));
        if (!normalized) {
            return null;
        }
        const amount = Number(normalized);
        return Number.isFinite(amount) ? Number(amount.toFixed(2)) : null;
    };
    const toDateInputValue = (value) => {
        const date = toDate(value);
        if (!date) {
            return '';
        }
        return date.toISOString().slice(0, 10);
    };

    const state = {
        reports: [],
        media: [],
        news: [],
        workshops: [],
        settings: null,
        logs: [],
        filters: {
            vin: '',
            registration: '',
            approval: 'all'
        },
        workshopFilters: {
            query: '',
            status: 'all'
        },
        selectedReportId: null,
        editingWorkshopId: null,
        focusedWorkshopId: null,
        workshopDetailRecord: null,
        workshopDetails: null,
        workshopReports: [],
        workshopUploads: [],
        workshopUploadWarning: false,
        workshopDetailViewActive: false,
        workshopDetailLoading: false,
        workshopDetailError: null,
        workshopBillingEditId: null,
        metricDetails: {},
        metricDrawerKey: null,
        workshopDrawerOpen: false,
        session: null,
        isAdmin: true
    };

    const WORKSHOP_TOOLBAR_HINT_DEFAULT = 'Wybierz warsztat, aby zobaczyc szczegoly.';
    const elements = {};
    let workshopEventsBound = false;

    const setWorkshopToolbarHint = (message = WORKSHOP_TOOLBAR_HINT_DEFAULT) => {
        if (elements.workshopToolbarHint) {
            elements.workshopToolbarHint.textContent = message;
        }
    };

    const bindDom = () => {
        elements.username = document.getElementById('panel-username');
        elements.role = document.getElementById('panel-role');
        elements.logoutBtn = document.getElementById('logout-btn');
        elements.navButtons = document.querySelectorAll('.panel-nav__link');
        elements.views = document.querySelectorAll('.panel-view');
        elements.metrics = document.getElementById('overview-metrics');
        elements.overviewLogs = document.getElementById('overview-logs');
        elements.adminActions = document.getElementById('admin-actions');
        elements.reportList = document.getElementById('report-list');
        elements.reportFilterForm = document.getElementById('report-filter-form');
        elements.reportEditForm = document.getElementById('report-edit-form');
        elements.reportFeedback = document.getElementById('report-feedback');
        elements.reportMediaGallery = document.getElementById('report-media-gallery');
        elements.workshopList = document.getElementById('workshop-list');
        elements.workshopFilterForm = document.getElementById('workshop-filter-form');
        elements.workshopFilterReset = document.getElementById('workshop-filter-reset');
        elements.workshopAddBtn = document.getElementById('workshop-add-btn');
        elements.workshopToolbarList = document.getElementById('workshop-toolbar-list');
        elements.workshopToolbarDetail = document.getElementById('workshop-toolbar-detail');
        elements.workshopToolbarHint = document.getElementById('workshop-toolbar-hint');
        elements.workshopForm = document.getElementById('create-workshop-form');
        elements.workshopFeedback = document.getElementById('workshop-feedback');
        elements.workshopFormEyebrow = document.getElementById('workshop-drawer-eyebrow');
        elements.workshopFormTitle = document.getElementById('workshop-drawer-title');
        elements.workshopFormSubmit = document.querySelector('[data-workshop-form-submit]');
        elements.workshopCancelBtn = document.getElementById('workshop-cancel-edit');
        elements.workshopDrawer = document.getElementById('workshop-drawer');
        elements.workshopDrawerClose = document.getElementById('workshop-drawer-close');
        elements.workshopDrawerBackdrop = document.getElementById('workshop-drawer-backdrop');
        elements.settingsForm = document.getElementById('settings-form');
        elements.settingsFeedback = document.getElementById('settings-feedback');
        elements.logsContainer = document.getElementById('logs-full');
        elements.logsRefreshBtn = document.getElementById('logs-refresh-btn');
        elements.inactiveWorkshopsList = document.getElementById('inactive-workshops-list');
        elements.workshopDetails = document.getElementById('workshop-details');
        elements.workshopListView = document.getElementById('workshop-browser-list');
        elements.workshopDetailView = document.getElementById('workshop-browser-detail');
        elements.workshopReportList = document.getElementById('workshop-report-list');
        elements.workshopReportForm = document.getElementById('workshop-report-form');
        elements.workshopReportFeedback = document.getElementById('workshop-report-feedback');
        elements.workshopMediaPreview = document.getElementById('workshop-media-preview');
        elements.metricDrawer = document.getElementById('metric-drawer');
        elements.metricDrawerTitle = document.getElementById('metric-drawer-title');
        elements.metricDrawerEyebrow = document.getElementById('metric-drawer-eyebrow');
        elements.metricDrawerDescription = document.getElementById('metric-drawer-description');
        elements.metricDrawerContent = document.getElementById('metric-drawer-content');
        elements.metricDrawerClose = document.getElementById('metric-drawer-close');
        elements.metricDrawerBackdrop = document.getElementById('metric-drawer-backdrop');
        elements.workshopDetailTitle = document.getElementById('workshop-detail-title');
        elements.workshopDetailEyebrow = document.getElementById('workshop-detail-eyebrow');
        elements.workshopDetailBack = document.getElementById('workshop-detail-back');
        elements.workshopDetailOverview = document.getElementById('workshop-detail-overview');
        elements.workshopDetailSubscription = document.getElementById('workshop-detail-subscription');
        elements.workshopDetailFeedback = document.getElementById('workshop-detail-feedback');
        elements.workshopBillingList = document.getElementById('workshop-billing-list');
        elements.workshopBillingForm = document.getElementById('workshop-billing-form');
        elements.workshopBillingFeedback = document.getElementById('workshop-billing-feedback');
    };

    const disableLegacyViews = () => {
        const placeholders = [];
        placeholders.forEach((name) => {
            const view = document.querySelector(`[data-panel="${name}"]`);
            if (view) {
                view.innerHTML = `
                    <div class="panel-card">
                        <p class="panel-empty">Sekcja w przebudowie. Wkrotce dodamy nowe funkcjonalnosci.</p>
                    </div>
                `;
            }
        });
    };

    const renderWorkshopSummary = () => {
        if (!elements.workshopDetails) {
            return;
        }
        if (!state.workshopDetails) {
            elements.workshopDetails.innerHTML = '<p class="panel-empty">Trwa ladowanie profilu warsztatu...</p>';
            return;
        }
        const workshop = state.workshopDetails;
        const meta = WORKSHOP_STATUS_META[workshop.status] || WORKSHOP_STATUS_META.inactive;
        const address = [workshop.city, workshop.address].filter(Boolean).join(' â€˘ ');
        const contact = [workshop.email, workshop.phone].filter(Boolean).join(' â€˘ ');
        const loginEmail = state.session?.user?.email || workshop.loginEmail || workshop.email || 'Brak e-maila logowania';
        const licenseInfo = state.settings?.licenseMonths
            ? `Standardowa licencja: ${state.settings.licenseMonths} miesiecy.`
            : 'Licencja aktywna â€“ brak dodatkowych wymagan.';

        elements.workshopDetails.innerHTML = `
            <div>
                <strong>${workshop.name}</strong>
                <p>${address || 'Brak przypisanego adresu'}</p>
                <div class="workshop-summary__meta">
                    <span class="panel-tag ${meta.className}">${meta.label}</span>
                    <span>${loginEmail}</span>
                    ${contact ? `<span>${contact}</span>` : ''}
                </div>
            </div>
            <div class="workshop-summary__contract">
                <strong>Status licencji</strong>
                <p>${licenseInfo}</p>
                ${workshop.notes ? `<p class="panel-contract-info">${workshop.notes}</p>` : ''}
            </div>
        `;
    };

    const renderWorkshopReportList = () => {
        if (!elements.workshopReportList) {
            return;
        }
        if (!state.workshopReports.length) {
            elements.workshopReportList.innerHTML = '<p class="panel-empty">Nie dodales jeszcze zadnych raportow.</p>';
            return;
        }

        elements.workshopReportList.innerHTML = state.workshopReports
            .map((report) => {
                const approval = APPROVAL_META[report.approvalStatus] || APPROVAL_META.pending;
                const workshopStatus = report.status || 'W trakcie';
                const summary = report.summary || 'Brak opisu naprawy.';
                const note = report.moderationNote
                    ? `<div class="panel-report-note panel-report-note--danger">${report.moderationNote}</div>`
                    : '';
                return `
                <article class="panel-list__item panel-list__item--stacked">
                    <div>
                        <strong>${report.vin || 'Brak VIN'}</strong>
                        <ul class="panel-report-meta">
                            <li>Status warsztatu: ${workshopStatus}</li>
                            <li>Ostatnia aktualizacja: ${formatShortDate(report.updatedAt)}</li>
                            <li>Rejestracja: ${report.registrationNumber || 'Brak danych'}</li>
                        </ul>
                        <p>${summary}</p>
                        ${note}
                    </div>
                    <div class="panel-list__item-actions panel-list__item-actions--compact">
                        <span class="panel-tag ${approval.className}">${approval.label}</span>
                        <small>${report.approvalStatus === 'approved' ? 'Zatwierdzono' : 'Oczekuje na akceptacje'}</small>
                    </div>
                </article>
            `;
            })
            .join('');
    };

    const renderWorkshopUploads = () => {
        if (!elements.workshopMediaPreview) {
            return;
        }
        if (!state.workshopUploads.length) {
            const message = state.workshopUploadWarning
                ? 'Wybrano za duzo plikow. Maksymalnie 5 zalacznikow zostanie zachowanych.'
                : 'Nie wybrano plikow. Zalaczniki beda wysylane w kolejnej iteracji.';
            elements.workshopMediaPreview.innerHTML = `<li class="panel-upload__warning">${message}</li>`;
            return;
        }
        let items = state.workshopUploads
            .map((file) => {
                const sizeMb = Math.max(file.size / (1024 * 1024), 0.01).toFixed(2);
                return `<li><span>${file.name}</span><small>${sizeMb} MB</small></li>`;
            })
            .join('');
        if (state.workshopUploadWarning) {
            items += '<li class="panel-upload__warning">Tylko pierwszych 5 plikow zostalo dodanych.</li>';
        }
        elements.workshopMediaPreview.innerHTML = items;
    };

    const renderMetricDrawer = (detail) => {
        if (!elements.metricDrawer) {
            return;
        }
        elements.metricDrawerTitle.textContent = detail?.title || 'Szczegoly';
        elements.metricDrawerEyebrow.textContent = detail?.eyebrow || '';
        elements.metricDrawerDescription.textContent = detail?.description || '';
        if (!detail?.items?.length) {
            elements.metricDrawerContent.innerHTML = '<p class="panel-empty">Brak danych do wyswietlenia.</p>';
            return;
        }
        elements.metricDrawerContent.innerHTML = detail.items
            .map((item) => {
                const subtitle = item.subtitle ? `<small>${item.subtitle}</small>` : '';
                const meta = item.meta ? `<small>${item.meta}</small>` : '';
                return `
                <div class="panel-drawer__item">
                    <strong>${item.title}</strong>
                    ${subtitle}
                    ${meta}
                </div>
            `;
            })
            .join('');
    };

    const openMetricDrawer = (key) => {
        const detail = state.metricDetails[key];
        if (!detail || !detail.items?.length) {
            return;
        }
        state.metricDrawerKey = key;
        renderMetricDrawer(detail);
        elements.metricDrawer?.classList.add('is-open');
        elements.metricDrawer?.setAttribute('aria-hidden', 'false');
        if (elements.metricDrawerBackdrop) {
            elements.metricDrawerBackdrop.hidden = false;
        }
    };

    const closeMetricDrawer = () => {
        state.metricDrawerKey = null;
        elements.metricDrawer?.classList.remove('is-open');
        elements.metricDrawer?.setAttribute('aria-hidden', 'true');
        if (elements.metricDrawerBackdrop) {
            elements.metricDrawerBackdrop.hidden = true;
        }
    };

    const focusWorkshopFormFirstField = () => {
        const firstField = elements.workshopForm?.querySelector('input, select, textarea');
        if (firstField) {
            window.requestAnimationFrame(() => firstField.focus());
        }
    };

    const openWorkshopDrawer = () => {
        if (!elements.workshopDrawer) {
            return;
        }
        elements.workshopDrawer.classList.add('is-open');
        elements.workshopDrawer.setAttribute('aria-hidden', 'false');
        if (elements.workshopDrawerBackdrop) {
            elements.workshopDrawerBackdrop.hidden = false;
        }
        state.workshopDrawerOpen = true;
        focusWorkshopFormFirstField();
    };

    const closeWorkshopDrawer = () => {
        if (!elements.workshopDrawer) {
            return;
        }
        elements.workshopDrawer.classList.remove('is-open');
        elements.workshopDrawer.setAttribute('aria-hidden', 'true');
        if (elements.workshopDrawerBackdrop) {
            elements.workshopDrawerBackdrop.hidden = true;
        }
        state.workshopDrawerOpen = false;
    };

    const loadWorkshopDashboard = async () => {
        try {
            setFeedback(elements.workshopReportFeedback, 'Ladowanie danych warsztatu...', null);
            const [workshop, reports, settings] = await Promise.all([
                window.WarsztatApi.get('/workshops/me'),
                window.WarsztatApi.get('/reports/mine'),
                window.WarsztatApi.get('/settings')
            ]);
            state.workshopDetails = workshop || null;
            state.workshopReports = Array.isArray(reports) ? reports : [];
            state.settings = settings || state.settings;
            renderWorkshopSummary();
            renderWorkshopReportList();
            setFeedback(elements.workshopReportFeedback, 'Dane zaladowane. Mozesz dodawac raporty.', 'success');
        } catch (error) {
            if (handleAuthError(error)) {
                return;
            }
            const message = error.details?.message || 'Nie udalo sie pobrac danych warsztatu.';
            setFeedback(elements.workshopReportFeedback, message, 'error');
        }
    };

    const bindWorkshopEvents = () => {
        if (workshopEventsBound) {
            return;
        }
        workshopEventsBound = true;

        const mediaInput = elements.workshopReportForm?.querySelector('input[name="mediaFiles"]');
        mediaInput?.addEventListener('change', (event) => {
            const files = Array.from(event.target.files || []);
            const limited = files.slice(0, 5);
            state.workshopUploadWarning = files.length > limited.length;
            state.workshopUploads = limited;
            renderWorkshopUploads();
        });

        elements.workshopReportForm?.addEventListener('submit', async (event) => {
            event.preventDefault();
            const data = new FormData(elements.workshopReportForm);
            const vin = normalizeString(data.get('vin')).toUpperCase();
            const registrationNumber = normalizeString(data.get('registrationNumber')).toUpperCase();
            const summary = String(data.get('summary') || '').trim();
            const firstRegistrationDate = normalizeString(data.get('firstRegistrationDate')) || null;
            const mileageValue = Number(data.get('mileageKm'));
            const mileageKm = Number.isFinite(mileageValue) && mileageValue >= 0 ? mileageValue : null;

            if (!vin) {
                setFeedback(elements.workshopReportFeedback, 'Podaj numer VIN.', 'error');
                return;
            }
            if (!registrationNumber) {
                setFeedback(elements.workshopReportFeedback, 'Podaj numer rejestracyjny.', 'error');
                return;
            }
            if (!firstRegistrationDate) {
                setFeedback(elements.workshopReportFeedback, 'Podaj date pierwszej rejestracji.', 'error');
                return;
            }
            if (summary.length < 10) {
                setFeedback(elements.workshopReportFeedback, 'Opis powinien miec co najmniej 10 znakow.', 'error');
                return;
            }

            const payload = {
                vin,
                registrationNumber,
                mileageKm,
                firstRegistrationDate,
                summary,
                status: 'W trakcie'
            };

            try {
                setFeedback(elements.workshopReportFeedback, 'Wysylanie raportu...', null);
                const report = await window.WarsztatApi.post('/reports/mine', payload);
                state.workshopReports = [report, ...state.workshopReports];
                elements.workshopReportForm?.reset();
                state.workshopUploads = [];
                state.workshopUploadWarning = false;
                renderWorkshopUploads();
                renderWorkshopReportList();
                setFeedback(elements.workshopReportFeedback, 'Raport przekazany do administratora.', 'success');
            } catch (error) {
                if (handleAuthError(error)) {
                    return;
                }
                const message = error.details?.message || 'Nie udalo sie zapisac raportu.';
                setFeedback(elements.workshopReportFeedback, message, 'error');
            }
        });
    };

    const handleMetricClick = (event) => {
        const trigger = event.target.closest('[data-metric-key]');
        if (!trigger) {
            return;
        }
        if (!trigger.classList.contains('metric-card--action')) {
            return;
        }
        const key = trigger.dataset.metricKey;
        if (!key) {
            return;
        }
        openMetricDrawer(key);
    };

    const handleDrawerKeydown = (event) => {
        if (event.key !== 'Escape') {
            return;
        }
        if (state.metricDrawerKey) {
            closeMetricDrawer();
            return;
        }
        if (state.workshopDetailViewActive) {
            hideWorkshopDetailView();
            return;
        }
        if (state.workshopDrawerOpen) {
            closeWorkshopDrawer();
            resetWorkshopForm();
            setFeedback(elements.workshopFeedback, '', null);
        }
    };

    const activateWorkshopMode = (session) => {
        document.body.classList.add('panel-body--workshop');
        elements.navButtons?.forEach((btn) => {
            btn.style.display = 'none';
        });
        elements.views?.forEach((view) => {
            const isWorkshopView = view.dataset.panel === 'workshop-home';
            view.classList.toggle('is-active', isWorkshopView);
            if (!isWorkshopView) {
                view.remove();
            }
        });

        if (elements.username) {
            elements.username.textContent = session.user?.email || 'Warsztat';
        }
        if (elements.role) {
            elements.role.textContent = 'Warsztat';
        }

        bindWorkshopEvents();
        renderWorkshopSummary();
        renderWorkshopReportList();
        renderWorkshopUploads();
        loadWorkshopDashboard();
    };

    const activateView = (target) => {
        const alreadyActive = elements.navButtons
            ? Array.from(elements.navButtons).some(
                  (btn) => btn.dataset.panelTarget === target && btn.classList.contains('is-active')
              )
            : false;
        if (!alreadyActive) {
            elements.navButtons?.forEach((btn) => {
                btn.classList.toggle('is-active', btn.dataset.panelTarget === target);
            });
            elements.views?.forEach((view) => {
                view.classList.toggle('is-active', view.dataset.panel === target);
            });
        }

        if (target !== 'workshops' && state.workshopDrawerOpen) {
            closeWorkshopDrawer();
            resetWorkshopForm();
            setFeedback(elements.workshopFeedback, '', null);
        }
        if (target !== 'workshops' && state.workshopDetailViewActive) {
            hideWorkshopDetailView();
        }
    };

    const applyFilters = () => {
        const vinFilter = state.filters.vin.trim().toUpperCase();
        const regFilter = state.filters.registration.trim().toUpperCase();
        const approvalFilter = state.filters.approval;
        return state.reports.filter((report) => {
            const matchesVin = vinFilter ? report.vin?.includes(vinFilter) : true;
            const matchesReg = regFilter ? report.registrationNumber?.includes(regFilter) : true;
            const matchesApproval = approvalFilter === 'all' ? true : report.approvalStatus === approvalFilter;
            return matchesVin && matchesReg && matchesApproval;
        });
    };

    const renderOverview = () => {
        if (!elements.metrics) {
            return;
        }
        const metrics = buildOverviewMetrics();
        elements.metrics.innerHTML = metrics
            .map((metric) => {
                const tag = metric.clickable ? 'button' : 'article';
                const attrs = metric.clickable
                    ? `type="button" class="metric-card metric-card--action" data-metric-key="${metric.key}"`
                    : `class="metric-card" data-metric-key="${metric.key}"`;
                return `
                <${tag} ${attrs}>
                    <strong>${metric.value}</strong>
                    <p>${metric.label}</p>
                    <small>${metric.detail}</small>
                </${tag}>
            `;
            })
            .join('');

        if (elements.overviewLogs) {
            elements.overviewLogs.innerHTML = '<li class="panel-empty">Logi pojawia sie po wdrozeniu modulu audytu.</li>';
        }
        if (elements.adminActions) {
            elements.adminActions.innerHTML = '<li class="panel-empty">Lista akcji administratorow wkrotce bedzie dostepna.</li>';
        }

        renderInactiveWorkshops();
    };

    const renderReportList = () => {
        if (!elements.reportList) {
            return;
        }
        const filtered = applyFilters();
        if (!filtered.length) {
            elements.reportList.innerHTML = '<p class="panel-empty">Brak raportow spelniajacych kryteria.</p>';
            return;
        }
        elements.reportList.innerHTML = filtered
            .map((report) => {
                const approval = APPROVAL_META[report.approvalStatus] || APPROVAL_META.pending;
                return `
                <button class="panel-list__item" data-report-id="${report.id}" type="button">
                    <div>
                        <strong>${report.vin || 'Nieznany VIN'}</strong>
                        <p>${report.workshopName || 'Warsztat bez nazwy'}</p>
                    </div>
                    <div class="panel-list__meta">
                        <span class="panel-tag ${approval.className}">${approval.label}</span>
                        <small>Aktualizacja: ${formatShortDate(report.updatedAt)}</small>
                    </div>
                </button>
            `;
            })
            .join('');
    };

    const applyWorkshopFilters = () => {
        const query = state.workshopFilters.query.toLowerCase();
        const status = state.workshopFilters.status;
        return state.workshops.filter((workshop) => {
            const matchesQuery = query
                ? ['name', 'email', 'city', 'address'].some((field) =>
                      String(workshop[field] || '').toLowerCase().includes(query)
                  )
                : true;
            const matchesStatus = status === 'all' ? true : workshop.status === status;
            return matchesQuery && matchesStatus;
        });
    };

    const buildWorkshopActivityIndex = () => {
        const stats = new Map();
        state.reports.forEach((report) => {
            if (!report.workshopId) {
                return;
            }
            const current = stats.get(report.workshopId) || { count: 0, lastReportAt: null };
            current.count += 1;
            const updatedAt = toDate(report.updatedAt) || toDate(report.createdAt);
            if (updatedAt && (!current.lastReportAt || updatedAt > current.lastReportAt)) {
                current.lastReportAt = updatedAt;
            }
            stats.set(report.workshopId, current);
        });
        return stats;
    };

    const renderWorkshopList = () => {
        if (!elements.workshopList) {
            return;
        }
        const workshops = applyWorkshopFilters();
        const activityIndex = buildWorkshopActivityIndex();
        if (!workshops.length) {
            elements.workshopList.innerHTML = '<p class="panel-empty">Brak warsztatow spelniajacych kryteria.</p>';
            return;
        }
        elements.workshopList.innerHTML = workshops
            .map((workshop) => {
                const meta = WORKSHOP_STATUS_META[workshop.status] || WORKSHOP_STATUS_META.inactive;
                const workshopName = (workshop.name || '').trim();
                const displayName = workshopName || 'Brak nazwy';
                const location = [workshop.city, workshop.address].filter(Boolean).join(' â€˘ ');
                const stats = activityIndex.get(workshop.id) || { count: 0, lastReportAt: null };
                const lastActivity = stats.lastReportAt ? formatShortDate(stats.lastReportAt) : 'Brak danych';
                const emailValue = workshop.email || 'Brak adresu e-mail';
                const phoneValue = workshop.phone || 'Brak numeru telefonu';
                return `
                <article class="panel-workshop-card" data-workshop-id="${workshop.id}" data-workshop-card>
                    <div class="panel-workshop-card__header">
                        <div class="panel-workshop-card__identity">
                            <span class="panel-workshop-card__avatar" aria-hidden="true">${getWorkshopInitials(displayName)}</span>
                            <div>
                                <strong title="${displayName}">${displayName}</strong>
                                <p class="panel-workshop-card__location">${location || 'Brak lokalizacji'}</p>
                            </div>
                        </div>
                        <span class="panel-tag ${meta.className}">${meta.label}</span>
                    </div>
                    <div class="panel-workshop-card__contact" aria-label="Dane kontaktowe">
                        <div class="panel-workshop-card__contact-item">
                            <small>Email</small>
                            <span>${emailValue}</span>
                        </div>
                        <div class="panel-workshop-card__contact-item">
                            <small>Telefon</small>
                            <span>${phoneValue}</span>
                        </div>
                    </div>
                    <div class="panel-workshop-card__stats" aria-label="Aktywnosc warsztatu">
                        <div class="panel-workshop-card__stat">
                            <small>Raporty</small>
                            <strong>${stats.count}</strong>
                        </div>
                        <div class="panel-workshop-card__stat">
                            <small>Ostatnia aktywnosc</small>
                            <strong>${lastActivity}</strong>
                        </div>
                    </div>
                    <div class="panel-workshop-card__actions">
                        <!-- UsuniÄ™to przycisk Edytuj -->
                    </div>
                </article>
            `;
            })
            .join('');
    };

    const getWorkshopSubscriptionSnapshot = (workshop) => {
        if (!workshop) {
            return null;
        }
        const startDate = toDate(workshop.subscriptionStartDate);
        const periodEnd = startDate ? addMonths(startDate, 12) : null;
        const now = new Date();
        let phaseLabel = 'Brak danych';
        if (workshop.status === 'deactivated') {
            phaseLabel = 'Konto dezaktywowane';
        } else if (workshop.status === 'inactive') {
            phaseLabel = 'Nieaktywne';
        } else if (workshop.status === 'notice') {
            phaseLabel = 'W okresie wypowiedzenia';
        } else if (periodEnd) {
            phaseLabel = now < periodEnd ? 'Okres podstawowy' : 'Czas nieokreslony';
        }

        return {
            phaseLabel,
            startLabel: startDate ? formatShortDate(startDate) : 'Brak danych',
            endLabel: periodEnd ? formatShortDate(periodEnd) : 'Brak danych',
            amountLabel: typeof workshop.subscriptionAmount !== 'undefined' && workshop.subscriptionAmount !== null
                ? formatCurrency(workshop.subscriptionAmount)
                : 'Brak danych',
            initialAmountLabel:
                typeof workshop.subscriptionInitialAmount !== 'undefined' && workshop.subscriptionInitialAmount !== null
                    ? formatCurrency(workshop.subscriptionInitialAmount)
                    : null,
            initialNote: workshop.subscriptionInitialNote || null,
            billingEmail: workshop.billingEmail || null
        };
    };

    const renderWorkshopDetailOverview = () => {
        if (!elements.workshopDetailOverview) {
            return;
        }
        if (state.workshopDetailLoading) {
            setWorkshopToolbarHint('Ladowanie profilu warsztatu...');
            elements.workshopDetailOverview.innerHTML = '<p class="panel-empty">Ladowanie danych warsztatu...</p>';
            return;
        }
        if (state.workshopDetailError) {
            setWorkshopToolbarHint('Nie udalo sie pobrac danych warsztatu.');
            elements.workshopDetailOverview.innerHTML = `<p class="panel-empty">${state.workshopDetailError}</p>`;
            return;
        }
        if (!state.workshopDetailRecord) {
            setWorkshopToolbarHint(WORKSHOP_TOOLBAR_HINT_DEFAULT);
            elements.workshopDetailOverview.innerHTML = '<p class="panel-empty">Wybierz warsztat z listy, aby zobaczyc szczegoly.</p>';
            return;
        }

        const workshop = state.workshopDetailRecord;
        const meta = WORKSHOP_STATUS_META[workshop.status] || WORKSHOP_STATUS_META.inactive;
        const location = [workshop.city, workshop.address].filter(Boolean).join(' â€˘ ') || 'Brak lokalizacji';
        const contacts = [workshop.email, workshop.phone].filter(Boolean);
        const billingLine = workshop.billingEmail ? `<span>Faktury: ${workshop.billingEmail}</span>` : '';
        const isActive = workshop.status === 'active' || workshop.status === 'notice';
        const nextStatus = isActive ? 'deactivated' : 'active';
        const toggleLabel = isActive ? 'Dezaktywuj konto' : 'Aktywuj konto';

        if (elements.workshopDetailTitle) {
            elements.workshopDetailTitle.textContent = workshop.name || 'Warsztat';
        }
        if (elements.workshopDetailEyebrow) {
            elements.workshopDetailEyebrow.textContent = workshop.city || 'Profil warsztatu';
        }
        setWorkshopToolbarHint(`Profil: ${workshop.name || 'Warsztat'}`);

        elements.workshopDetailOverview.innerHTML = `
            <div class="workshop-detail__header">
                <div>
                    <h4>${workshop.name || 'Warsztat bez nazwy'}</h4>
                    <p class="workshop-detail__address">${location}</p>
                    <div class="workshop-detail__meta">
                        <span class="panel-tag ${meta.className}">${meta.label}</span>
                        ${contacts.map((item) => `<span>${item}</span>`).join('')}
                        ${billingLine}
                    </div>
                </div>
                <div class="workshop-detail__actions">
                    <button class="btn btn--ghost" type="button" data-workshop-detail-action="toggle-status" data-next-status="${nextStatus}">${toggleLabel}</button>
                    <!-- UsuniÄ™to przycisk Edytuj dane -->
                </div>
            </div>
            ${workshop.notes ? `<p class="workshop-detail__notes">${workshop.notes}</p>` : ''}
        `;
    };

    const renderWorkshopDetailSubscription = () => {
        if (!elements.workshopDetailSubscription) {
            return;
        }
        if (state.workshopDetailLoading) {
            elements.workshopDetailSubscription.innerHTML = '<p class="panel-empty">Trwa pobieranie informacji o abonamencie...</p>';
            return;
        }
        if (!state.workshopDetailRecord) {
            elements.workshopDetailSubscription.innerHTML = '<p class="panel-empty">Brak danych abonamentu.</p>';
            return;
        }
        const snapshot = getWorkshopSubscriptionSnapshot(state.workshopDetailRecord);
        if (!snapshot) {
            elements.workshopDetailSubscription.innerHTML = '<p class="panel-empty">Brak danych abonamentu.</p>';
            return;
        }

        const items = [
            { label: 'Status abonamentu', value: snapshot.phaseLabel },
            { label: 'Kwota miesieczna', value: snapshot.amountLabel },
            { label: 'Start umowy', value: snapshot.startLabel },
            { label: 'Koniec okresu 12 mies.', value: snapshot.endLabel },
            { label: 'E-mail do faktur', value: snapshot.billingEmail || 'Brak danych' }
        ];

        let html = items
            .map(
                (item) => `
                    <article class="workshop-detail__stat">
                        <small>${item.label}</small>
                        <strong>${item.value}</strong>
                    </article>
                `
            )
            .join('');

        if (snapshot.initialAmountLabel || snapshot.initialNote) {
            html += `
                <article class="workshop-detail__stat workshop-detail__stat--accent">
                    <small>Kwota startowa</small>
                    <strong>${snapshot.initialAmountLabel || 'Brak danych'}</strong>
                    ${snapshot.initialNote ? `<span>${snapshot.initialNote}</span>` : ''}
                </article>
            `;
        }

        elements.workshopDetailSubscription.innerHTML = html;
    };

    const getBillingMonthValue = (value) => {
        if (!value) {
            return 0;
        }
        const [year, month] = String(value)
            .split('-')
            .map((chunk) => Number(chunk));
        if (!year || !month) {
            return 0;
        }
        return new Date(year, month - 1, 1).getTime();
    };

    const sortBillingHistory = (history) =>
        [...history].sort((a, b) => getBillingMonthValue(b.month) - getBillingMonthValue(a.month));

    const renderWorkshopBillingList = () => {
        if (!elements.workshopBillingList) {
            return;
        }
        if (state.workshopDetailLoading) {
            elements.workshopBillingList.innerHTML = '<li class="panel-empty">Ladowanie historii platnosci...</li>';
            return;
        }
        const history = Array.isArray(state.workshopDetailRecord?.billingHistory)
            ? sortBillingHistory(state.workshopDetailRecord.billingHistory)
            : null;
        if (!Array.isArray(history) || !history.length) {
            elements.workshopBillingList.innerHTML = '<li class="panel-empty">Brak zapisanych rozliczen.</li>';
            return;
        }
        elements.workshopBillingList.innerHTML = history
            .map((entry) => {
                const statusLabel = entry.status === 'paid' ? 'Oplacona' : 'Nieoplacona';
                const monthLabel = formatBillingMonth(entry.month);
                const amountLabel = typeof entry.amount !== 'undefined' ? formatCurrency(entry.amount) : 'Brak kwoty';
                const noteBlock = entry.note ? `<p>${entry.note}</p>` : '';
                const invoice = entry.invoiceNumber ? `<span>Faktura: ${entry.invoiceNumber}</span>` : '';
                const hasActions = Boolean(entry.id);
                const statusClass = entry.status === 'paid' ? 'paid' : 'unpaid';
                const actions = hasActions
                    ? `
                        <div class="workshop-billing-item__actions">
                            <button type="button" class="btn btn--ghost" data-billing-action="toggle-status" data-billing-id="${entry.id}" data-billing-next-status="${entry.status === 'paid' ? 'unpaid' : 'paid'}">
                                ${entry.status === 'paid' ? 'Oznacz jako nieoplacona' : 'Oznacz jako oplacona'}
                            </button>
                            <button type="button" class="btn btn--ghost" data-billing-action="edit" data-billing-id="${entry.id}">Edytuj</button>
                        </div>
                    `
                    : '';
                return `
                <li class="workshop-billing-item" data-billing-id="${entry.id || ''}">
                    <div class="workshop-billing-item__main">
                        <strong>${monthLabel}</strong>
                        <small>${amountLabel}</small>
                        ${invoice}
                        ${noteBlock}
                    </div>
                    <div class="workshop-billing-item__meta">
                        <span class="workshop-billing-item__status workshop-billing-item__status--${statusClass}">${statusLabel}</span>
                        ${actions}
                    </div>
                </li>
            `;
            })
            .join('');
    };

    const renderWorkshopDetail = () => {
        renderWorkshopDetailOverview();
        renderWorkshopDetailSubscription();
        renderWorkshopBillingList();
    };

    const upsertBillingEntry = (entry) => {
        if (!entry) {
            return;
        }
        if (!state.workshopDetailRecord) {
            state.workshopDetailRecord = { id: state.focusedWorkshopId, billingHistory: [] };
        }
        if (!Array.isArray(state.workshopDetailRecord.billingHistory)) {
            state.workshopDetailRecord.billingHistory = [];
        }
        const history = [...state.workshopDetailRecord.billingHistory];
        if (entry.id) {
            const existingIndex = history.findIndex((item) => item.id === entry.id);
            if (existingIndex >= 0) {
                history[existingIndex] = entry;
            } else {
                history.push(entry);
            }
        } else {
            history.push(entry);
        }
        state.workshopDetailRecord.billingHistory = sortBillingHistory(history);
        renderWorkshopBillingList();
    };

    const populateBillingFormEntry = (entry) => {
        if (!elements.workshopBillingForm || !entry) {
            return;
        }
        const setFieldValue = (name, value) => {
            const field = elements.workshopBillingForm.querySelector(`[name="${name}"]`);
            if (field) {
                field.value = value ?? '';
            }
        };
        setFieldValue('billingMonth', entry.month || '');
        setFieldValue('billingAmount', entry.amount ?? '');
        setFieldValue('billingInvoiceNumber', entry.invoiceNumber || '');
        setFieldValue('billingStatus', entry.status || 'unpaid');
        const noteField = elements.workshopBillingForm.querySelector('[name="billingNote"]');
        if (noteField) {
            noteField.value = entry.note || '';
        }
        const submitBtn = elements.workshopBillingForm.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.textContent = 'Aktualizuj platnosc';
        }
        state.workshopBillingEditId = entry.id || null;
        setFeedback(
            elements.workshopBillingFeedback,
            `Edytujesz rozliczenie za ${formatBillingMonth(entry.month)}.`,
            null
        );
    };

    const handleBillingEdit = (billingId) => {
        if (!billingId || !state.workshopDetailRecord || !Array.isArray(state.workshopDetailRecord.billingHistory)) {
            return;
        }
        const entry = state.workshopDetailRecord.billingHistory.find((item) => String(item.id) === String(billingId));
        if (entry) {
            populateBillingFormEntry(entry);
        }
    };

    const handleBillingToggleStatus = async (entryId, nextStatus) => {
        if (!state.focusedWorkshopId || !entryId || !nextStatus) {
            return;
        }
        try {
            setFeedback(elements.workshopBillingFeedback, 'Aktualizowanie statusu platnosci...', null);
            const entry = await window.WarsztatApi.patch(
                `/workshops/${state.focusedWorkshopId}/billing/${entryId}`,
                { status: nextStatus }
            );
            upsertBillingEntry(entry);
            setFeedback(elements.workshopBillingFeedback, 'Status platnosci zaktualizowany.', 'success');
        } catch (error) {
            if (handleAuthError(error)) {
                return;
            }
            const message = error.details?.message || 'Nie udalo sie zaktualizowac statusu platnosci.';
            setFeedback(elements.workshopBillingFeedback, message, 'error');
        }
    };

    const handleBillingListClick = (event) => {
        const actionBtn = event.target.closest('[data-billing-action]');
        if (!actionBtn) {
            return;
        }
        const billingId = actionBtn.dataset.billingId;
        const action = actionBtn.dataset.billingAction;
        if (action === 'edit') {
            handleBillingEdit(billingId);
            return;
        }
        if (action === 'toggle-status') {
            const nextStatus = actionBtn.dataset.billingNextStatus;
            handleBillingToggleStatus(billingId, nextStatus);
        }
    };

    const handleBillingFormSubmit = async (event) => {
        event.preventDefault();
        if (!state.focusedWorkshopId) {
            setFeedback(elements.workshopBillingFeedback, 'Najpierw wybierz warsztat.', 'error');
            return;
        }
        if (!elements.workshopBillingForm) {
            return;
        }
        const data = new FormData(elements.workshopBillingForm);
        const monthValue = normalizeString(data.get('billingMonth'));
        const amountValue = toMoneyValue(data.get('billingAmount'));
        if (!monthValue) {
            setFeedback(elements.workshopBillingFeedback, 'Wybierz miesiac rozliczenia.', 'error');
            return;
        }
        if (amountValue === null) {
            setFeedback(elements.workshopBillingFeedback, 'Podaj kwote faktury.', 'error');
            return;
        }
        const statusRaw = String(data.get('billingStatus') || 'unpaid');
        const normalizedStatus = statusRaw === 'paid' ? 'paid' : 'unpaid';
        const payload = {
            month: monthValue,
            amount: amountValue,
            invoiceNumber: toOptional(data.get('billingInvoiceNumber')),
            status: normalizedStatus,
            note: toOptional(data.get('billingNote'))
        };

        try {
            setFeedback(elements.workshopBillingFeedback, 'Zapisywanie platnosci...', null);
            let entry;
            if (state.workshopBillingEditId) {
                entry = await window.WarsztatApi.patch(
                    `/workshops/${state.focusedWorkshopId}/billing/${state.workshopBillingEditId}`,
                    payload
                );
            } else {
                entry = await window.WarsztatApi.post(`/workshops/${state.focusedWorkshopId}/billing`, payload);
            }
            upsertBillingEntry(entry);
            resetWorkshopBillingForm();
            setFeedback(elements.workshopBillingFeedback, 'Platnosc zostala zapisana.', 'success');
        } catch (error) {
            if (handleAuthError(error)) {
                return;
            }
            const message = error.details?.message || 'Nie udalo sie zapisac platnosci.';
            setFeedback(elements.workshopBillingFeedback, message, 'error');
        }
    };

    const handleWorkshopStatusToggle = async (nextStatus) => {
        if (!nextStatus || !state.focusedWorkshopId) {
            return;
        }
        try {
            setFeedback(elements.workshopDetailFeedback, 'Aktualizowanie statusu...', null);
            const updated = await window.WarsztatApi.patch(`/workshops/${state.focusedWorkshopId}`, {
                status: nextStatus
            });
            state.workshops = state.workshops.map((item) => (item.id === updated.id ? updated : item));
            state.workshopDetailRecord = updated;
            setFeedback(elements.workshopDetailFeedback, 'Status zostal zaktualizowany.', 'success');
            renderWorkshopList();
            renderOverview();
            renderWorkshopDetail();
        } catch (error) {
            if (handleAuthError(error)) {
                return;
            }
            const message = error.details?.message || 'Nie udalo sie zmienic statusu warsztatu.';
            setFeedback(elements.workshopDetailFeedback, message, 'error');
        }
    };

    const handleWorkshopDetailClick = (event) => {
        const editBtn = event.target.closest('[data-workshop-action="edit"]');
        if (editBtn) {
            const workshopId = editBtn.dataset.workshopId;
            hideWorkshopDetailView();
            handleWorkshopEditSelect(workshopId);
            return;
        }
        const toggleBtn = event.target.closest('[data-workshop-detail-action="toggle-status"]');
        if (toggleBtn) {
            const nextStatus = toggleBtn.dataset.nextStatus;
            handleWorkshopStatusToggle(nextStatus);
        }
    };

    const resetWorkshopBillingForm = () => {
        elements.workshopBillingForm?.reset();
        state.workshopBillingEditId = null;
        setFeedback(elements.workshopBillingFeedback, '', null);
        const submitBtn = elements.workshopBillingForm?.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.textContent = 'Zapisz platnosc';
        }
    };

    const showWorkshopDetailView = () => {
        if (!elements.workshopDetailView) {
            return;
        }
        if (elements.workshopListView) {
            elements.workshopListView.hidden = true;
        }
        elements.workshopDetailView.hidden = false;
        if (elements.workshopToolbarList) {
            elements.workshopToolbarList.hidden = true;
        }
        if (elements.workshopToolbarDetail) {
            elements.workshopToolbarDetail.hidden = false;
        }
        setWorkshopToolbarHint('Ladowanie profilu warsztatu...');
        state.workshopDetailViewActive = true;
    };

    const hideWorkshopDetailView = () => {
        if (!elements.workshopDetailView) {
            return;
        }
        elements.workshopDetailView.hidden = true;
        if (elements.workshopListView) {
            elements.workshopListView.hidden = false;
        }
        if (elements.workshopToolbarList) {
            elements.workshopToolbarList.hidden = false;
        }
        if (elements.workshopToolbarDetail) {
            elements.workshopToolbarDetail.hidden = true;
        }
        setWorkshopToolbarHint(WORKSHOP_TOOLBAR_HINT_DEFAULT);
        state.workshopDetailViewActive = false;
        state.focusedWorkshopId = null;
        state.workshopDetailRecord = null;
        state.workshopDetailError = null;
        state.workshopDetailLoading = false;
        setFeedback(elements.workshopDetailFeedback, '', null);
        renderWorkshopDetail();
        resetWorkshopBillingForm();
        if (elements.workshopDetailTitle) {
            elements.workshopDetailTitle.textContent = 'Szczegoly warsztatu';
        }
        if (elements.workshopDetailEyebrow) {
            elements.workshopDetailEyebrow.textContent = 'Profil warsztatu';
        }
    };

    const loadWorkshopDetail = async (workshopId) => {
        const numericId = Number(workshopId);
        state.workshopDetailLoading = true;
        state.workshopDetailError = null;
        state.workshopDetailRecord = null;
        renderWorkshopDetail();
        try {
            const detail = await window.WarsztatApi.get(`/workshops/${workshopId}`);
            if (!state.workshopDetailViewActive || numericId !== state.focusedWorkshopId) {
                return;
            }
            state.workshopDetailRecord = detail;
            state.workshopDetailLoading = false;
            renderWorkshopDetail();
        } catch (error) {
            if (handleAuthError(error)) {
                return;
            }
            if (!state.workshopDetailViewActive || numericId !== state.focusedWorkshopId) {
                return;
            }
            state.workshopDetailError = error.details?.message || 'Nie udalo sie pobrac danych warsztatu.';
            state.workshopDetailLoading = false;
            renderWorkshopDetail();
        }
    };

    const openWorkshopDetail = (workshopId) => {
        state.focusedWorkshopId = Number(workshopId);
        resetWorkshopBillingForm();
        setFeedback(elements.workshopDetailFeedback, '', null);
        showWorkshopDetailView();
        loadWorkshopDetail(workshopId);
    };

    const setWorkshopFormMode = () => {
        if (!elements.workshopForm) {
            return;
        }
        const isEdit = Boolean(state.editingWorkshopId);
        if (elements.workshopFormEyebrow) {
            elements.workshopFormEyebrow.textContent = isEdit ? 'Edycja warsztatu' : 'Nowy warsztat';
        }
        if (elements.workshopFormTitle) {
            elements.workshopFormTitle.textContent = isEdit ? 'Edytuj warsztat' : 'Dodaj warsztat';
        }
        if (elements.workshopFormSubmit) {
            elements.workshopFormSubmit.textContent = isEdit ? 'Zapisz zmiany' : 'Dodaj warsztat';
        }
        if (elements.workshopCancelBtn) {
            elements.workshopCancelBtn.hidden = !isEdit;
        }
    };

    const renderSettings = () => {
        if (!elements.settingsForm || !state.settings) {
            return;
        }
        const { licenseMonths, statusOptions } = state.settings;
        const monthsField = elements.settingsForm.querySelector('input[name="licenseMonths"]');
        const statusesField = elements.settingsForm.querySelector('textarea[name="statusOptions"]');
        if (monthsField) {
            monthsField.value = licenseMonths ?? '';
        }
        if (statusesField) {
            statusesField.value = (statusOptions || []).join(', ');
        }
    };

    const renderLogs = () => {
        if (!elements.logsContainer) {
            return;
        }
        if (!state.logs.length) {
            elements.logsContainer.innerHTML = '<li class="panel-empty">Brak wpisĂłw w dzienniku.</li>';
            return;
        }
        elements.logsContainer.innerHTML = state.logs
            .map((log) => {
                const actor = log.actorEmail || 'System';
                return `
                <li>
                    <strong>${log.message}</strong><br>
                    <small>${formatDateTime(log.createdAt)} Â· ${actor} Â· ${log.type}</small>
                </li>
            `;
            })
            .join('');
    };

    const buildOverviewMetrics = () => {
        const now = new Date();
        const monthAgo = new Date(now);
        monthAgo.setMonth(now.getMonth() - 1);
        const weekAgo = new Date(now);
        weekAgo.setDate(now.getDate() - 7);

        const workshopIndex = new Map(state.workshops.map((workshop) => [workshop.id, workshop]));
        const workshopStats = new Map();
        const isActiveWorkshop = (status) => status === 'active' || status === 'notice';
        const isInactiveWorkshop = (status) => status === 'inactive' || status === 'deactivated';

        state.reports.forEach((report) => {
            if (!report.workshopId) {
                return;
            }
            const stats = workshopStats.get(report.workshopId) || {
                workshopId: report.workshopId,
                count: 0,
                lastReportAt: null,
                name: null,
                city: null
            };
            stats.count += 1;
            const updatedAt = toDate(report.updatedAt) || toDate(report.createdAt);
            if (updatedAt && (!stats.lastReportAt || updatedAt > stats.lastReportAt)) {
                stats.lastReportAt = updatedAt;
            }
            const workshop = workshopIndex.get(report.workshopId);
            stats.name = workshop?.name || report.workshopName || 'Warsztat';
            stats.city = workshop?.city || null;
            workshopStats.set(report.workshopId, stats);
        });

        const describeWorkshopEntry = (workshop, metaLabel = 'Aktualizacja') => {
            const location = [workshop.city, workshop.address].filter(Boolean).join(' â€˘ ') || 'Brak lokalizacji';
            const lastTouched = toDate(workshop.updatedAt) || toDate(workshop.createdAt);
            const meta = lastTouched ? `${metaLabel} ${formatShortDate(lastTouched)}` : 'Brak daty aktualizacji';
            return {
                title: workshop.name || 'Warsztat',
                subtitle: location,
                meta
            };
        };

        const newWorkshopsList = sortByDateDesc(
            state.workshops.filter((workshop) => {
                const createdAt = toDate(workshop.createdAt);
                return createdAt && createdAt >= monthAgo;
            }),
            (workshop) => workshop.createdAt
        );

        const activeWorkshopItems = state.workshops
            .filter((workshop) => isActiveWorkshop(workshop.status))
            .sort((a, b) => (a.name || '').localeCompare(b.name || '', 'pl'))
            .slice(0, 100)
            .map((workshop) => describeWorkshopEntry(workshop, 'Aktualizacja'));

        const inactiveWorkshopItems = state.workshops
            .filter((workshop) => isInactiveWorkshop(workshop.status))
            .sort((a, b) => (a.name || '').localeCompare(b.name || '', 'pl'))
            .slice(0, 100)
            .map((workshop) => describeWorkshopEntry(workshop, 'Ostatnia zmiana'));

        const inactive30List = state.workshops
            .map((workshop) => {
                const updatedAt = toDate(workshop.updatedAt) || toDate(workshop.createdAt);
                const reportActivity = workshopStats.get(workshop.id)?.lastReportAt;
                const lastActivity = [updatedAt, reportActivity].filter(Boolean).sort((a, b) => b - a)[0];
                return { workshop, lastActivity };
            })
            .filter(({ lastActivity }) => !lastActivity || daysBetween(now, lastActivity) >= 30)
            .map(({ workshop, lastActivity }) => ({
                ...workshop,
                lastActivity: lastActivity ? lastActivity.toISOString() : null
            }));

        const workshopLoginsTodayList = [];
        const seenLoginKeys = new Set();

        state.logs
            .filter((log) => log.type === 'auth:login:workshop' && isSameDay(log.createdAt, now))
            .forEach((log) => {
                const key = String(log.payload?.workshopId ?? log.actorEmail ?? log.id ?? log.createdAt);
                if (seenLoginKeys.has(key)) {
                    return;
                }
                seenLoginKeys.add(key);
                workshopLoginsTodayList.push({
                    title: log.actorEmail || 'Warsztat',
                    subtitle: formatDateTime(log.createdAt),
                    meta: log.payload?.workshopId ? `Warsztat ID ${log.payload.workshopId}` : ''
                });
            });

        const topWorkshopList = [...workshopStats.values()]
            .sort((a, b) => {
                if (b.count === a.count) {
                    return (a.name || '').localeCompare(b.name || '', 'pl');
                }
                return b.count - a.count;
            })
            .slice(0, 100)
            .map((entry, index) => ({
                title: `${index + 1}. ${entry.name || 'Warsztat'}`,
                subtitle: entry.city || 'Brak lokalizacji',
                meta: `${entry.count} raportĂłw${entry.lastReportAt ? ` Â· ostatni ${formatShortDate(entry.lastReportAt)}` : ''}`
            }));

        const reportChronoList = sortByDateDesc(state.reports, (report) => report.updatedAt || report.createdAt)
            .slice(0, 100)
            .map((report) => ({
                title: report.vin || 'Brak VIN',
                subtitle: report.workshopName || 'Warsztat',
                meta: `${report.status || 'Brak statusu'} Â· ${formatShortDate(report.updatedAt || report.createdAt)}`
            }));

        const pendingReportEntries = sortByDateDesc(
            state.reports.filter((report) => report.approvalStatus === 'pending'),
            (report) => report.updatedAt || report.createdAt
        )
            .slice(0, 100)
            .map((report) => ({
                title: report.vin || 'Brak VIN',
                subtitle: report.workshopName || 'Warsztat',
                meta: `Oczekuje od ${formatShortDate(report.updatedAt || report.createdAt)}`
            }));

        const approvedThisWeekEntries = sortByDateDesc(
            state.reports.filter((report) => {
                if (report.approvalStatus !== 'approved') {
                    return false;
                }
                const updatedAt = toDate(report.updatedAt) || toDate(report.createdAt);
                return updatedAt && updatedAt >= weekAgo;
            }),
            (report) => report.updatedAt || report.createdAt
        )
            .slice(0, 100)
            .map((report) => ({
                title: report.vin || 'Brak VIN',
                subtitle: report.workshopName || 'Warsztat',
                meta: `Zatwierdzono ${formatShortDate(report.updatedAt || report.createdAt)}`
            }));

        const approvedThisWeek = approvedThisWeekEntries.length;

        const totalReports = state.reports.length;
        const pendingReports = pendingReportEntries.length;
        const approvedReports = state.reports.filter((item) => item.approvalStatus === 'approved').length;
        const activeWorkshops = activeWorkshopItems.length;
        const inactiveWorkshops = inactiveWorkshopItems.length;

        state.metricDetails = {
            activeWorkshops: {
                title: 'Aktywne warsztaty',
                eyebrow: 'Status kont',
                description: 'Partnerzy z aktywnÄ… licencjÄ… i dostÄ™pem do panelu.',
                items: activeWorkshopItems
            },
            inactiveWorkshops: {
                title: 'Warsztaty nieaktywne',
                eyebrow: 'Do reaktywacji',
                description: 'Punkty partnerskie, ktĂłre zostaĹ‚y wstrzymane lub oczekujÄ… na reaktywacjÄ™.',
                items: inactiveWorkshopItems
            },
            newWorkshops: {
                title: 'Nowe warsztaty',
                eyebrow: 'Ostatnie 30 dni',
                description: 'Partnerzy, ktĂłrzy dolaczyli w ciagu minionego miesiaca.',
                items: newWorkshopsList.map((workshop) => ({
                    title: workshop.name,
                    subtitle: [workshop.city, workshop.address].filter(Boolean).join(' â€˘ ') || 'Brak lokalizacji',
                    meta: `Dodano ${formatShortDate(workshop.createdAt)}`
                }))
            },
            inactive30Workshops: {
                title: 'Warsztaty do reaktywacji',
                eyebrow: 'Brak aktywnosci 30 dni',
                description: 'Lista partnerow, ktorzy od 30 dni nie wykonywali zadnej akcji ani nie zlozyli raportu.',
                items: sortByDateDesc(inactive30List, (workshop) => workshop.lastActivity)
                    .map((workshop) => ({
                        title: workshop.name,
                        subtitle: [workshop.city, workshop.address].filter(Boolean).join(' â€˘ ') || 'Brak lokalizacji',
                        meta: workshop.lastActivity
                            ? `Ostatnia aktywnosc ${formatShortDate(workshop.lastActivity)}`
                            : 'Brak zarejestrowanej aktywnosci'
                    }))
            },
            totalReports: {
                title: 'Raporty Ĺ‚Ä…cznie',
                eyebrow: 'CaĹ‚a baza',
                description: 'Chronologiczna lista najnowszych raportĂłw.',
                items: reportChronoList
            },
            pendingReports: {
                title: 'Raporty oczekujace',
                eyebrow: 'WymagajÄ… moderacji',
                description: 'Raporty, ktĂłre czekajÄ… na decyzjÄ™ administratora.',
                items: pendingReportEntries
            },
            approvedThisWeek: {
                title: 'Zatwierdzone raporty (7 dni)',
                eyebrow: 'Tempo pracy',
                description: 'Lista raportĂłw zaakceptowanych w ciÄ…gu ostatnich 7 dni.',
                items: approvedThisWeekEntries
            },
            workshopLoginsToday: {
                title: 'Logowania warsztatow dzisiaj',
                eyebrow: 'Aktywnosc dzienna',
                description: 'Historia dzisiejszych logowan warsztatow.',
                items: workshopLoginsTodayList
            },
            topWorkshopReporters: {
                title: 'Top warsztatow wg raportow',
                eyebrow: 'Ranking do 100 pozycji',
                description: 'Najbardziej aktywni partnerzy pod wzgledem dodawanych raportow.',
                items: topWorkshopList
            }
        };

        const metricsConfig = [
            { key: 'activeWorkshops', label: 'Warsztaty aktywne', value: activeWorkshops, detail: `${state.workshops.length} Ĺ‚Ä…cznie` },
            { key: 'inactiveWorkshops', label: 'Warsztaty nieaktywne', value: inactiveWorkshops, detail: 'Do reaktywacji' },
            { key: 'newWorkshops', label: 'Nowe warsztaty', value: newWorkshopsList.length, detail: 'Ostatnie 30 dni' },
            { key: 'inactive30Workshops', label: 'Brak aktywnoĹ›ci 30d', value: state.metricDetails.inactive30Workshops.items.length, detail: 'WymagajÄ… kontaktu' },
            { key: 'totalReports', label: 'Raporty Ĺ‚Ä…cznie', value: totalReports, detail: `${approvedReports} zatwierdzonych` },
            { key: 'pendingReports', label: 'Raporty oczekujÄ…ce', value: pendingReports, detail: 'WymagajÄ… moderacji' },
            { key: 'approvedThisWeek', label: 'Zatwierdzone (7 dni)', value: approvedThisWeek, detail: 'Tempo pracy' },
            { key: 'workshopLoginsToday', label: 'Logowania dzisiaj', value: workshopLoginsTodayList.length, detail: 'Warsztaty aktywne' },
            { key: 'topWorkshopReporters', label: 'Top warsztatĂłw', value: state.metricDetails.topWorkshopReporters.items.length, detail: 'Najaktywniejsi' }
        ];

        return metricsConfig.map((metric) => ({
            ...metric,
            clickable: Boolean(state.metricDetails[metric.key]?.items?.length)
        }));
    };

    const renderInactiveWorkshops = () => {
        if (!elements.inactiveWorkshopsList) {
            return;
        }
        const inactive = state.workshops.filter((workshop) => ['inactive', 'deactivated'].includes(workshop.status));
        if (!inactive.length) {
            elements.inactiveWorkshopsList.innerHTML = '<li class="panel-empty">Wszyscy partnerzy sa aktywni.</li>';
            return;
        }

        const limited = [...inactive].sort((a, b) => {
            const left = a.updatedAt || a.createdAt;
            const right = b.updatedAt || b.createdAt;
            if (left === right) {
                return a.name.localeCompare(b.name, 'pl');
            }
            return right.localeCompare(left);
        }).slice(0, 6);

        elements.inactiveWorkshopsList.innerHTML = limited
            .map((workshop) => {
                const location = [workshop.city, workshop.address].filter(Boolean).join(' â€˘ ');
                const contact = workshop.email || workshop.phone || 'Brak danych kontaktowych';
                return `
                <li>
                    <div>
                        <strong>${workshop.name}</strong>
                        <small>${location || 'Brak lokalizacji'}</small>
                    </div>
                    <small>${contact}</small>
                </li>
            `;
            })
            .join('');

        if (inactive.length > limited.length) {
            const remaining = inactive.length - limited.length;
            elements.inactiveWorkshopsList.innerHTML += `<li class="panel-empty">+${remaining} kolejnych wpisĂłw</li>`;
        }
    };

    const populateWorkshopForm = (workshop) => {
        if (!elements.workshopForm || !workshop) {
            return;
        }
        const setValue = (name, value) => {
            const field = elements.workshopForm.querySelector(`[name="${name}"]`);
            if (field) {
                field.value = value ?? '';
            }
        };

        setValue('name', workshop.name);
        setValue('city', workshop.city);
        setValue('address', workshop.address);
        setValue('phone', workshop.phone);
        setValue('email', workshop.email);
        setValue('billingEmail', workshop.billingEmail);
        setValue('loginEmail', workshop.loginEmail || workshop.email);
        setValue('status', workshop.status || 'active');
        setValue('subscriptionAmount', workshop.subscriptionAmount ?? '');
        setValue('subscriptionStartDate', toDateInputValue(workshop.subscriptionStartDate));
        setValue('subscriptionInitialAmount', workshop.subscriptionInitialAmount ?? '');
        setValue('subscriptionInitialNote', workshop.subscriptionInitialNote);
        const notesField = elements.workshopForm.querySelector('[name="notes"]');
        if (notesField) {
            notesField.value = workshop.notes || '';
        }
        const passwordField = elements.workshopForm.querySelector('[name="loginPassword"]');
        if (passwordField) {
            passwordField.value = '';
        }
    };

    function resetWorkshopForm() {
        elements.workshopForm?.reset();
        state.editingWorkshopId = null;
        setWorkshopFormMode();
    }

    const handleWorkshopEditSelect = (workshopId) => {
        const workshop = state.workshops.find((item) => item.id === Number(workshopId));
        if (!workshop) {
            return;
        }
        state.editingWorkshopId = workshop.id;
        populateWorkshopForm(workshop);
        setWorkshopFormMode();
        setFeedback(elements.workshopFeedback, `Edycja warsztatu ${workshop.name}.`, null);
        openWorkshopDrawer();
    };

    const refreshLogs = async (showLoading = false) => {
        if (showLoading && elements.logsContainer) {
            elements.logsContainer.innerHTML = '<li class="panel-empty">Ĺadowanie dziennika...</li>';
        }
        try {
            const logs = await window.WarsztatApi.get('/logs');
            state.logs = Array.isArray(logs) ? logs : [];
            renderLogs();
        } catch (error) {
            if (handleAuthError(error)) {
                return;
            }
            if (elements.logsContainer) {
                elements.logsContainer.innerHTML = '<li class="panel-empty">Nie udaĹ‚o siÄ™ pobraÄ‡ logĂłw.</li>';
            }
        }
    };

    const renderSelectedReport = () => {
        if (!elements.reportEditForm) {
            return;
        }
        const fields = {
            id: elements.reportEditForm.querySelector('input[name="reportId"]'),
            vin: elements.reportEditForm.querySelector('input[name="vin"]'),
            registrationNumber: elements.reportEditForm.querySelector('input[name="registrationNumber"]'),
            mileageKm: elements.reportEditForm.querySelector('input[name="mileageKm"]'),
            firstRegistrationDate: elements.reportEditForm.querySelector('input[name="firstRegistrationDate"]'),
            approvalStatus: elements.reportEditForm.querySelector('select[name="approvalStatus"]'),
            summary: elements.reportEditForm.querySelector('textarea[name="summary"]'),
            moderationNote: elements.reportEditForm.querySelector('textarea[name="moderationNote"]')
        };

        const report = state.reports.find((item) => item.id === state.selectedReportId);
        if (!report) {
            elements.reportEditForm.reset();
            state.selectedReportId = null;
            setFeedback(elements.reportFeedback, 'Wybierz raport z listy, aby rozpoczac edycje.', null);
            if (elements.reportMediaGallery) {
                elements.reportMediaGallery.innerHTML = '<p class="panel-empty">Brak zalacznikow.</p>';
            }
            return;
        }

        fields.id.value = report.id;
        fields.vin.value = report.vin || '';
        fields.registrationNumber.value = report.registrationNumber || '';
        fields.mileageKm.value = report.mileageKm ?? '';
        fields.firstRegistrationDate.value = report.firstRegistrationDate || '';
        fields.approvalStatus.value = report.approvalStatus || 'pending';
        fields.summary.value = report.summary || '';
        fields.moderationNote.value = report.moderationNote || '';

        if (elements.reportMediaGallery) {
            elements.reportMediaGallery.innerHTML = '<p class="panel-empty">Integracja zalacznikow pojawi sie wkrotce.</p>';
        }

        setFeedback(elements.reportFeedback, `Edytujesz raport ${report.vin}.`, null);
    };

    const selectReport = (reportId) => {
        state.selectedReportId = Number(reportId);
        renderSelectedReport();
    };

    const bindEvents = () => {
        elements.metrics?.addEventListener('click', handleMetricClick);
        elements.navButtons?.forEach((btn) => {
            btn.addEventListener('click', () => {
                const target = btn.dataset.panelTarget;
                if (target) {
                    activateView(target);
                    if (target === 'logs') {
                        refreshLogs(true);
                    }
                }
            });
        });

        elements.logoutBtn?.addEventListener('click', () => {
            window.WarsztatSession?.clear();
            window.location.href = LOGIN_URL;
        });

        elements.reportList?.addEventListener('click', (event) => {
            const target = event.target.closest('[data-report-id]');
            if (target) {
                selectReport(target.dataset.reportId);
            }
        });

        elements.reportFilterForm?.addEventListener('submit', (event) => {
            event.preventDefault();
            const data = new FormData(elements.reportFilterForm);
            state.filters.vin = String(data.get('vin') || '').trim();
            state.filters.registration = String(data.get('registration') || '').trim();
            state.filters.approval = String(data.get('approval') || 'all');
            renderReportList();
        });

        elements.reportEditForm?.addEventListener('submit', async (event) => {
            event.preventDefault();
            if (!state.selectedReportId) {
                setFeedback(elements.reportFeedback, 'Najpierw wybierz raport z listy.', 'error');
                return;
            }
            const data = new FormData(elements.reportEditForm);
            const payload = {
                vin: String(data.get('vin') || '').trim().toUpperCase(),
                registrationNumber: String(data.get('registrationNumber') || '').trim().toUpperCase(),
                mileageKm: data.get('mileageKm') ? Number(data.get('mileageKm')) : null,
                firstRegistrationDate: String(data.get('firstRegistrationDate') || '').trim() || null,
                summary: String(data.get('summary') || '').trim(),
                approvalStatus: String(data.get('approvalStatus') || 'pending'),
                moderationNote: String(data.get('moderationNote') || '').trim()
            };

            try {
                setFeedback(elements.reportFeedback, 'Zapisywanie zmian...', null);
                const updated = await window.WarsztatApi.patch(`/reports/${state.selectedReportId}`, payload);
                state.reports = state.reports.map((report) => (report.id === updated.id ? updated : report));
                setFeedback(elements.reportFeedback, 'Raport zaktualizowany poprawnie.', 'success');
                renderReportList();
                selectReport(updated.id);
            } catch (error) {
                if (handleAuthError(error)) {
                    return;
                }
                const message = error.details?.message || 'Nie udalo sie zapisac raportu.';
                setFeedback(elements.reportFeedback, message, 'error');
            }
        });

        elements.workshopList?.addEventListener('click', (event) => {
            const editBtn = event.target.closest('[data-workshop-action="edit"]');
            if (editBtn) {
                handleWorkshopEditSelect(editBtn.dataset.workshopId);
                event.stopPropagation();
                return;
            }
            if (event.target.closest('.panel-workshop-card__actions')) {
                return;
            }
            const card = event.target.closest('[data-workshop-card]');
            if (card?.dataset.workshopId) {
                openWorkshopDetail(card.dataset.workshopId);
            }
        });

        elements.workshopAddBtn?.addEventListener('click', () => {
            resetWorkshopForm();
            setFeedback(elements.workshopFeedback, 'Uzupelnij formularz, aby dodac nowy warsztat.', null);
            openWorkshopDrawer();
        });

        elements.workshopFilterForm?.addEventListener('submit', (event) => {
            event.preventDefault();
            const data = new FormData(elements.workshopFilterForm);
            state.workshopFilters.query = normalizeString(data.get('query')).toLowerCase();
            state.workshopFilters.status = String(data.get('status') || 'all');
            renderWorkshopList();
        });

        elements.workshopFilterReset?.addEventListener('click', () => {
            elements.workshopFilterForm?.reset();
            state.workshopFilters = { query: '', status: 'all' };
            renderWorkshopList();
        });

        elements.workshopForm?.addEventListener('submit', async (event) => {
            event.preventDefault();
            const data = new FormData(elements.workshopForm);
            const payload = {
                name: normalizeString(data.get('name')),
                city: toOptional(data.get('city')),
                address: toOptional(data.get('address')),
                phone: toOptional(data.get('phone')),
                email: toOptional(data.get('email')),
                billingEmail: toEmail(data.get('billingEmail')),
                status: String(data.get('status') || 'active'),
                subscriptionAmount: toMoneyValue(data.get('subscriptionAmount')),
                subscriptionStartDate: toDateOnly(data.get('subscriptionStartDate')),
                subscriptionInitialAmount: toMoneyValue(data.get('subscriptionInitialAmount')),
                subscriptionInitialNote: toOptional(data.get('subscriptionInitialNote')),
                notes: toOptional(data.get('notes')),
                loginEmail: toEmail(data.get('loginEmail')),
                loginPassword: normalizeString(data.get('loginPassword'))
            };

            if (!payload.name) {
                setFeedback(elements.workshopFeedback, 'Podaj nazwe warsztatu.', 'error');
                return;
            }

            if (!payload.loginEmail) {
                setFeedback(elements.workshopFeedback, 'Podaj e-mail do logowania warsztatu.', 'error');
                return;
            }

            const isEdit = Boolean(state.editingWorkshopId);
            if (!isEdit && payload.loginPassword.length < 8) {
                setFeedback(elements.workshopFeedback, 'Haslo musi miec co najmniej 8 znakow.', 'error');
                return;
            }
            if (isEdit && payload.loginPassword && payload.loginPassword.length < 8) {
                setFeedback(elements.workshopFeedback, 'Nowe haslo musi miec co najmniej 8 znakow.', 'error');
                return;
            }

            if (!payload.loginPassword) {
                delete payload.loginPassword;
            }

            try {
                setFeedback(elements.workshopFeedback, 'Zapisywanie danych warsztatu...', null);
                let workshop;
                if (state.editingWorkshopId) {
                    workshop = await window.WarsztatApi.patch(`/workshops/${state.editingWorkshopId}`, payload);
                    state.workshops = state.workshops.map((item) => (item.id === workshop.id ? workshop : item));
                    setFeedback(elements.workshopFeedback, 'Zmieniono dane warsztatu.', 'success');
                } else {
                    workshop = await window.WarsztatApi.post('/workshops', payload);
                    state.workshops = [workshop, ...state.workshops];
                    setFeedback(elements.workshopFeedback, 'Dodano nowy warsztat.', 'success');
                }
                renderWorkshopList();
                renderOverview();
                resetWorkshopForm();
            } catch (error) {
                if (handleAuthError(error)) {
                    return;
                }
                const message = error.details?.message || 'Nie udalo sie zapisac warsztatu.';
                setFeedback(elements.workshopFeedback, message, 'error');
            }
        });

        elements.workshopCancelBtn?.addEventListener('click', () => {
            resetWorkshopForm();
            setFeedback(elements.workshopFeedback, 'Anulowano edycje warsztatu.', null);
        });

        elements.settingsForm?.addEventListener('submit', async (event) => {
            event.preventDefault();
            if (!elements.settingsForm) {
                return;
            }
            const data = new FormData(elements.settingsForm);
            const licenseMonths = Number(data.get('licenseMonths'));
            const rawStatuses = String(data.get('statusOptions') || '')
                .split(',')
                .map((item) => item.trim())
                .filter(Boolean);

            if (!Number.isFinite(licenseMonths) || licenseMonths < 1) {
                setFeedback(elements.settingsFeedback, 'Podaj poprawna liczbe miesiecy.', 'error');
                return;
            }
            if (!rawStatuses.length) {
                setFeedback(elements.settingsFeedback, 'Wpisz przynajmniej jeden status.', 'error');
                return;
            }

            try {
                setFeedback(elements.settingsFeedback, 'Zapisywanie ustawien...', null);
                const updated = await window.WarsztatApi.patch('/settings', {
                    licenseMonths,
                    statusOptions: rawStatuses
                });
                state.settings = updated;
                renderSettings();
                setFeedback(elements.settingsFeedback, 'Ustawienia zostaly zapisane.', 'success');
            } catch (error) {
                if (handleAuthError(error)) {
                    return;
                }
                const message = error.details?.message || 'Nie udalo sie zapisac ustawien.';
                setFeedback(elements.settingsFeedback, message, 'error');
            }
        });

        elements.logsRefreshBtn?.addEventListener('click', () => {
            refreshLogs(true);
        });

        const handleWorkshopDrawerClose = () => {
            closeWorkshopDrawer();
            resetWorkshopForm();
            setFeedback(elements.workshopFeedback, '', null);
        };

        elements.workshopDrawerClose?.addEventListener('click', handleWorkshopDrawerClose);
        elements.workshopDrawerBackdrop?.addEventListener('click', handleWorkshopDrawerClose);
        elements.metricDrawerClose?.addEventListener('click', closeMetricDrawer);
        elements.metricDrawerBackdrop?.addEventListener('click', closeMetricDrawer);
        elements.workshopDetailBack?.addEventListener('click', hideWorkshopDetailView);
        elements.workshopDetailView?.addEventListener('click', handleWorkshopDetailClick);
        elements.workshopBillingForm?.addEventListener('submit', handleBillingFormSubmit);
        elements.workshopBillingList?.addEventListener('click', handleBillingListClick);
        document.addEventListener('keydown', handleDrawerKeydown);
    };

    const loadInitialData = async () => {
        try {
            setFeedback(elements.reportFeedback, 'Wczytywanie danych z API...', null);
            const [reports, media, news, workshops, settings, logs] = await Promise.all([
                window.WarsztatApi.get('/reports'),
                window.WarsztatApi.get('/media', { auth: false }),
                window.WarsztatApi.get('/news', { auth: false }),
                window.WarsztatApi.get('/workshops'),
                window.WarsztatApi.get('/settings'),
                window.WarsztatApi.get('/logs')
            ]);
            state.reports = Array.isArray(reports) ? reports : [];
            state.media = Array.isArray(media) ? media : [];
            state.news = Array.isArray(news) ? news : [];
            state.workshops = Array.isArray(workshops) ? workshops : [];
            state.settings = settings || null;
            state.logs = Array.isArray(logs) ? logs : [];
            renderOverview();
            renderReportList();
            renderSelectedReport();
            renderWorkshopList();
            renderSettings();
            renderLogs();
            setFeedback(elements.reportFeedback, 'Dane zostaly pobrane.', 'success');
        } catch (error) {
            if (handleAuthError(error)) {
                return;
            }
            console.error('Nie udalo sie pobrac danych poczatkowych', error);
            setFeedback(elements.reportFeedback, 'Nie udalo sie pobrac danych z API.', 'error');
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
            // --- Warsztat: zakĹ‚adka Ustawienia ---
            const settingsTab = document.getElementById('tab-settings');
            const settingsForm = document.getElementById('workshop-settings-form');
            function fillWorkshopSettingsForm(data) {
                if (!settingsForm || !data) return;
                settingsForm.name.value = data.name || '';
                settingsForm.city.value = data.city || '';
                settingsForm.address.value = data.address || '';
                settingsForm.phone.value = data.phone || '';
                settingsForm.email.value = data.email || '';
                settingsForm.billingEmail.value = data.billingEmail || '';
                settingsForm.subscriptionAmount.value = data.subscriptionAmount || '';
                settingsForm.subscriptionMonths.value = data.subscriptionMonths || '';
                settingsForm.subscriptionStartDate.value = data.subscriptionStartDate || '';
                settingsForm.integrationSms.checked = !!data.integrationSms;
                settingsForm.integrationHurtownia.checked = !!data.integrationHurtownia;
                settingsForm.integrationAutodoc.checked = !!data.integrationAutodoc;
            }

            async function loadWorkshopSettings(workshopId) {
                if (!workshopId) return;
                try {
                    const detail = await window.WarsztatApi.get(`/workshops/${workshopId}`);
                    fillWorkshopSettingsForm(detail);
                } catch (err) {}
            }

            if (settingsForm) {
                settingsForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    if (!state.focusedWorkshopId) return;
                    const data = new FormData(settingsForm);
                    const payload = {
                        name: data.get('name'),
                        city: data.get('city'),
                        address: data.get('address'),
                        phone: data.get('phone'),
                        email: data.get('email'),
                        billingEmail: data.get('billingEmail'),
                        subscriptionAmount: Number(data.get('subscriptionAmount')),
                        subscriptionMonths: Number(data.get('subscriptionMonths')),
                        subscriptionStartDate: data.get('subscriptionStartDate'),
                        integrationSms: !!data.get('integrationSms'),
                        integrationHurtownia: !!data.get('integrationHurtownia'),
                        integrationAutodoc: !!data.get('integrationAutodoc')
                    };
                    try {
                        await window.WarsztatApi.patch(`/workshops/${state.focusedWorkshopId}`, payload);
                        alert('Zmiany zapisane!');
                    } catch (err) {
                        alert('Nie udaĹ‚o siÄ™ zapisaÄ‡ zmian.');
                    }
                });
            }

            document.body.addEventListener('click', function(e) {
                const tabBtn = e.target.closest('.workshop-tab[data-tab="settings"]');
                if (tabBtn && state.focusedWorkshopId) {
                    loadWorkshopSettings(state.focusedWorkshopId);
                }
            });
            // --- Warsztat: zakĹ‚adka Raporty ---
            const reportsTab = document.getElementById('tab-reports');
            const reportsList = document.getElementById('workshop-reports-list');
            const reportsFilterForm = document.getElementById('workshop-reports-filter-form');
            let reportsFilter = { status: 'all', date: '', type: '' };

            async function loadWorkshopReports(workshopId) {
                if (!workshopId) return;
                try {
                    const allReports = await window.WarsztatApi.get(`/workshops/${workshopId}/reports`);
                    state.workshopReports = Array.isArray(allReports) ? allReports : [];
                    renderWorkshopReports();
                } catch (err) {
                    reportsList.innerHTML = '<p class="panel-empty">Nie udaĹ‚o siÄ™ pobraÄ‡ raportĂłw.</p>';
                }
            }

            function renderWorkshopReports() {
                if (!reportsList) return;
                let filtered = state.workshopReports;
                if (reportsFilter.status && reportsFilter.status !== 'all') {
                    filtered = filtered.filter(r => r.approvalStatus === reportsFilter.status);
                }
                if (reportsFilter.date) {
                    filtered = filtered.filter(r => r.updatedAt && r.updatedAt.startsWith(reportsFilter.date));
                }
                if (reportsFilter.type) {
                    filtered = filtered.filter(r => (r.type || '').toLowerCase().includes(reportsFilter.type.toLowerCase()));
                }
                if (!filtered.length) {
                    reportsList.innerHTML = '<p class="panel-empty">Brak raportĂłw dla wybranych filtrĂłw.</p>';
                    return;
                }
                reportsList.innerHTML = filtered.map(report => `
                    <article class="workshop-report-card">
                        <header>
                            <strong>${report.vin || 'Brak VIN'}</strong>
                            <span class="panel-tag ${report.approvalStatus}">${report.approvalStatus}</span>
                            <span>${report.type || 'Brak typu'}</span>
                            <span>${report.updatedAt ? new Date(report.updatedAt).toLocaleDateString('pl-PL') : ''}</span>
                        </header>
                        <p>${report.summary || 'Brak opisu naprawy.'}</p>
                        <div class="workshop-report-attachments">
                            ${(report.attachments && report.attachments.length)
                                ? report.attachments.map(att => `<a href="${att.url}" target="_blank">${att.name}</a>`).join(', ')
                                : '<span class="panel-empty">Brak zaĹ‚Ä…cznikĂłw.</span>'}
                        </div>
                    </article>
                `).join('');
            }

            if (reportsFilterForm) {
                reportsFilterForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const data = new FormData(reportsFilterForm);
                    reportsFilter.status = data.get('status') || 'all';
                    reportsFilter.date = data.get('date') || '';
                    reportsFilter.type = data.get('type') || '';
                    renderWorkshopReports();
                });
            }

            // ZaĹ‚aduj raporty po otwarciu panelu warsztatu
            document.body.addEventListener('click', function(e) {
                const tabBtn = e.target.closest('.workshop-tab[data-tab="reports"]');
                if (tabBtn && state.focusedWorkshopId) {
                    loadWorkshopReports(state.focusedWorkshopId);
                }
            });
            // --- Warsztat: zakĹ‚adki szczegĂłĹ‚Ăłw ---
            document.body.addEventListener('click', function (e) {
                const tabBtn = e.target.closest('.workshop-tab');
                if (tabBtn) {
                    const nav = tabBtn.parentElement;
                    const allTabs = nav.querySelectorAll('.workshop-tab');
                    allTabs.forEach(btn => btn.classList.remove('active'));
                    tabBtn.classList.add('active');
                    const tab = tabBtn.getAttribute('data-tab');
                    const contentRoot = nav.parentElement.querySelector('.workshop-tabs__content');
                    if (contentRoot) {
                        contentRoot.querySelectorAll('.workshop-tab-content').forEach(sec => {
                            sec.style.display = sec.id === 'tab-' + tab ? '' : 'none';
                        });
                    }
                }
            });
        if (!window.WarsztatApi || !window.WarsztatSession) {
            console.error('Brakuje klienta API lub modulu sesji.');
            return;
        }
        const session = window.WarsztatSession.get();
        if (!session?.token) {
            window.location.href = LOGIN_URL;
            return;
        }

        bindDom();
        state.session = session;
        state.isAdmin = session.role !== 'workshop';

        if (!state.isAdmin) {
            activateWorkshopMode(session);
            return;
        }

        setWorkshopFormMode();
        disableLegacyViews();
        bindEvents();
        activateView('overview');

        if (elements.username) {
            elements.username.textContent = session.user?.email || 'Administrator';
        }
        if (elements.role) {
            elements.role.textContent = 'Administrator';
        }

        loadInitialData();
    });
})();



=== PLIK: js/landing/vinForm.js ===

(function () {
    const VIN_FORM_ID = 'vin-form';
    const VIN_INPUT_ID = 'vin-input';
    const VIN_RESULT_ID = 'vin-result';
    const VIN_PATTERN = /^[A-HJ-NPR-Z0-9]{11,17}$/;

    const formatDate = (value) => {
        if (!value) {
            return 'Brak danych';
        }
        try {
            return new Date(value).toLocaleDateString('pl-PL', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        } catch (error) {
            return value;
        }
    };

    const formatMileage = (value) => {
        const mileage = Number(value);
        if (!Number.isFinite(mileage) || mileage < 0) {
            return 'Brak danych';
        }
        return `${mileage.toLocaleString('pl-PL')} km`;
    };

    const renderMediaList = (media = []) => {
        if (!media.length) {
            return '';
        }
        const items = media
            .map((item, index) => {
                const label = item.name || `Zalacznik ${index + 1}`;
                if (item.url) {
                    return `<li><a href="${item.url}" target="_blank" rel="noopener">${label}</a></li>`;
                }
                return `<li>${label}</li>`;
            })
            .join('');
        return `<ul class="vin-card-media">${items}</ul>`;
    };

    const renderResult = (container, vin, reports) => {
        if (!reports.length) {
            container.textContent = 'Brak zaakceptowanych raportow dla podanego VIN.';
            return;
        }

        const items = reports
            .map((report) => `
                <article class="vin-card">
                    <header>
                        <strong>${report.workshopName || 'Warsztat'}</strong>
                        <span>Status: ${report.status || 'â€”'}</span>
                    </header>
                    <div class="vin-card__meta">
                        <span>Rejestracja: ${report.registrationNumber || 'Brak danych'}</span>
                        <span>Przebieg: ${formatMileage(report.mileageKm)}</span>
                        <span>Pierwsza rejestracja: ${formatDate(report.firstRegistrationDate)}</span>
                    </div>
                    <p>${report.summary || 'Brak opisu naprawy.'}</p>
                    ${renderMediaList(report.media)}
                    <footer>Aktualizacja: ${formatDate(report.updatedAt)}</footer>
                </article>
            `)
            .join('');

        container.innerHTML = `
            <p>Znaleziono ${reports.length} raport(y) dla VIN <strong>${vin}</strong>:</p>
            <div class="vin-card-list">${items}</div>
        `;
    };

    document.addEventListener('DOMContentLoaded', () => {
        if (!window.WarsztatApi) {
            console.error('Brak klienta API');
            return;
        }

        const form = document.getElementById(VIN_FORM_ID);
        const input = document.getElementById(VIN_INPUT_ID);
        const result = document.getElementById(VIN_RESULT_ID);

        if (!form || !input || !result) {
            return;
        }

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const vin = input.value.trim().toUpperCase();

            if (!VIN_PATTERN.test(vin)) {
                result.textContent = 'Podaj poprawny numer VIN (11-17 znakow, bez liter O oraz I).';
                return;
            }

            result.textContent = 'Trwa wyszukiwanie w bazie...';

            try {
                const reports = await window.WarsztatApi.get(`/reports/public/${vin}`, { auth: false });
                renderResult(result, vin, Array.isArray(reports) ? reports : []);
            } catch (error) {
                console.error('Nie udalo sie pobrac raportow', error);
                result.textContent = 'Nie udalo sie polaczyc z API. Sprobuj ponownie pozniej.';
            }
        });
    });
})();



=== PLIK: js/landing/navToggle.js ===

(function () {
    const nav = document.querySelector('.site-nav');
    const toggle = document.querySelector('.site-nav__toggle');
    if (!nav || !toggle) {
        return;
    }

    toggle.addEventListener('click', () => {
        const isOpen = nav.classList.toggle('is-open');
        toggle.setAttribute('aria-expanded', String(isOpen));
    });

    nav.addEventListener('click', (event) => {
        if (event.target.matches('a') && nav.classList.contains('is-open')) {
            nav.classList.remove('is-open');
            toggle.setAttribute('aria-expanded', 'false');
        }
    });
})();



=== PLIK: js/auth/login.js ===

(function () {
    const setFeedback = (element, message, type) => {
        if (!element) return;
        element.textContent = message;
        element.classList.remove('is-error', 'is-success');
        if (type) {
            element.classList.add(type === 'error' ? 'is-error' : 'is-success');
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        if (!window.WarsztatApi || !window.WarsztatSession) {
            console.error('Brakuje moduĹ‚u API lub sesji');
            return;
        }

        const form = document.getElementById('unified-login-form');
        const feedback = document.querySelector('[data-feedback="login"]');
        const submitBtn = form?.querySelector('button[type="submit"]');

        form?.addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(form);
            const identifier = String(formData.get('identifier') || '').trim();
            const password = String(formData.get('password') || '').trim();

            if (!identifier || !password) {
                setFeedback(feedback, 'UzupeĹ‚nij oba pola logowania.', 'error');
                return;
            }

            submitBtn?.setAttribute('disabled', 'true');
            setFeedback(feedback, 'Logowanie...', null);

            try {
                const payload = { email: identifier.toLowerCase(), password };
                const response = await window.WarsztatApi.post('/auth/login', payload, { auth: false });

                // Zapis sesji
                window.WarsztatSession.save({
                    token: response.token,
                    role: response.role || 'workshop',
                    user: {
                        email: response.email || identifier,
                        workshopId: response.workshopId || null
                    }
                });

                setFeedback(feedback, 'Zalogowano pomyĹ›lnie. Przekierowuje...', 'success');
                if (response.role === "admin" || (response.email && response.email.toLowerCase().includes("admin"))) {
                    window.location.href = "panel.html";
                } else {
                    window.location.href = "panel-warsztatu.html";
                }

                // INTELIGENTNE PRZEKIEROWANIE
                if (response.role === "admin" || response.isAdmin === true) {
                    window.location.href = "panel.html";
                }
                else if (response.email && response.email.toLowerCase().includes("admin")) {
                    window.location.href = "panel.html";
                }
                else {
                    window.location.href = "panel-warsztatu.html";
                }

            } catch (error) {
                const message = error.details?.message || 'Niepoprawny e-mail lub hasĹ‚o.';
                setFeedback(feedback, message, 'error');
            } finally {
                submitBtn?.removeAttribute('disabled');
            }
        });
    });
})();


=== PLIK: js/main.js ===

(function () {
			// --- ObsĹ‚uga klikniÄ™cia na kartÄ™ warsztatu i pobieranie szczegĂłĹ‚Ăłw ---
			document.addEventListener('click', async function (e) {
				const card = e.target.closest('.workshop-card[data-id]');
				if (card) {
					const id = card.getAttribute('data-id');
					if (!id) return;
					showWorkshopDetail(id);
				}
			});

			async function showWorkshopDetail(id) {
				const detail = document.getElementById('workshop-browser-detail');
				const list = document.getElementById('workshop-browser-list');
				if (!detail || !list) return;
				detail.hidden = false;
				detail.style.display = '';
				list.hidden = true;
				list.style.display = 'none';
				// Loader
				const title = document.getElementById('workshop-detail-title');
				if (title) title.textContent = 'Ĺadowanie...';
				// Pobierz szczegĂłĹ‚y warsztatu
				try {
					const res = await fetch(`/api/workshops/${id}`, { credentials: 'include' });
					if (!res.ok) throw new Error('BĹ‚Ä…d pobierania szczegĂłĹ‚Ăłw warsztatu');
					const data = await res.json();
					renderWorkshopDetail(data);
				} catch (err) {
					if (title) title.textContent = 'BĹ‚Ä…d Ĺ‚adowania';
				}
			}

			function renderWorkshopDetail(data) {
				// Ustaw nagĹ‚Ăłwek
				const title = document.getElementById('workshop-detail-title');
				if (title) title.textContent = data.name || 'SzczegĂłĹ‚y warsztatu';
				
				// Ustaw dane w sekcji AktywnoĹ›Ä‡/Abonament
				const sub = document.getElementById('workshop-detail-subscription');
				if (sub) {
					sub.innerHTML = `
						<div class="workshop-detail__item"><strong>Status abonamentu</strong><div>${data.subscriptionAmount ? 'Aktywny' : 'Brak danych'}</div></div>
						<div class="workshop-detail__item"><strong>Kwota miesiÄ™czna</strong><div>${data.subscriptionAmount || 'Brak danych'}</div></div>
						<div class="workshop-detail__item"><strong>Start umowy</strong><div>${data.subscriptionStartDate || 'Brak danych'}</div></div>
						<div class="workshop-detail__item"><strong>Koniec okresu 12 mies.</strong><div>${data.subscriptionStartDate && data.subscriptionMonths ? getEndDate(data.subscriptionStartDate, data.subscriptionMonths) : 'Brak danych'}</div></div>
						<div class="workshop-detail__item"><strong>E-mail do faktur</strong><div>${data.billingEmail || 'Brak danych'}</div></div>
					`;
				}
				
				// Ustaw dane w formularzu ustawieĹ„
				const settingsForm = document.getElementById('workshop-settings-form');
				if (settingsForm) {
					Array.from(settingsForm.elements).forEach(el => {
						if (!el.name) return;
						if (el.type === 'checkbox') {
							el.checked = !!data[el.name];
						} else {
							el.value = data[el.name] || '';
						}
					});
				}
				
				// Renderuj dodatkowe sekcje
				renderWorkshopLogs();
				renderWorkshopTickets();
				renderWorkshopReports(data.id);
			}

			// Funkcje pomocnicze
			async function renderWorkshopLogs() {
				const logsList = document.getElementById('workshop-detail-logs');
				if (!logsList) return;
				logsList.innerHTML = '<li>Ĺadowanie logĂłw...</li>';
				try {
					const res = await fetch('/api/logs?limit=30', { credentials: 'include' });
					if (!res.ok) throw new Error('BĹ‚Ä…d pobierania logĂłw');
					const logs = await res.json();
					if (!Array.isArray(logs) || logs.length === 0) {
						logsList.innerHTML = '<li>Brak logĂłw do wyĹ›wietlenia.</li>';
						return;
					}
					logsList.innerHTML = logs.map(renderLogItem).join('');
				} catch (err) {
					logsList.innerHTML = `<li>${err.message || 'BĹ‚Ä…d sieci'}</li>`;
				}
			}

			function renderLogItem(log) {
				return `<li><b>${log.createdAt ? log.createdAt.substring(0, 16).replace('T', ' ') : ''}</b> â€” ${log.message || ''}</li>`;
			}

			function renderWorkshopTickets() {
				const tickets = document.getElementById('workshop-detail-tickets');
				if (tickets) {
					tickets.innerHTML = '<div class="panel-empty">Brak obsĹ‚ugi zgĹ‚oszeĹ„ w API.</div>';
				}
			}

			async function renderWorkshopReports(workshopId) {
				const reportsList = document.getElementById('workshop-reports-list');
				if (!reportsList) return;
				reportsList.innerHTML = '<div class="panel-loading">Ĺadowanie raportĂłw...</div>';
				try {
					const res = await fetch(`/api/reports?workshopId=${encodeURIComponent(workshopId)}`, { credentials: 'include' });
					if (!res.ok) throw new Error('BĹ‚Ä…d pobierania raportĂłw');
					const reports = await res.json();
					if (!Array.isArray(reports) || reports.length === 0) {
						reportsList.innerHTML = '<div class="panel-empty">Brak raportĂłw dla tego warsztatu.</div>';
						return;
					}
					reportsList.innerHTML = `
						<div class="panel-debug" style="background:#ffe;border:1px solid #cc0;padding:4px 8px;margin-bottom:8px;font-size:13px;">
							<b>Debug:</b> workshopId = <code>${workshopId}</code>, raportĂłw = <b>${reports.length}</b>
						</div>
						${reports.map(renderReportItem).join('')}
					`;
				} catch (err) {
					reportsList.innerHTML = `<div class="panel-error">${err.message || 'BĹ‚Ä…d sieci'}</div>`;
				}
			}

			function renderReportItem(r) {
				return `
					<div class="report-item">
						<div><b>VIN:</b> ${r.vin || '-'}</div>
						<div><b>Status:</b> ${r.status || '-'}</div>
						<div><b>Podsumowanie:</b> ${r.summary || '-'}</div>
						<div><b>Data:</b> ${r.updatedAt || '-'}</div>
					</div>
				`;
			}

			// --- Renderowanie listy warsztatĂłw z backendu ---
			async function fetchWorkshops() {
				const list = document.getElementById('workshop-list');
				if (!list) return;
				list.innerHTML = '<div class="panel-loading">Ĺadowanie warsztatĂłw...</div>';
			reportsList.innerHTML = '<div class="panel-loading">Ĺadowanie raportĂłw...</div>';
			try {
				const res = await fetch(`/api/reports?workshopId=${encodeURIComponent(workshopId)}`, { credentials: 'include' });
				if (!res.ok) throw new Error('BĹ‚Ä…d pobierania raportĂłw');
				const reports = await res.json();
				if (!Array.isArray(reports) || reports.length === 0) {
					reportsList.innerHTML = '<div class="panel-empty">Brak raportĂłw dla tego warsztatu.</div>';
					return;
				}
				   // DEBUG: WyĹ›wietl ID warsztatu i liczbÄ™ raportĂłw
				   reportsList.innerHTML = `
					   <div class="panel-debug" style="background:#ffe;border:1px solid #cc0;padding:4px 8px;margin-bottom:8px;font-size:13px;">
						   <b>Debug:</b> workshopId = <code>${workshopId}</code>, raportĂłw = <b>${reports.length}</b>
					   </div>
					   ${reports.map(renderReportItem).join('')}
				   `;
			} catch (err) {
				reportsList.innerHTML = `<div class="panel-error">${err.message || 'BĹ‚Ä…d sieci'}</div>`;
			}
		}

		function renderReportItem(r) {
			return `
				<div class="report-item">
					<div><b>VIN:</b> ${r.vin || '-'}</div>
					<div><b>Status:</b> ${r.status || '-'}</div>
					<div><b>Podsumowanie:</b> ${r.summary || '-'}</div>
					<div><b>Data:</b> ${r.updatedAt || '-'}</div>
				</div>
			`;
		}
			}
		}

		// Automatyczne Ĺ‚adowanie listy warsztatĂłw po wejĹ›ciu na panel
		document.addEventListener('DOMContentLoaded', fetchWorkshops);
	// --- Warsztat Panel Tabs ---
	document.addEventListener('DOMContentLoaded', function () {
		// --- ObsĹ‚uga przycisku PowrĂłt do listy (delegacja, bo moĹĽe byÄ‡ renderowany dynamicznie) ---
		document.body.addEventListener('click', function (e) {
			if (e.target && e.target.id === 'workshop-list-back') {
				// Ukryj szczegĂłĹ‚y warsztatu
				var detail = document.getElementById('workshop-browser-detail');
				if (detail) {
					detail.hidden = true;
					detail.style.display = 'none';
				}
				// PokaĹĽ listÄ™ warsztatĂłw
				var list = document.getElementById('workshop-browser-list');
				if (list) {
					list.hidden = false;
					list.style.display = '';
				}
				// PrzewiĹ„ do nagĹ‚Ăłwka listy
				var header = document.querySelector('.panel-section__eyebrow');
				if (header) header.scrollIntoView({behavior: 'smooth', block: 'start'});
			}
		});

		// --- ObsĹ‚uga formularza ustawieĹ„ warsztatu ---
		let currentWorkshopId = null;
		const settingsForm = document.getElementById('workshop-settings-form');
		if (settingsForm) {
			settingsForm.addEventListener('submit', async function (e) {
				e.preventDefault();
				if (!currentWorkshopId) {
					alert('Brak wybranego warsztatu!');
					return;
				}
				const data = {};
				Array.from(settingsForm.elements).forEach(el => {
					if (!el.name) return;
					if (el.type === 'checkbox') {
						data[el.name] = el.checked;
					} else {
						data[el.name] = el.value;
					}
				});
				try {
					const res = await fetch(`/api/workshops/${currentWorkshopId}`, {
						method: 'PATCH',
						headers: { 'Content-Type': 'application/json' },
						credentials: 'include',
						body: JSON.stringify(data)
					});
					if (!res.ok) throw new Error('BĹ‚Ä…d zapisu danych warsztatu');
					alert('Dane warsztatu zapisane!');
				} catch (err) {
					alert(err.message || 'BĹ‚Ä…d sieci');
				}
			});
		}
	// ObsĹ‚uga przycisku "Dezaktywuj konto"
	document.addEventListener('click', async function (e) {
		if (e.target && e.target.id === 'workshop-deactivate-btn') {
			if (!currentWorkshopId) {
				alert('Brak wybranego warsztatu!');
				return;
			}
			if (!confirm('Czy na pewno chcesz dezaktywowaÄ‡ ten warsztat?')) return;
			try {
				const res = await fetch(`/api/workshops/${currentWorkshopId}`, {
					method: 'PATCH',
					headers: { 'Content-Type': 'application/json' },
					credentials: 'include',
					body: JSON.stringify({ status: 'deactivated' })
				});
				if (!res.ok) throw new Error('BĹ‚Ä…d dezaktywacji warsztatu');
				alert('Warsztat zostaĹ‚ dezaktywowany.');
				// OdĹ›wieĹĽ szczegĂłĹ‚y
				showWorkshopDetail(currentWorkshopId);
			} catch (err) {
				alert(err.message || 'BĹ‚Ä…d sieci');
			}
		}
	});

		// --- Renderuj sekcjÄ™ AktywnoĹ›Ä‡/Stan umowy na podstawie danych z localStorage ---
		function renderWorkshopSubscription(data) {
			const sub = document.getElementById('workshop-detail-subscription');
			if (!sub) return;
			data = data || JSON.parse(localStorage.getItem('workshop:settings') || '{}');
			sub.innerHTML = `
				<div class="workshop-detail__item"><strong>Status abonamentu</strong><div>${data.subscriptionAmount ? 'Aktywny' : 'Brak danych'}</div></div>
				<div class="workshop-detail__item"><strong>Kwota miesiÄ™czna</strong><div>${data.subscriptionAmount || 'Brak danych'}</div></div>
				<div class="workshop-detail__item"><strong>Start umowy</strong><div>${data.subscriptionStartDate || 'Brak danych'}</div></div>
				<div class="workshop-detail__item"><strong>Koniec okresu 12 mies.</strong><div>${data.subscriptionStartDate && data.subscriptionMonths ? getEndDate(data.subscriptionStartDate, data.subscriptionMonths) : 'Brak danych'}</div></div>
				<div class="workshop-detail__item"><strong>E-mail do faktur</strong><div>${data.billingEmail || 'Brak danych'}</div></div>
			`;
		}
		function getEndDate(start, months) {
			try {
				const d = new Date(start);
				d.setMonth(d.getMonth() + parseInt(months, 10));
				return d.toLocaleDateString('pl-PL');
			} catch { return 'Brak danych'; }
		}
		// Renderuj sekcjÄ™ przy starcie
		renderWorkshopSubscription();

		// --- Synchronizacja: po przeĹ‚Ä…czeniu na zakĹ‚adkÄ™ AktywnoĹ›Ä‡ lub Ustawienia ---
		document.body.addEventListener('click', function (e) {
			if (e.target && e.target.classList.contains('workshop-tab')) {
				setTimeout(() => {
					renderWorkshopSubscription();
					if (settingsForm) {
						const tab = e.target.getAttribute('data-tab');
						if (tab === 'settings') {
							const data = JSON.parse(localStorage.getItem('workshop:settings') || '{}');
							Array.from(settingsForm.elements).forEach(el => {
								if (!el.name) return;
								if (el.type === 'checkbox') {
									el.checked = !!data[el.name];
								} else {
									el.value = data[el.name] || '';
								}
							});
						}
					}
				}, 100);
			}
		});
		const tabButtons = document.querySelectorAll('.tabs .tab');
		const tabContents = document.querySelectorAll('.tab-content');
		if (tabButtons.length) {
			tabButtons.forEach(btn => {
				btn.addEventListener('click', function () {
					// Deactivate all tabs
					tabButtons.forEach(b => b.classList.remove('active'));
					// Hide all contents
					tabContents.forEach(c => c.style.display = 'none');
					// Activate clicked tab
					this.classList.add('active');
					const tab = this.getAttribute('data-tab');
					const content = document.getElementById('tab-' + tab);
					if (content) content.style.display = '';
				});
			});
		}
	});
	const REPORTS_KEY = 'warsztat:reports';
	const VIN_FORM_ID = 'vin-form';
	const VIN_INPUT_ID = 'vin-input';
	const VIN_RESULT_ID = 'vin-result';

	const seedReports = () => {
		if (localStorage.getItem(REPORTS_KEY)) {
			return;
		}

		const demoReports = [
			{
				vin: 'WAUZZZ8V9JA123456',
				workshop: 'Auto Serwis 24',
				status: 'Zakonczona',
				updatedAt: '2024-11-18',
				summary: 'Wymiana rozrzadu oraz oleju.'
			},
			{
				vin: 'VF3LCBHY6HS789012',
				workshop: 'MotorTech Pro',
				status: 'W trakcie',
				updatedAt: '2025-01-05',
				summary: 'Diagnostyka elektroniki silnika.'
			}
		];

		localStorage.setItem(REPORTS_KEY, JSON.stringify(demoReports));
	};

	const loadReports = () => {
		try {
			return JSON.parse(localStorage.getItem(REPORTS_KEY)) || [];
		} catch (error) {
			console.warn('Nie udalo sie odczytac raportow', error);
			return [];
		}
	};

	const validateVin = (value) => /^[A-HJ-NPR-Z0-9]{11,17}$/.test(value);

	const renderResult = (container, vin, reports) => {
		if (!reports.length) {
			container.textContent = 'Brak raportow dla podanego VIN. Wkrotce dodamy wiecej danych.';
			return;
		}

		const items = reports
			.map((report) => `
				<article class="vin-card">
					<header>
						<strong>${report.workshop}</strong>
						<span>Status: ${report.status}</span>
					</header>
					<p>${report.summary}</p>
					<footer>Aktualizacja: ${report.updatedAt}</footer>
				</article>
			`)
			.join('');

		container.innerHTML = `
			<p>Znaleziono ${reports.length} raport(y) dla VIN <strong>${vin}</strong>:</p>
			<div class="vin-card-list">${items}</div>
		`;
	};

	document.addEventListener('DOMContentLoaded', () => {
		seedReports();

		const form = document.getElementById(VIN_FORM_ID);
		const input = document.getElementById(VIN_INPUT_ID);
		const result = document.getElementById(VIN_RESULT_ID);

		if (!form || !input || !result) {
			return;
		}

		form.addEventListener('submit', (event) => {
			event.preventDefault();
			const vin = input.value.trim().toUpperCase();

			if (!validateVin(vin)) {
				result.textContent = 'Podaj poprawny numer VIN (11-17 znakow, bez liter O oraz I).';
				return;
			}

			const reports = loadReports().filter((item) => item.vin === vin);
			renderResult(result, vin, reports);
		});
	});
})();


=== PLIK: js/login.js ===

(function () {
    const ADMIN_CREDENTIALS = { login: 'test', password: 'test' };
    const STORAGE_KEY = 'warsztat:workshops';

    const state = {
        adminAuthenticated: false
    };

    const readWorkshops = () => {
        try {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        } catch (error) {
            console.warn('Blad podczas odczytu warsztatow', error);
            return [];
        }
    };

    const saveWorkshops = (items) => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
    };

    const setFeedback = (element, message, type) => {
        if (!element) {
            return;
        }
        element.textContent = message;
        element.classList.remove('is-error', 'is-success');
        if (type) {
            element.classList.add(type === 'error' ? 'is-error' : 'is-success');
        }
    };

    const renderWorkshopList = (container) => {
        if (!container) {
            return;
        }
        const items = readWorkshops();
        if (!items.length) {
            container.innerHTML = '<li>Brak aktywnych kont. Utworz pierwsze konto.</li>';
            return;
        }
        container.innerHTML = items
            .map((item) => `
                <li>
                    <strong>${item.name}</strong><br>
                    <span>${item.email}</span> | <span>${item.registration}</span>
                </li>
            `)
            .join('');
    };

    document.addEventListener('DOMContentLoaded', () => {
        const adminLoginForm = document.getElementById('admin-login-form');
        const adminFeedback = document.querySelector('[data-feedback="admin"]');
        const adminTools = document.getElementById('admin-tools');
        const createWorkshopForm = document.getElementById('create-workshop-form');
        const workshopList = document.getElementById('workshop-list');
        const workshopLoginForm = document.getElementById('workshop-login-form');
        const workshopFeedback = document.querySelector('[data-feedback="workshop"]');
        const workshopSuccess = document.getElementById('workshop-success');

        renderWorkshopList(workshopList);

        adminLoginForm?.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(adminLoginForm);
            const login = String(formData.get('login') || '').trim();
            const password = String(formData.get('password') || '').trim();

            if (login === ADMIN_CREDENTIALS.login && password === ADMIN_CREDENTIALS.password) {
                state.adminAuthenticated = true;
                adminTools?.classList.remove('is-hidden');
                setFeedback(adminFeedback, 'Zalogowano poprawnie. Mozesz tworzyc konta warsztatow.', 'success');
                adminLoginForm.reset();
            } else {
                setFeedback(adminFeedback, 'Niepoprawne dane logowania administratora.', 'error');
            }
        });

        createWorkshopForm?.addEventListener('submit', (event) => {
            event.preventDefault();
            if (!state.adminAuthenticated) {
                setFeedback(adminFeedback, 'Najpierw zaloguj administratora.', 'error');
                return;
            }

            const formData = new FormData(createWorkshopForm);
            const name = String(formData.get('name') || '').trim();
            const email = String(formData.get('email') || '').trim().toLowerCase();
            const registration = String(formData.get('registration') || '').trim();
            const tempPassword = String(formData.get('tempPassword') || '').trim();

            if (!name || !email || !registration || !tempPassword) {
                setFeedback(adminFeedback, 'Uzupelnij wszystkie pola formularza.', 'error');
                return;
            }

            const workshops = readWorkshops();
            if (workshops.some((item) => item.email === email)) {
                setFeedback(adminFeedback, 'Warsztat z tym adresem e-mail juz istnieje.', 'error');
                return;
            }

            workshops.push({
                id: Date.now(),
                name,
                email,
                registration,
                password: tempPassword
            });
            saveWorkshops(workshops);
            renderWorkshopList(workshopList);
            createWorkshopForm.reset();
            setFeedback(adminFeedback, 'Nowe konto warsztatu zostalo utworzone.', 'success');
        });

        workshopLoginForm?.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(workshopLoginForm);
            const email = String(formData.get('email') || '').trim().toLowerCase();
            const password = String(formData.get('password') || '').trim();

            const match = readWorkshops().find((item) => item.email === email && item.password === password);

            if (match) {
                setFeedback(workshopFeedback, `Zalogowano jako ${match.name}.`, 'success');
                workshopSuccess?.classList.remove('is-hidden');
                workshopSuccess.querySelector('h3').textContent = `Witaj, ${match.name}!`;
                workshopLoginForm.reset();
            } else {
                setFeedback(workshopFeedback, 'Niepoprawne dane logowania warsztatu.', 'error');
            }
        });
    });
})();



=== PLIK: css/styles.css ===

:root {
    --color-primary: #0b3d60;
    --color-primary-dark: #06253a;
    --color-secondary: #1c7ed6;
    --color-bg: #f4f6f8;
    --color-card: #ffffff;
    --color-text: #1f2a37;
    --color-muted: #6b7785;
    --radius: 14px;
    --shadow-soft: 0 15px 35px rgba(15, 23, 42, 0.12);
    font-size: 16px;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--color-bg);
    color: var(--color-text);
}

.site-body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.site-header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 5vw;
    background: #ffffff;
    border-bottom: 1px solid #e4e7eb;
    position: sticky;
    top: 0;
    z-index: 5;
}

.site-header__brand {
    max-width: 420px;
}

.site-header__logo {
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--color-primary);
    text-decoration: none;
}

.site-header__logo--accent {
    color: var(--color-secondary);
}

.site-header__tagline {
    margin: 0.1rem 0 0;
    color: var(--color-muted);
    font-size: 0.9rem;
}

.site-nav {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.site-nav__link,
.site-nav__cta {
    text-decoration: none;
    font-weight: 600;
    color: var(--color-primary);
    padding: 0.5rem 0.75rem;
    border-radius: 999px;
}

.site-nav__cta {
    background: var(--color-primary);
    color: #ffffff;
}

.hero {
    padding: 4rem 5vw 3rem;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
    align-items: center;
}

.hero__content {
    max-width: 540px;
}

.hero__eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-size: 0.75rem;
    color: var(--color-secondary);
    margin-bottom: 0.5rem;
}

.hero__lead {
    font-size: 1.1rem;
    color: var(--color-muted);
}

.hero__actions {
    margin-top: 1.5rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.hero__stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    background: #ffffff;
    padding: 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-soft);
}

.hero__stats strong {
    display: block;
    font-size: 1.8rem;
    color: var(--color-primary);
}

.hero__stats span {
    font-size: 0.9rem;
    color: var(--color-muted);
}

.section {
    padding: 3rem 5vw;
}

.section--highlight {
    background: #ffffff;
}

.section--alt {
    background: #0f172a;
    color: #f4f6f8;
}

.section__header {
    max-width: 640px;
    margin-bottom: 2rem;
}

.section__eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-size: 0.75rem;
    color: var(--color-secondary);
    margin-bottom: 0.4rem;
}

/* --- Warsztat Panel Tabs --- */
.tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}
.tab {
    background: #f4f6f8;
    border: none;
    border-radius: 6px 6px 0 0;
    padding: 0.7rem 1.5rem;
    font-size: 1rem;
    cursor: pointer;
    color: #222;
    transition: background 0.2s, color 0.2s;
}
.tab.active {
    background: var(--color-primary);
    color: #fff;
    font-weight: bold;
}
.tab-content {
    background: #fff;
    border-radius: 0 0 8px 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    padding: 2rem 1.5rem;
    margin-bottom: 2rem;
}
.notepad {
    width: 100%;
    min-height: 80px;
    margin-top: 1rem;
    padding: 0.7rem;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    font-size: 1rem;
    resize: vertical;
}
.reports-placeholder, .logs-placeholder, .contacts-placeholder {
    color: #888;
    font-style: italic;
    margin: 1rem 0;
}

.card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
}

.card {
    background: var(--color-card);
    padding: 1.75rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-soft);
}

.card h3 {
    margin-top: 0;
}

.vin-form {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
}

.vin-form input {
    flex: 1;
    min-width: 220px;
    padding: 0.9rem 1rem;
    border-radius: 999px;
    border: 1px solid #d0d7e2;
    font-size: 1rem;
}

.vin-result {
    min-height: 2rem;
    font-size: 0.95rem;
    color: var(--color-muted);
}

.vin-card-list {
    display: grid;
    gap: 1rem;
    margin-top: 1rem;
}

.vin-card {
    background: #f8fafc;
    border: 1px solid #e4e7eb;
    border-radius: var(--radius);
    padding: 1rem 1.25rem;
}

.vin-card header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    font-size: 0.95rem;
}

.vin-card footer {
    margin-top: 0.5rem;
    font-size: 0.85rem;
    color: var(--color-muted);
}

.steps {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
}

.steps li {
    background: rgba(255, 255, 255, 0.08);
    border-radius: var(--radius);
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.site-footer {
    margin-top: auto;
    padding: 1.5rem 5vw;
    background: #0b1624;
    color: #dbe2ef;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
}

.btn {
    border: none;
    border-radius: 999px;
    padding: 0.85rem 1.7rem;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.btn--primary {
    background: var(--color-primary);
    color: #ffffff;
    box-shadow: var(--shadow-soft);
}

.btn--secondary {
    background: var(--color-secondary);
    color: #ffffff;
}

.btn--ghost {
    border: 1px solid var(--color-primary);
    color: var(--color-primary);
    background: transparent;
}

.btn:hover {
    transform: translateY(-2px);
}

.ghost-link {
    color: #90a4b7;
    text-decoration: none;
    font-size: 0.85rem;
    opacity: 0.65;
}

.ghost-link:focus,
.ghost-link:hover {
    opacity: 1;
}

.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    border: 0;
}

.auth-body {
    background: radial-gradient(circle at top, #0b3d60, #050e17);
    min-height: 100vh;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
}

.auth {
    width: min(1100px, 100%);
    background: #ffffff;
    border-radius: 24px;
    padding: 2.5rem;
    box-shadow: 0 30px 60px rgba(3, 18, 37, 0.35);
}

.auth__home-link {
    display: inline-flex;
    margin-bottom: 1rem;
}

.auth__intro {
    margin-bottom: 2rem;
}

.auth__eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.3em;
    font-size: 0.75rem;
    color: var(--color-secondary);
}

.auth__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
}

.auth-card {
    background: #f8fafc;
    padding: 1.5rem;
    border-radius: var(--radius);
    border: 1px solid #e4e7eb;
}

.auth-card__hint {
    color: var(--color-muted);
}

.auth-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin: 1rem 0;
}

.auth-form label {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--color-text);
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
}

.auth-form input {
    border-radius: 12px;
    border: 1px solid #d0d7e2;
    padding: 0.75rem 1rem;
    font-size: 1rem;
}

.auth-card__feedback {
    min-height: 1.5rem;
    font-size: 0.9rem;
    color: var(--color-muted);
}

.auth-card__feedback.is-success {
    color: #1b9c58;
}

.auth-card__feedback.is-error {
    color: #c92a2a;
}

.admin-tools {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #d0d7e2;
}

.auth-form--compact label input {
    background: #ffffff;
}

.workshop-list {
    margin-top: 1rem;
}

.workshop-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.workshop-list li {
    background: #ffffff;
    border-radius: 12px;
    padding: 0.9rem 1rem;
    border: 1px solid #e4e7eb;
    font-size: 0.9rem;
}

.auth-success {
    margin-top: 1rem;
    padding: 1rem;
    background: #e6f4ea;
    border-radius: 12px;
    border: 1px solid #b7dfc1;
}

.is-hidden {
    display: none !important;
}

@media (max-width: 768px) {
    .site-nav {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
        margin-top: 1rem;
    }

    .site-footer {
        flex-direction: column;
        gap: 1rem;
    }
}


=== PLIK: css/base/core.css ===

:root {
    --color-primary: #0b3d60;
    --color-primary-dark: #06253a;
    --color-secondary: #1c7ed6;
    --color-bg: #f4f6f8;
    --color-card: #ffffff;
    --color-text: #1f2a37;
    --color-muted: #6b7785;
    --radius: 14px;
    --shadow-soft: 0 15px 35px rgba(15, 23, 42, 0.12);
    font-size: 16px;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--color-bg);
    color: var(--color-text);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
}

a {
    color: inherit;
}

ul {
    margin: 0;
    padding: 0;
    list-style: none;
}

.btn {
    border: none;
    border-radius: 999px;
    padding: 0.85rem 1.7rem;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.btn--primary {
    background: var(--color-primary);
    color: #ffffff;
    box-shadow: var(--shadow-soft);
}

.btn--secondary {
    background: var(--color-secondary);
    color: #ffffff;
}

.btn--ghost {
    border: 1px solid var(--color-primary);
    color: var(--color-primary);
    background: transparent;
}

.btn:hover {
    transform: translateY(-2px);
}

.btn:focus-visible,
.site-nav__link:focus-visible,
.site-nav__cta:focus-visible,
.ghost-link:focus-visible {
    outline: 2px solid var(--color-secondary);
    outline-offset: 3px;
}

.ghost-link {
    color: #90a4b7;
    text-decoration: none;
    font-size: 0.85rem;
    opacity: 0.65;
}

.ghost-link:focus,
.ghost-link:hover {
    opacity: 1;
}

.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    border: 0;
}

.is-hidden {
    display: none !important;
}



=== PLIK: css/landing/page.css ===

.site-body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.site-header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 5vw;
    background: #ffffff;
    border-bottom: 1px solid #e4e7eb;
    position: sticky;
    top: 0;
    z-index: 5;
}

.site-header__brand {
    max-width: 420px;
}

.site-header__logo {
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--color-primary);
    text-decoration: none;
}

.site-header__logo--accent {
    color: var(--color-secondary);
}

.site-header__tagline {
    margin: 0.1rem 0 0;
    color: var(--color-muted);
    font-size: 0.9rem;
}

.site-nav {
    display: flex;
    gap: 1rem;
    align-items: center;
    transition: max-height 0.3s ease;
}

.site-nav__link,
.site-nav__cta {
    text-decoration: none;
    font-weight: 600;
    color: var(--color-primary);
    padding: 0.5rem 0.75rem;
    border-radius: 999px;
}

.site-nav__cta {
    background: var(--color-primary);
    color: #ffffff;
}

.site-nav__toggle {
    display: none;
    flex-direction: column;
    gap: 0.25rem;
    background: transparent;
    border: none;
    cursor: pointer;
}

.site-nav__toggle span {
    width: 28px;
    height: 2px;
    background: var(--color-primary);
}

.hero {
    padding: 4rem 5vw 3rem;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
    align-items: center;
    background: linear-gradient(135deg, #f5f8fb 0%, #e6eef7 50%, #ffffff 100%);
}

.hero__content {
    max-width: 540px;
}

.hero__eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-size: 0.75rem;
    color: var(--color-secondary);
    margin-bottom: 0.5rem;
}

.hero__lead {
    font-size: 1.1rem;
    color: var(--color-muted);
}

.hero__note {
    margin-top: 1rem;
    font-size: 0.95rem;
    color: var(--color-muted);
}

.hero__actions {
    margin-top: 1.5rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.hero__stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    background: #ffffff;
    padding: 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-soft);
}

.hero__stats strong {
    display: block;
    font-size: 1.8rem;
    color: var(--color-primary);
}

.hero__stats span {
    font-size: 0.9rem;
    color: var(--color-muted);
}

.section {
    padding: 3rem 5vw;
}

.section--highlight {
    background: #ffffff;
}

.section--alt {
    background: #0f172a;
    color: #f4f6f8;
}

.section__header {
    max-width: 640px;
    margin-bottom: 2rem;
}

.section__eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-size: 0.75rem;
    color: var(--color-secondary);
    margin-bottom: 0.4rem;
}

.card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
}

.card {
    background: var(--color-card);
    padding: 1.75rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-soft);
}

.card h3 {
    margin-top: 0;
}

.vin-form {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
}

.vin-form input {
    flex: 1;
    min-width: 220px;
    padding: 0.9rem 1rem;
    border-radius: 999px;
    border: 1px solid #d0d7e2;
    font-size: 1rem;
}

.vin-result {
    min-height: 2rem;
    font-size: 0.95rem;
    color: var(--color-muted);
}

.vin__hint {
    font-size: 0.9rem;
    color: var(--color-muted);
    margin-top: 0.5rem;
}

.vin-card-list {
    display: grid;
    gap: 1rem;
    margin-top: 1rem;
}

.vin-card {
    background: #f8fafc;
    border: 1px solid #e4e7eb;
    border-radius: var(--radius);
    padding: 1rem 1.25rem;
}

.vin-card header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    font-size: 0.95rem;
}

.vin-card__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin: 0.5rem 0;
    font-size: 0.85rem;
    color: var(--color-muted);
}

.vin-card-media {
    list-style: none;
    margin: 0.5rem 0 0;
    padding: 0;
    font-size: 0.85rem;
}

.vin-card-media li + li {
    margin-top: 0.25rem;
}

.vin-card-media a {
    color: var(--color-primary);
    text-decoration: underline;
}

.vin-card footer {
    margin-top: 0.5rem;
    font-size: 0.85rem;
    color: var(--color-muted);
}

.steps {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
}

.steps li {
    background: rgba(255, 255, 255, 0.08);
    border-radius: var(--radius);
    padding: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.insights-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.25rem;
}

.insight {
    background: #ffffff;
    border-radius: var(--radius);
    padding: 1.5rem;
    box-shadow: var(--shadow-soft);
    min-height: 150px;
}

.insight__value {
    font-size: 2rem;
    color: var(--color-primary);
    font-weight: 700;
}

.insight__text {
    margin-top: 0.5rem;
    color: var(--color-muted);
    line-height: 1.4;
}

.cta {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 1.5rem;
    align-items: center;
    border-radius: var(--radius);
    box-shadow: var(--shadow-soft);
}

.cta__actions {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    min-width: 220px;
}

.site-footer {
    margin-top: auto;
    padding: 1.5rem 5vw;
    background: #0b1624;
    color: #dbe2ef;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
}

@media (max-width: 768px) {
    .site-nav__toggle {
        display: flex;
    }

    .site-nav {
        width: 100%;
        flex-direction: column;
        max-height: 0;
        overflow: hidden;
    }

    .site-nav.is-open {
        max-height: 320px;
        padding-top: 1rem;
    }

    .site-footer {
        flex-direction: column;
        gap: 1rem;
    }

    .cta {
        flex-direction: column;
    }
}



=== PLIK: css/panel/page.css ===

.panel-back-btn--absolute {
    position: absolute;
    top: 2.5rem;
    left: 2.5rem;
    z-index: 10;
}
.panel-section {
    position: relative;
}
.workshop-tab-content#tab-settings,
.workshop-tab-content#tab-settings * {
    color: #111 !important;
}
.workshop-tab-content#tab-settings .panel-form {
    margin-top: 1.5rem;
    max-width: 540px;
}
.workshop-tab-content#tab-settings fieldset {
    border: 1px solid #d1d5db;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1.5rem;
    background: #f8fafc;
}
.workshop-tab-content#tab-settings legend {
    font-weight: 600;
    margin-bottom: 0.5rem;
}
.workshop-tab-content#tab-reports,
.workshop-tab-content#tab-reports * {
    color: #111 !important;
}
.workshop-tab-content#tab-reports .panel-filters {
    margin-bottom: 1.5rem;
}
.workshop-tab-content#tab-reports #workshop-reports-list {
    margin-top: 1.5rem;
    font-size: 1rem;
    color: #444;
}
.workshop-detail-shell__layout,
.workshop-detail-shell__layout * {
    color: #111 !important;
}
.workshop-tab-content#tab-contacts,
.workshop-tab-content#tab-contacts * {
    color: #111 !important;
}
.panel-body {
    min-height: 100vh;
    background: var(--color-bg);
    display: flex;
    flex-direction: column;
}

.panel-layout {
    flex: 1;
    display: grid;
    grid-template-columns: 260px minmax(0, 1fr);
    min-height: 100vh;
    width: 100%;
}

.panel-sidebar {
    background: linear-gradient(180deg, #0f172a 0%, #1d2845 100%);
    color: #ffffff;
    padding: 2.5rem 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 2rem;
    box-shadow: inset -1px 0 0 rgba(255, 255, 255, 0.08);
    position: sticky;
    top: 0;
    align-self: start;
    height: 100vh;
    overflow-y: auto;
}

.panel-sidebar__brand {
    font-size: 1.5rem;
    font-weight: 700;
}

.panel-body--workshop .panel-sidebar,
.panel-body--workshop .panel-nav,
.panel-body--workshop .panel-section:not(.panel-section--summary):not(.panel-section--narrow) {
    display: none;
}

.panel-body--workshop .panel-main {
    padding-top: 1.5rem;
}

.panel-body--workshop .panel-view--workshop {
    display: flex;
}

.panel-body--workshop .panel-layout {
    grid-template-columns: minmax(0, 1fr);
}

.panel-sidebar__brand span {
    color: var(--color-secondary);
}

.panel-nav {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.panel-nav__link {
    background: transparent;
    border: none;
    text-align: left;
    padding: 0.65rem 1rem;
    border-radius: 10px;
    color: inherit;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s ease;
}

.panel-nav__link.is-active,
.panel-nav__link:hover {
    background: rgba(255, 255, 255, 0.1);
}

.panel-content {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.panel-back-btn-container {
    margin: 2rem 0 0 0;
    display: flex;
    align-items: flex-start;
}
.panel-back-btn {
    margin-left: 0;
    margin-bottom: 0.5rem;
    font-size: 1rem;
    padding: 0.7rem 1.5rem;
    border-radius: 24px;
    border: 1px solid #d1d5db;
    background: #fff;
    color: #222;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
}
.panel-back-btn:hover {
    background: #f3f4f6;
    color: var(--color-primary);
}

.panel-header {
    background: #ffffff;
    border-bottom: 1px solid #e4e7eb;
    padding: 1.25rem 2.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.panel-header__info {
    display: flex;
    flex-direction: column;
}

.panel-header__subtitle {
    color: var(--color-muted);
    font-size: 0.9rem;
}

.panel-main {
    flex: 1;
    padding: 2.5rem;
    overflow-y: auto;
    background: linear-gradient(180deg, #f6f8fb 0%, #f1f5f9 100%);
}

.panel-view {
    display: none;
}

.panel-view.is-active {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
}

.panel-section {
    width: 100%;
}

.panel-section--summary {
    max-width: 1100px;
}

.panel-section--narrow {
    max-width: 720px;
    margin: 0 auto;
}

.panel-section--split .panel-split {
    display: grid;
    grid-template-columns: minmax(0, 2.2fr) minmax(280px, 1fr);
    gap: 2rem;
    align-items: flex-start;
}

.panel-section__header,
.panel-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.panel-toolbar__actions {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.panel-section__eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: 0.75rem;
    color: var(--color-muted);
    margin: 0 0 0.35rem;
}

.panel-section__hint {
    max-width: 320px;
    font-size: 0.9rem;
    color: var(--color-muted);
    margin: 0;
}

.panel-card {
    background: #ffffff;
    border-radius: var(--radius);
    padding: 1.75rem;
    box-shadow: var(--shadow-soft);
    border: 1px solid #e4e7eb;
}

.panel-card h2,
.panel-card h3 {
    margin-top: 0;
}

.panel-card__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
}

.panel-card--inactive {
    padding-top: 1.5rem;
}

.panel-card--surface {
    padding: 2rem;
}

.panel-card--aside {
    height: 100%;
    position: sticky;
    top: 2.5rem;
}

.panel-card--logs {
    padding-top: 1.5rem;
    height: 100%;
}

.panel-card--audit {
    padding-top: 1.5rem;
    height: 100%;
}

.panel-card--workshop {
    min-height: 200px;
}

/* Poprawa kontrastu tekstu placeholderĂłw w szczegĂłĹ‚ach warsztatu */
.workshop-detail__grid .placeholder,
.workshop-detail__section .placeholder,
.panel-card .placeholder,
.workshop-detail__grid [class*="empty"],
.workshop-detail__section [class*="empty"],
.panel-card [class*="empty"] {
    color: #374151 !important; /* ciemny szary dla lepszej widocznoĹ›ci */
    opacity: 1 !important;
    font-weight: 500;
}

/* Poprawa kontrastu tekstu placeholderĂłw */
.workshop-detail__grid .placeholder,
.workshop-detail__section .placeholder,
.panel-card .placeholder {
    color: #6b7280 !important; /* ciemniejszy szary */
    opacity: 1 !important;
}

/* --- Warsztat: zakĹ‚adki szczegĂłĹ‚Ăłw --- */
.workshop-tabs {
    margin-bottom: 2rem;
}
.workshop-tabs__nav {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}
.workshop-tab {
    background: #f4f6f8;
    border: none;
    border-radius: 8px 8px 0 0;
    padding: 0.7rem 1.5rem;
    font-size: 1rem;
    cursor: pointer;
    color: #222;
    transition: background 0.2s, color 0.2s;
    font-weight: 500;
}
.workshop-tab.active {
    background: var(--color-primary);
    color: #fff;
    font-weight: bold;
}
.workshop-tabs__content {
    background: #fff;
    border-radius: 0 0 12px 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    padding: 2rem 1.5rem;
    margin-bottom: 2rem;
}
.workshop-tab-content {
    display: block;
}
.workshop-notepad {
    width: 100%;
    min-height: 80px;
    margin-top: 1rem;
    padding: 0.7rem;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    font-size: 1rem;
    resize: vertical;
}

.workshop-summary {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.workshop-summary strong {
    font-size: 1.25rem;
}

.workshop-summary small {
    color: var(--color-muted);
}

.workshop-summary__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
}

.workshop-summary__meta span {
    font-size: 0.9rem;
    color: var(--color-muted);
}

.workshop-summary__contract {
    margin-top: 1.25rem;
    padding-top: 1rem;
    border-top: 1px solid #e4e7eb;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.panel-body--workshop .panel-section__hint {
    max-width: 540px;
}

.panel-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}


.panel-grid--summary {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.25rem;
}

.panel-grid--overview-cards {
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
    align-items: stretch;
}

.metric-card {
    background: #ffffff;
    border-radius: var(--radius);
    padding: 1.25rem;
    border: 1px solid #e4e7eb;
    min-height: 160px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    text-align: left;
    color: inherit;
    width: 100%;
    cursor: default;
}

.metric-card--action {
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.metric-card--action:hover,
.metric-card--action:focus-visible {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(15, 23, 42, 0.15);
    outline: none;
}

.metric-card strong {
    display: block;
    font-size: 2rem;
    color: var(--color-primary);
}

.metric-card small {
    color: var(--color-muted);
}

.panel-form,
.panel-filters {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.panel-form--stacked {
    gap: 0.75rem;
    border: 1px solid #edf0f4;
    border-radius: 16px;
    padding: 1.25rem;
    background: #f8fafc;
}

.panel-form__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
}

.panel-form__meta--two > label {
    flex: 1 1 200px;
}

.panel-form label,
.panel-filters label {
    font-weight: 600;
    font-size: 0.9rem;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
}

.panel-form__hint {
    font-size: 0.8rem;
    color: var(--color-muted);
}

.panel-form input,
.panel-form select,
.panel-form textarea,
.panel-filters input,
.panel-filters select {
    border-radius: 12px;
    border: 1px solid #d0d7e2;
    padding: 0.75rem 1rem;
    font-size: 1rem;
}

.panel-form textarea,
.panel-filters textarea {
    resize: vertical;
}

.panel-form--grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 1.5rem;
}

.panel-form--grid label:nth-child(2) {
    grid-column: span 2;
}

.panel-form__actions {
    margin-top: 0.5rem;
    display: flex;
    justify-content: flex-start;
}

.panel-form__actions--spread {
    justify-content: space-between;
    gap: 1rem;
}

.panel-form__actions--end {
    justify-content: flex-end;
}

.panel-filters--inline {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.25rem;
    align-items: end;
}

.panel-filters--surface {
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8fbff 0%, #ffffff 100%);
    border: 1px solid #dce7f5;
    border-radius: 18px;
    box-shadow: 0 15px 30px rgba(15, 23, 42, 0.08);
}

.panel-filters--surface label input,
.panel-filters--surface label select {
    background: #ffffff;
    border-color: #d0dff2;
    box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.04);
}

.panel-filters--surface label input:focus,
.panel-filters--surface label select:focus {
    border-color: var(--color-secondary);
    box-shadow: 0 0 0 2px rgba(28, 126, 214, 0.15);
    outline: none;
}

.panel-filters__actions {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 0.75rem;
}

.panel-list {
    margin-top: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.panel-list--grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
    max-width: 1100px;
    margin-left: auto;
    margin-right: auto;
}

.workshop-browser {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.workshop-browser--detail {
    border-radius: 28px;
    padding: 2rem;
    background: linear-gradient(120deg, #0f172a 0%, #172554 50%, #1e3a8a 100%);
    color: #f8fbff;
    border: 1px solid rgba(255, 255, 255, 0.12);
    box-shadow: 0 30px 60px rgba(15, 23, 42, 0.35);
    position: relative;
    overflow: hidden;
}

.workshop-browser--detail::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.25), transparent 55%);
    pointer-events: none;
}

.workshop-browser--detail > * {
    position: relative;
    z-index: 1;
}

.workshop-browser[hidden] {
    display: none;
}

.panel-list__item {
    border: 1px solid #edf0f4;
    border-radius: 12px;
    padding: 1rem 1.25rem;
    background: #f8fafc;
    display: flex;
    justify-content: space-between;
    gap: 1.5rem;
    flex-wrap: wrap;
}

.panel-workshop-card {
    background: #ffffff;
    border-radius: 20px;
    padding: 1.5rem;
    border: 1px solid #e4e7eb;
    box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
    min-height: 220px;
    height: 100%;
}

.panel-workshop-card[data-workshop-card] {
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.panel-workshop-card[data-workshop-card]:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 32px rgba(15, 23, 42, 0.12);
}

.panel-workshop-card__header {
    display: flex;
    justify-content: space-between;
    gap: 0.85rem 1rem;
    align-items: flex-start;
    flex-wrap: wrap;
}

.panel-workshop-card__identity {
    display: flex;
    gap: 0.85rem;
    flex: 1;
    min-width: 0;
    align-items: center;
}

.panel-workshop-card__identity > div {
    min-width: 0;
}

.panel-workshop-card__identity strong {
    display: block;
    font-size: 1rem;
    line-height: 1.2;
    overflow-wrap: anywhere;
}

.panel-workshop-card__avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, #0ea5e9, #2563eb);
    color: #ffffff;
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    line-height: 1;
}

.panel-workshop-card__location {
    margin: 0.2rem 0 0;
    color: var(--color-muted);
    font-size: 0.9rem;
}

.panel-workshop-card__contact {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 1rem 1.25rem;
    background: #f8fafc;
    border: 1px solid #edf0f4;
    border-radius: 16px;
    min-height: 96px;
}

.panel-workshop-card__contact-item {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
}

.panel-workshop-card__contact-item small {
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: 0.7rem;
    color: var(--color-muted);
}

.panel-workshop-card__contact-item span {
    font-weight: 600;
    color: var(--color-text);
}

.panel-workshop-card__stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 0.75rem;
    margin-top: auto;
}

.panel-workshop-card__stat {
    background: #f8fafc;
    border-radius: 14px;
    padding: 0.75rem 1rem;
    border: 1px solid #edf0f4;
    min-height: 90px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.25rem;
}

.panel-workshop-card__stat strong {
    display: block;
    font-size: 1.1rem;
    color: var(--color-primary);
}

.panel-workshop-card__stat small {
    color: var(--color-muted);
    font-size: 0.8rem;
}

.panel-workshop-card__actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
}

.panel-tag--notice {
    background: rgba(250, 176, 5, 0.15);
    color: #b35300;
    border-color: transparent;
}

.panel-list__item--stacked {
    flex-direction: column;
    align-items: flex-start;
}

.panel-billing-amount {
    margin-top: 0.5rem;
    font-weight: 600;
}

.panel-contract-info {
    margin-top: 0.75rem;
    font-size: 0.9rem;
    color: var(--color-muted);
}

.panel-list__item-actions {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    align-items: stretch;
}

.panel-list__item-actions--compact {
    align-items: flex-end;
    gap: 0.35rem;
}

.panel-mini-list {
    list-style: none;
    margin: 1.5rem 0 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.85rem;
}

.panel-mini-list li {
    border: 1px dashed #dfe4ec;
    border-radius: 10px;
    padding: 0.75rem 1rem;
    background: #f8fafc;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
}

.panel-mini-list strong {
    font-size: 0.95rem;
}

.panel-mini-list small {
    color: var(--color-muted);
}

.panel-list__item-actions .btn {
    width: 100%;
    border-radius: 10px;
    padding: 0.4rem 0.75rem;
    font-size: 0.85rem;
}

.panel-media-section {
    border: 1px solid #edf0f4;
    border-radius: 12px;
    padding: 1rem;
    background: #f8fafc;
}

.panel-media-section__title {
    margin: 0 0 0.5rem;
    font-weight: 600;
}

.panel-media-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.75rem;
}

.panel-media-gallery--readonly {
    min-height: 60px;
}

.panel-media-gallery--inline {
    margin-top: 0.75rem;
}

.panel-media-card {
    border: 1px solid #d0d7e2;
    border-radius: 10px;
    padding: 0.5rem;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
}

.panel-media-card strong {
    font-size: 0.85rem;
}

.panel-media-card small {
    color: var(--color-muted);
    font-size: 0.75rem;
}

.panel-media-thumb {
    width: 100%;
    border-radius: 8px;
    object-fit: cover;
    max-height: 140px;
}

.panel-media-thumb--video {
    background: #0f172a;
}

.panel-report-meta {
    list-style: none;
    padding: 0;
    margin: 0.5rem 0;
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    font-size: 0.85rem;
    color: var(--color-muted);
}

.panel-upload input[type="file"] {
    border: 1px dashed #94a3b8;
    background: #f8fafc;
}

.panel-upload small {
    color: var(--color-muted);
    font-weight: 400;
}

.panel-upload__list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.panel-upload__list li {
    font-size: 0.85rem;
    color: var(--color-muted);
    display: flex;
    justify-content: space-between;
    padding: 0.35rem 0.5rem;
    border-bottom: 1px solid #e4e7eb;
}

.panel-upload__list li:last-child {
    border-bottom: none;
}

.panel-upload__warning {
    color: #c92a2a;
    font-weight: 600;
}

.panel-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.65rem;
}

.panel-tag {
    display: inline-flex;
    align-items: center;
    padding: 0.15rem 0.75rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 600;
    background: #e4e7eb;
    color: #0b1624;
}

.panel-tag--success {
    background: #d3f9d8;
    color: #0b6534;
}

.panel-tag--warning {
    background: #ffe3e3;
    color: #c92a2a;
}

.panel-tag--danger {
    background: #ffd3d3;
    color: #a61b1b;
}

.panel-tag--muted {
    background: #e2e8f0;
    color: #475569;
}

.panel-list__item small {
    color: var(--color-muted);
}

.panel-list__contact {
    margin: 0.25rem 0 0;
    font-size: 0.9rem;
    color: var(--color-muted);
}

.panel-report-moderation {
    display: block;
    margin-top: 0.35rem;
    font-size: 0.85rem;
    color: var(--color-muted);
}

.panel-report-note {
    margin-top: 0.75rem;
    padding: 0.65rem 0.75rem;
    border-radius: 10px;
    background: #f1f5fb;
    font-size: 0.9rem;
    color: var(--color-text);
}

.panel-report-note--danger {
    background: #ffe3e3;
    color: #a61b1b;
}

.panel-alert {
    background: #e6f4ea;
    border: 1px solid #b7dfc1;
    border-radius: 12px;
    padding: 1rem;
    color: #0b6534;
}

.panel-feedback {
    min-height: 1.25rem;
    font-size: 0.9rem;
    color: var(--color-muted);
    margin-top: 0.75rem;
}

.panel-feedback.is-success {
    color: #1b9c58;
}

.panel-feedback.is-error {
    color: #c92a2a;
}

.panel-log {
    list-style: none;
    margin: 1rem 0 0;
    padding: 0;
    max-height: 260px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 0.85rem;
}

.panel-log--tall {
    max-height: 460px;
    border: 1px solid #e4e7eb;
    border-radius: 12px;
    padding: 1rem;
    background: #f8fafc;
}

.panel-log--audit {
    max-height: none;
}

.panel-log li,
.panel-log div {
    font-size: 0.9rem;
    line-height: 1.4;
}

.panel-empty {
    color: var(--color-muted);
}

.panel-drawer {
    position: fixed;
    top: 0;
    right: 0;
    width: min(420px, 90vw);
    height: 100vh;
    background: #ffffff;
    box-shadow: -8px 0 24px rgba(15, 23, 42, 0.15);
    padding: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
    transform: translateX(100%);
    transition: transform 0.25s ease;
    z-index: 1000;
}

.panel-drawer--form {
    width: min(480px, 95vw);
    gap: 1.5rem;
    padding-bottom: 2.5rem;
}

.panel-form--drawer {
    flex: 1;
    overflow-y: auto;
    padding-right: 0.25rem;
    gap: 1.25rem;
}

.panel-drawer--detail {
    width: min(560px, 95vw);
    gap: 1.5rem;
}

.panel-drawer.is-open {
    transform: translateX(0);
}

.panel-drawer__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
}

.panel-drawer__lead {
    margin: 0;
    color: var(--color-muted);
}

.panel-drawer__content {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.panel-drawer__item {
    border: 1px solid #e4e7eb;
    border-radius: 12px;
    padding: 0.85rem 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    background: #f8fafc;
}

.panel-drawer__item strong {
    font-size: 0.95rem;
}

.panel-drawer__item small {
    color: var(--color-muted);
}

.panel-drawer__backdrop {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.3);
    z-index: 999;
}

.panel-drawer__backdrop[hidden] {
    display: none;
}

.workshop-detail {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.workshop-detail-shell {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.workshop-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    margin: 1.5rem 0 0;
    padding: 1rem 1.5rem;
    border: 1px solid #d7e2f3;
    border-radius: 18px;
    background: linear-gradient(120deg, #f7fbff 0%, #ffffff 100%);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8);
}

.workshop-toolbar--detail {
    margin-top: 0;
}

.workshop-toolbar__back {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
}

.workshop-toolbar__back::before {
    content: '\2190';
    font-size: 1rem;
}

.workshop-toolbar__hint {
    margin: 0;
    font-size: 0.95rem;
    color: var(--color-muted);
}

.workshop-toolbar[hidden] {
    display: none !important;
}

.workshop-detail-shell__toolbar {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    align-items: flex-start;
}

.workshop-detail-shell__actions {
    display: flex;
    gap: 0.75rem;
}

.workshop-detail-shell__layout {
    display: grid;
    grid-template-columns: minmax(0, 2fr) minmax(320px, 1fr);
    gap: 2rem;
    align-items: start;
}

.workshop-detail-shell__primary {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    background: rgba(15, 23, 42, 0.35);
    border-radius: 24px;
    padding: 1.75rem;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.workshop-detail-shell__primary,
.workshop-detail-shell__primary h4,
.workshop-detail-shell__primary p,
.workshop-detail-shell__primary strong,
.workshop-detail-shell__primary small {
    color: #f8fbff;
}

.workshop-detail-shell__primary .panel-section__eyebrow {
    color: rgba(248, 251, 255, 0.75);
}

.workshop-detail-shell__primary .workshop-detail__stat {
    background: rgba(15, 23, 42, 0.55);
    border-color: rgba(248, 251, 255, 0.25);
}

.workshop-detail-shell__primary .workshop-detail__stat small {
    color: rgba(248, 251, 255, 0.75);
}

.workshop-detail-shell__primary .workshop-detail__stat strong {
    color: #ffffff;
}

.workshop-detail-shell__aside {
    background: #ffffff;
    border-radius: 24px;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
    box-shadow: 0 25px 45px rgba(15, 23, 42, 0.25);
    color: var(--color-text);
}

.workshop-detail-shell__aside .panel-section__eyebrow,
.workshop-detail-shell__aside h4 {
    color: var(--color-text);
}

.workshop-detail__section--compact {
    border: none;
    padding: 0;
}

.workshop-billing-form {
    background: #f8fbff;
    border: 1px solid #dbe7fb;
    border-radius: 20px;
    padding: 1.25rem;
    box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.05);
}

.workshop-detail__header {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    align-items: flex-start;
}

.workshop-detail__address {
    margin: 0.15rem 0 0.35rem;
    color: var(--color-muted);
}

.workshop-detail__meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    color: var(--color-muted);
    font-size: 0.9rem;
}

.workshop-detail__meta span:not(.panel-tag) {
    background: #f1f5fb;
    padding: 0.2rem 0.65rem;
    border-radius: 999px;
}

.workshop-detail__actions {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    align-items: flex-end;
}

.workshop-detail__notes {
    margin: 0.5rem 0 0;
    padding: 0.75rem 1rem;
    border-left: 3px solid var(--color-secondary);
    background: #f8fbff;
    border-radius: 12px;
    font-size: 0.9rem;
}

.workshop-detail__section {
    border-top: 1px solid #e4e7eb;
    padding-top: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.workshop-detail__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 0.85rem;
}

.workshop-detail__stat {
    background: #f8fafc;
    border: 1px solid #edf0f4;
    border-radius: 16px;
    padding: 0.85rem 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
}

.workshop-detail__stat small {
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.75rem;
    color: var(--color-muted);
}

.workshop-detail__stat strong {
    font-size: 1rem;
}

.workshop-detail__stat span {
    font-size: 0.85rem;
    color: var(--color-muted);
}

.workshop-detail__stat--accent {
    background: linear-gradient(135deg, #e0f2ff 0%, #f8fafc 100%);
    border-color: #b7d9fb;
}

.workshop-billing-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.9rem;
}

.workshop-billing-item {
    border: 1px solid #e4e7eb;
    border-radius: 16px;
    padding: 1rem 1.1rem;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    gap: 0.65rem;
    box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
}

.workshop-billing-item__main strong {
    font-size: 1rem;
}

.workshop-billing-item__main small,
.workshop-billing-item__main span,
.workshop-billing-item__main p {
    display: block;
    margin: 0.2rem 0 0;
    color: var(--color-muted);
    font-size: 0.85rem;
}

.workshop-billing-item__meta {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.workshop-billing-item__status {
    align-self: flex-start;
    padding: 0.2rem 0.7rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 600;
}

.workshop-billing-item__status--paid {
    background: #d3f9d8;
    color: #0b6534;
}

.workshop-billing-item__status--unpaid {
    background: #ffe3e3;
    color: #a61b1b;
}

.workshop-billing-item__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
}

.workshop-billing-item__actions .btn {
    padding: 0.35rem 0.75rem;
    font-size: 0.85rem;
    border-radius: 10px;
}

.workshop-billing-item__actions .btn.btn--ghost {
    border-color: #d0d7e2;
}

@media (max-width: 680px) {
    .workshop-detail__header {
        flex-direction: column;
    }

    .workshop-detail__actions {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: flex-start;
    }
}

@media (max-width: 1024px) {
    .workshop-detail-shell__layout {
        grid-template-columns: 1fr;
    }

    .workshop-detail-shell__primary,
    .workshop-detail-shell__aside {
        width: 100%;
    }
}

@media (max-width: 960px) {
    .panel-layout {
        flex-direction: column;
    }

    .panel-sidebar {
        width: 100%;
        flex-direction: row;
        align-items: center;
        gap: 1rem;
    }

    .panel-nav {
        flex-direction: row;
        flex-wrap: wrap;
    }

    .panel-section--split .panel-split,
    .panel-form--grid {
        grid-template-columns: 1fr;
    }

    .panel-card--aside {
        position: static;
    }

    .panel-grid--summary {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
}



=== PLIK: css/auth/page.css ===

.auth-body {
    background: radial-gradient(circle at top, #0b3d60, #050e17);
    min-height: 100vh;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
}

.auth {
    width: min(480px, 100%);
    background: #ffffff;
    border-radius: 24px;
    padding: 2.5rem;
    box-shadow: 0 30px 60px rgba(3, 18, 37, 0.35);
}

.auth__home-link {
    display: inline-flex;
    margin-bottom: 1rem;
}

.auth__intro {
    margin-bottom: 2rem;
    text-align: center;
}

.auth__eyebrow {
    text-transform: uppercase;
    letter-spacing: 0.3em;
    font-size: 0.75rem;
    color: var(--color-secondary);
}

.auth-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.auth-form label {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--color-text);
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
}

.auth-form input {
    border-radius: 12px;
    border: 1px solid #d0d7e2;
    padding: 0.75rem 1rem;
    font-size: 1rem;
}

.auth-card__feedback {
    min-height: 1.5rem;
    font-size: 0.9rem;
    color: var(--color-muted);
    margin-top: 0.75rem;
}

.auth-card__feedback.is-success {
    color: #1b9c58;
}

.auth-card__feedback.is-error {
    color: #c92a2a;
}

