<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warsztat+ | Panel administratora</title>
    <link rel="stylesheet" href="css/base/core.css">
    <link rel="stylesheet" href="css/panel/page.css">
</head>
<body class="panel-body">
    <div class="panel-layout">
        <aside class="panel-sidebar">
            <div class="panel-sidebar__brand">Warsztat<span>+</span></div>
            <nav class="panel-nav" aria-label="Nawigacja panelu">
                <button class="panel-nav__link is-active" data-panel-target="overview">Przeglad</button>
                <button class="panel-nav__link" data-panel-target="workshops">Warsztaty</button>
                <button class="panel-nav__link" data-panel-target="reports">Raporty</button>
                <button class="panel-nav__link" data-panel-target="settings">Ustawienia</button>
                <button class="panel-nav__link" data-panel-target="logs">Logi</button>
            </nav>
        </aside>

        <div class="panel-content">
            <header class="panel-header">
                <div class="panel-header__info">
                    <span class="panel-header__subtitle" id="panel-role"></span>
                    <h1 id="panel-username"></h1>
                </div>
                <button class="btn btn--ghost" id="logout-btn">Wyloguj</button>
            </header>

            <main class="panel-main">
                <section class="panel-view is-active" data-panel="overview">
                    <div class="panel-section panel-section--summary">
                        <header class="panel-section__header">
                            <div>
                                <p class="panel-section__eyebrow">Stan systemu</p>
                                <h2>Podsumowanie</h2>
                            </div>
                            <p class="panel-section__hint">Dane aktualizuja sie wraz z dzialaniami administratora.</p>
                        </header>
                        <div class="panel-grid panel-grid--summary" id="overview-metrics"></div>
                    </div>
                    <div class="panel-grid panel-grid--overview-cards">
                        <div class="panel-card panel-card--logs">
                            <h2>Ostatnie logi</h2>
                            <ul class="panel-log" id="overview-logs"></ul>
                        </div>
                        <div class="panel-card panel-card--surface panel-card--audit">
                            <h2>Ostatnie akcje administratorow</h2>
                            <ul class="panel-log panel-log--audit" id="admin-actions"></ul>
                        </div>
                    </div>
                </section>

                <section class="panel-view" data-panel="workshops">
                    <div class="panel-section">
                        <div class="panel-card panel-card--surface panel-card--workshops">
                            <div class="panel-toolbar panel-toolbar--split" id="workshop-toolbar-list">
                                <div>
                                    <p class="panel-section__eyebrow">Baza warsztatow</p>
                                    <h2>Warsztaty</h2>
                                </div>
                                <div class="panel-toolbar__actions">
                                    <button class="btn btn--secondary" type="button" id="workshop-add-btn">Dodaj warsztat</button>
                                </div>
                            </div>
                            <!-- Usunięto dolny przycisk Powrot do listy, zostaje tylko górny -->
                            <div class="workshop-browser" id="workshop-browser-list">
                                <form id="workshop-filter-form" class="panel-filters panel-filters--inline panel-filters--surface" novalidate>
                                    <label>
                                        Szukaj po nazwie lub e-mailu
                                        <input type="search" name="query" placeholder="np. Warsztat+ Centralny">
                                    </label>
                                    <label>
                                        Status
                                        <select name="status">
                                            <option value="all">Wszystkie</option>
                                            <option value="active">Aktywne</option>
                                            <option value="inactive">Nieaktywne</option>
                                            <option value="notice">W okresie wypowiedzenia</option>
                                            <option value="deactivated">Dezaktywowane</option>
                                        </select>
                                    </label>
                                    <div class="panel-filters__actions">
                                        <button class="btn btn--ghost" type="button" id="workshop-filter-reset">Wyczysc</button>
                                        <button class="btn btn--secondary" type="submit">Filtruj</button>
                                    </div>
                                </form>
                                <div class="panel-list panel-list--grid" id="workshop-list"></div>
                            </div>

                            <div class="workshop-browser workshop-browser--detail" id="workshop-browser-detail" hidden>
                                <div class="workshop-detail-shell">
                                    <div class="panel-back-btn-container panel-back-btn--absolute">
                                        <button class="btn btn--ghost panel-back-btn" type="button" id="workshop-list-back">&larr; Powrót do listy</button>
                                    </div>
                                        <div class="workshop-detail-shell__toolbar">
                                            <div>
                                                <p class="panel-section__eyebrow" id="workshop-detail-eyebrow">Profil warsztatu</p>
                                                <h3 id="workshop-detail-title">Szczegoly warsztatu</h3>
                                            </div>
                                            <button class="btn btn--danger" id="workshop-deactivate-btn">Dezaktywuj konto</button>
                                        </div>
                                    <p class="panel-feedback" id="workshop-detail-feedback" aria-live="polite"></p>
                                        <div class="workshop-detail-shell__layout">
                                            <div class="workshop-tabs">
                                                <!-- Usunięto pole specjalizacji -->
                                                <nav class="workshop-tabs__nav" aria-label="Zakładki szczegółów warsztatu">
                                                    <button class="workshop-tab active" data-tab="activity">Aktywność / Raporty</button>
                                                    <button class="workshop-tab" data-tab="logs">Logi i notatki</button>
                                                    <button class="workshop-tab" data-tab="reports">Raporty</button>
                                                    <button class="workshop-tab" data-tab="contacts">Kontakt & osoby</button>
                                                    <button class="workshop-tab" data-tab="settings">Ustawienia</button>
                                                    <button class="workshop-tab" data-tab="tickets">Zgłoszenia / bilety</button>
                                                </nav>
                                                <div class="workshop-tabs__content">
                                                    <section class="workshop-tab-content" id="tab-activity">
                                                        <div id="workshop-detail-overview" class="workshop-detail"></div>
                                                        <section class="workshop-detail__section">
                                                            <header>
                                                                <p class="panel-section__eyebrow">Abonament</p>
                                                                <h4>Stan umowy</h4>
                                                            </header>
                                                            <div id="workshop-detail-subscription" class="workshop-detail__grid"></div>
                                                        </section>
                                                        <!-- Usunięto podsekcję Raporty warsztatu -->
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-logs" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">Logi i notatki</p>
                                                            <h4>Ostatnie działania i notatnik</h4>
                                                        </header>
                                                        <ul id="workshop-detail-logs">(Tu pojawi się lista logów...)</ul>
                                                        <textarea id="workshop-detail-notepad" class="workshop-notepad" placeholder="Notatki wewnętrzne (widoczne tylko dla adminów)"></textarea>
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-reports" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">Raporty</p>
                                                            <h4>Wszystkie raporty warsztatu</h4>
                                                        </header>
                                                        <form id="workshop-reports-filter-form" class="panel-filters panel-filters--inline" novalidate>
                                                            <label>
                                                                Status
                                                                <select name="status">
                                                                    <option value="all">Wszystkie</option>
                                                                    <option value="pending">Oczekujące</option>
                                                                    <option value="approved">Zatwierdzone</option>
                                                                    <option value="rejected">Odrzucone</option>
                                                                </select>
                                                            </label>
                                                            <label>
                                                                Data
                                                                <input type="date" name="date">
                                                            </label>
                                                            <label>
                                                                Typ naprawy
                                                                <input type="text" name="type" placeholder="np. mechanika, elektronika">
                                                            </label>
                                                            <div class="panel-filters__actions">
                                                                <button class="btn btn--secondary" type="submit">Filtruj</button>
                                                            </div>
                                                        </form>
                                                        <div id="workshop-reports-list">(Tu pojawi się lista raportów...)</div>
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-contacts" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">Kontakt & osoby</p>
                                                            <h4>Użytkownicy konta warsztatu</h4>
                                                        </header>
                                                        <div id="workshop-detail-contacts">(Tu pojawi się lista kontaktów...)</div>
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-settings" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">Ustawienia</p>
                                                            <h4>Edycja danych warsztatu i integracje</h4>
                                                        </header>
                                                        <form id="workshop-settings-form" class="panel-form panel-form--stacked" novalidate>
                                                            <label>Nazwa warsztatu
                                                                <input type="text" name="name" required>
                                                            </label>
                                                            <label>Miasto
                                                                <input type="text" name="city">
                                                            </label>
                                                            <label>Adres
                                                                <input type="text" name="address">
                                                            </label>
                                                            <label>Telefon kontaktowy
                                                                <input type="tel" name="phone">
                                                            </label>
                                                            <label>Adres e-mail
                                                                <input type="email" name="email">
                                                            </label>
                                                            <label>E-mail do faktur
                                                                <input type="email" name="billingEmail">
                                                            </label>
                                                            <label>Cena abonamentu (PLN)
                                                                <input type="number" name="subscriptionAmount" min="0" step="0.01">
                                                            </label>
                                                            <label>Długość abonamentu (miesiące)
                                                                <input type="number" name="subscriptionMonths" min="1">
                                                            </label>
                                                            <label>Data startu umowy
                                                                <input type="date" name="subscriptionStartDate">
                                                            </label>
                                                            <fieldset>
                                                                <legend>Opcje dodatkowe</legend>
                                                                <label><input type="checkbox" name="integrationSms"> Integracja SMS</label>
                                                                <label><input type="checkbox" name="integrationHurtownia"> Integracja z hurtownią</label>
                                                                <label><input type="checkbox" name="integrationAutodoc"> Integracja z Autodoc</label>
                                                            </fieldset>
                                                            <div class="panel-form__actions panel-form__actions--end">
                                                                <button class="btn btn--secondary" type="submit">Zapisz zmiany</button>
                                                            </div>
                                                        </form>
                                                    </section>
                                                    <section class="workshop-tab-content" id="tab-tickets" style="display:none">
                                                        <header>
                                                            <p class="panel-section__eyebrow">Zgłoszenia / bilety</p>
                                                            <h4>Obsługa zgłoszeń</h4>
                                                        </header>
                                                        <div id="workshop-detail-tickets">(Tu pojawią się zgłoszenia...)</div>
                                                    </section>
                                                </div>
                                            </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="panel-view" data-panel="reports">
                    <div class="panel-section panel-section--split">
                        <div class="panel-split">
                            <div class="panel-split__primary panel-card panel-card--surface">
                                <div class="panel-toolbar">
                                    <div>
                                        <p class="panel-section__eyebrow">Historia napraw</p>
                                        <h2>Raporty</h2>
                                    </div>
                                    <p class="panel-section__hint">Wybierz raport z listy, aby edytowac.</p>
                                </div>
                                <form id="report-filter-form" class="panel-filters panel-filters--inline" novalidate>
                                    <label>
                                        Szukaj po VIN
                                        <input type="search" name="vin" placeholder="np. WAUZZZ...">
                                    </label>
                                    <label>
                                        Numer rejestracyjny
                                        <input type="search" name="registration" placeholder="np. WPR 1234">
                                    </label>
                                    <label>
                                        Status weryfikacji
                                        <select name="approval">
                                            <option value="all">Wszystkie</option>
                                            <option value="pending">Oczekujace</option>
                                            <option value="approved">Zatwierdzone</option>
                                            <option value="rejected">Odrzucone</option>
                                        </select>
                                    </label>
                                    <div class="panel-filters__actions">
                                        <button class="btn btn--ghost" type="submit">Filtruj</button>
                                    </div>
                                </form>
                                <div class="panel-list" id="report-list"></div>
                            </div>
                            <aside class="panel-split__aside">
                                <div class="panel-card panel-card--aside">
                                    <p class="panel-section__eyebrow">Panel edycji</p>
                                    <h3>Edycja raportu</h3>
                                    <form id="report-edit-form" class="panel-form" novalidate>
                                        <input type="hidden" name="reportId">
                                        <label>
                                            Numer VIN
                                            <input type="text" name="vin" required>
                                        </label>
                                        <label>
                                            Numer rejestracyjny
                                            <input type="text" name="registrationNumber" placeholder="np. WPR 1234">
                                        </label>
                                            <div class="panel-form__meta panel-form__meta--two">
                                                <label>
                                                    Przebieg (km)
                                                <input type="number" name="mileageKm" min="0" step="1">
                                                </label>
                                                <label>
                                                    Data pierwszej rejestracji
                                                <input type="date" name="firstRegistrationDate">
                                                </label>
                                            </div>
                                        <label>
                                            Status weryfikacji
                                            <select name="approvalStatus" id="report-approval-select">
                                                <option value="pending">Oczekuje na akceptacje</option>
                                                <option value="approved">Zatwierdzony</option>
                                                <option value="rejected">Odrzucony</option>
                                            </select>
                                        </label>
                                        <label>
                                            Opis
                                            <textarea name="summary" rows="4" placeholder="Opis naprawy"></textarea>
                                        </label>
                                            <div class="panel-media-section">
                                                <p class="panel-media-section__title">Zalaczone pliki</p>
                                                <div id="report-media-gallery" class="panel-media-gallery panel-media-gallery--readonly">
                                                    <p class="panel-empty">Brak zalacznikow.</p>
                                                </div>
                                            </div>
                                        <label>
                                            Notatka dla warsztatu
                                            <textarea name="moderationNote" rows="2" placeholder="Powod odrzucenia lub uwagi dodatkowe"></textarea>
                                        </label>
                                        <div class="panel-form__actions">
                                            <button class="btn btn--secondary" type="submit">Zapisz zmiany</button>
                                        </div>
                                    </form>
                                    <p class="panel-feedback" id="report-feedback" aria-live="polite"></p>
                                </div>
                            </aside>
                        </div>
                    </div>
                </section>

                <section class="panel-view" data-panel="settings">
                    <div class="panel-section panel-section--narrow">
                        <div class="panel-card panel-card--form">
                            <header class="panel-section__header">
                                <div>
                                    <p class="panel-section__eyebrow">Konfiguracja</p>
                                    <h2>Ustawienia systemowe</h2>
                                </div>
                                <p class="panel-section__hint">Dotyczy nowych licencji oraz statusow w raportach.</p>
                            </header>
                            <form id="settings-form" class="panel-form panel-form--grid" novalidate>
                                <label>
                                    Dlugosc licencji (miesiace)
                                    <input type="number" name="licenseMonths" min="1" required>
                                </label>
                                <label>
                                    Statusy napraw (oddzielone przecinkiem)
                                    <textarea name="statusOptions" rows="3" placeholder="Przyjeta, W trakcie, Zakonczona"></textarea>
                                </label>
                                <div class="panel-form__actions panel-form__actions--end">
                                    <button class="btn btn--secondary" type="submit">Zapisz ustawienia</button>
                                </div>
                            </form>
                            <p class="panel-feedback" id="settings-feedback" aria-live="polite"></p>
                        </div>
                    </div>
                </section>

                <section class="panel-view" data-panel="logs">
                        <div class="panel-card">
                            <h2>Dziennik zdarzen</h2>
                            <ul class="panel-log panel-log--tall panel-log--audit" id="logs-full"></ul>
                            <button class="btn btn--ghost" id="logs-refresh-btn" type="button">Odswiez logi</button>
                        </div>
                </section>
                    <section class="panel-view panel-view--workshop" data-panel="workshop-home">
                        <div class="panel-section panel-section--summary">
                            <header class="panel-section__header">
                                <div>
                                    <p class="panel-section__eyebrow">Profil warsztatu</p>
                                    <h2>Twoje konto</h2>
                                </div>
                                <p class="panel-section__hint">Podsumowanie licencji i podstawowych danych kontaktowych.</p>
                            </header>
                            <div class="panel-card panel-card--surface panel-card--workshop">
                                <div id="workshop-details" class="workshop-summary"></div>
                            </div>
                        </div>
                        <div class="panel-card panel-card--surface">
                            <h2>Twoje raporty</h2>
                            <div class="panel-list" id="workshop-report-list"></div>
                        </div>
                        <div class="panel-card panel-card--surface">
                            <p class="panel-section__eyebrow">Nowy raport</p>
                            <h2>Dodaj raport serwisowy</h2>
                            <p class="panel-section__hint">Po wyslaniu raport trafi do administratora i oczekuje na akceptacje.</p>
                            <form id="workshop-report-form" class="panel-form" novalidate>
                                <label>
                                    Numer VIN
                                    <input type="text" name="vin" required>
                                </label>
                                <label>
                                    Numer rejestracyjny
                                    <input type="text" name="registrationNumber" required>
                                </label>
                                <label>
                                    Przebieg pojazdu (km)
                                    <input type="number" name="mileageKm" min="0" step="1" required>
                                </label>
                                <label>
                                    Data pierwszej rejestracji
                                    <input type="date" name="firstRegistrationDate" required>
                                </label>
                                <label>
                                    Opis naprawy
                                    <textarea name="summary" rows="3" placeholder="Opis wykonanych prac" required></textarea>
                                </label>
                                <label class="panel-upload">
                                    Zalacz zdjecia lub filmy
                                    <input type="file" name="mediaFiles" accept="image/*,video/*" multiple>
                                    <small>Maks. 5 plikow, po 5 MB kazdy.</small>
                                </label>
                                <ul class="panel-upload__list" id="workshop-media-preview"></ul>
                                <div class="panel-form__actions">
                                    <button class="btn btn--secondary" type="submit">Dodaj raport</button>
                                </div>
                            </form>
                            <p class="panel-feedback" id="workshop-report-feedback" aria-live="polite"></p>
                        </div>
                    </section>
            </main>
        </div>
    </div>

    <aside class="panel-drawer" id="metric-drawer" aria-hidden="true">
        <div class="panel-drawer__header">
            <div>
                <p class="panel-section__eyebrow" id="metric-drawer-eyebrow"></p>
                <h3 id="metric-drawer-title"></h3>
            </div>
            <button class="btn btn--ghost" type="button" id="metric-drawer-close">Zamknij</button>
        </div>
        <p class="panel-drawer__lead" id="metric-drawer-description"></p>
        <div id="metric-drawer-content" class="panel-drawer__content"></div>
    </aside>
    <div class="panel-drawer__backdrop" id="metric-drawer-backdrop" hidden></div>

    <aside class="panel-drawer panel-drawer--form" id="workshop-drawer" aria-hidden="true">
        <div class="panel-drawer__header">
            <div>
                <p class="panel-section__eyebrow" id="workshop-drawer-eyebrow">Nowy warsztat</p>
                <h3 id="workshop-drawer-title">Dodaj warsztat</h3>
            </div>
            <button class="btn btn--ghost" type="button" id="workshop-drawer-close">Zamknij</button>
        </div>
        <form id="create-workshop-form" class="panel-form panel-form--drawer" novalidate>
            <label>
                Nazwa warsztatu
                <input type="text" name="name" required>
            </label>
            <label>
                Miasto
                <input type="text" name="city" placeholder="np. Krakow">
            </label>
            <label>
                Adres
                <input type="text" name="address" placeholder="np. ul. Mechanikow 12">
            </label>
            <label>
                Telefon kontaktowy
                <input type="tel" name="phone" placeholder="np. +48 123 456 789">
            </label>
            <label>
                Adres e-mail
                <input type="email" name="email" placeholder="np. biuro@warsztat.pl">
            </label>
            <label>
                E-mail do faktur
                <input type="email" name="billingEmail" placeholder="np. ksiegowosc@warsztat.pl">
                <small class="panel-form__hint">Opcjonalny adres do korespondencji rozliczeniowej.</small>
            </label>
            <label>
                E-mail logowania
                <input type="email" name="loginEmail" placeholder="np. konto@warsztat.pl" required>
            </label>
            <label>
                Haslo do panelu
                <input type="password" name="loginPassword" placeholder="Minimum 8 znakow">
                <small class="panel-form__hint">Przy dodawaniu nowego warsztatu haslo jest wymagane. Podczas edycji pozostaw puste, aby nie zmieniac.</small>
            </label>
            <label>
                Status
                <select name="status">
                    <option value="active">Aktywny</option>
                    <option value="inactive">Nieaktywny</option>
                    <option value="notice">W okresie wypowiedzenia</option>
                    <option value="deactivated">Dezaktywowany</option>
                </select>
            </label>
            <label>
                Kwota abonamentu (PLN)
                <input type="number" name="subscriptionAmount" min="0" step="0.01" placeholder="np. 299">
            </label>
            <label>
                Data startu abonamentu
                <input type="date" name="subscriptionStartDate">
            </label>
            <label>
                Kwota startowa (proporcjonalna)
                <input type="number" name="subscriptionInitialAmount" min="0" step="0.01" placeholder="np. 149,50">
                <small class="panel-form__hint">Pozwala zapisac pierwsza fakture, gdy umowa zaczyna sie w polowie miesiaca.</small>
            </label>
            <label>
                Opis rozliczenia poczatkowego
                <input type="text" name="subscriptionInitialNote" placeholder="np. 15-31 stycznia">
            </label>
            <label>
                Notatki administracyjne
                <textarea name="notes" rows="3" placeholder="Uwagi widoczne tylko w panelu"></textarea>
            </label>
            <div class="panel-form__actions panel-form__actions--spread">
                <button class="btn btn--ghost" type="button" id="workshop-cancel-edit">Anuluj</button>
                <button class="btn btn--secondary" type="submit" data-workshop-form-submit>Dodaj warsztat</button>
            </div>
        </form>
        <p class="panel-feedback" id="workshop-feedback" aria-live="polite"></p>
    </aside>
    <div class="panel-drawer__backdrop" id="workshop-drawer-backdrop" hidden></div>

    <script src="js/shared/api.js"></script>
    <script src="js/shared/session.js"></script>
    <script src="js/panel/dashboard.js"></script>
</body>
</html>
